<!DOCTYPE html>
<html lang="zh" data-hairline="true" data-theme="light" data-focus-method="pointer" style="">
{% include 'question/head.html' %}
<body class="Entry-body">
{% include 'question/header.html' %}

<main role="main" class="App-main" data-dfs-main='{ "user_id":"{{user.id}}","user_name":"{{user.first_name}}","user_avatar":"{{user.userprofile.avatar}}","er_id":"{{er.id}}","er_name":"{{er.first_name}}"
,"er_avatar":"{{er.userprofile.avatar}}","er_mood":"{{er.userprofile.mood}}","er_intro":"{{er.userprofile.intro}}","er_sexual":"{{er.userprofile.sexual}}","er_residence":"{{er.userprofile.residence}}"
,"er_job":"{{er.userprofile.job}}","followed":"{{followed}}","command":"{{command}}","subcmd":"{{subcmd}}"}'   data-dfs-ext='{"questions_num":"{{ext_info.questions_num}}","answers_num":"{{ext_info.answers_num}}"
,"followtos_num":"{{ext_info.followtos_num}}","followers_num":"{{ext_info.followers_num}}","followtopics_num":"{{ext_info.followtopics_num}}","followquestions_num":"{{ext_info.followquestions_num}}"}'>
<div>
<div>
<div id="ProfileHeader" class="ProfileHeader">
<div class="Card">

<div class="ProfileHeader-userCover">
<div class="UserCoverEditor">
<div>
<div class="UserCover UserCover--colorBlock">
</div>
</div>
<input type="file" accept="image/png,image/jpeg" style="display: none;">
</div>
</div>

<div class="ProfileHeader-wrapper">
<div class="ProfileHeader-main">

<div class="UserAvatarEditor ProfileHeader-avatar" style="top: -25px;">
<div class="UserAvatar">
<img id="id_avatar" class="Avatar Avatar--large UserAvatar-inner" width="160" height="160" src="" srcset="" alt="">
</div>
<div class="Mask UserAvatarEditor-mask Mask-hidden">
<div class="Mask-mask Mask-mask--black UserAvatarEditor-maskInner">
</div>
<div class="Mask-content">
<svg class="Zi Zi--Camera UserAvatarEditor-cameraIcon" fill="currentColor" viewBox="0 0 24 24" width="36" height="36"><path d="M20.094 6S22 6 22 8v10.017S22 20 19 20H4.036S2 20 2 18V7.967S2 6 4 6h3s1-2 2-2h6c1 0 2 2 2 2h3.094zM12 16a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7zm0 1.5a5 5 0 1 0-.001-10.001A5 5 0 0 0 12 17.5zm7.5-8a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" fill-rule="evenodd"></path></svg>
<div class="UserAvatarEditor-maskInnerText">修改我的头像</div>
</div>
</div>
<input id="id_avatar_input" name="file" type="file" accept="image/png,image/jpeg" style="display: none;"/>
</div>

<div class="ProfileHeader-content">
<div class="ProfileHeader-contentHead">
<h1 class="ProfileHeader-title">
<span class="ProfileHeader-name"></span>
<span class="RichText ProfileHeader-headline"></span>
</h1>
</div>
<div class="ProfileHeader-contentBody" style="overflow: hidden; transition: height 300ms ease-out; height: 50px;">
</div>
<div class="ProfileHeader-contentFooter">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="Profile-main">
<div class="Profile-mainColumn">
<div class="Card ProfileMain" id="ProfileMain">
<div class="ProfileMain-header">
<ul role="tablist" class="Tabs ProfileMain-tabs">
<!--
<li role="tab" class="Tabs-item Tabs-item--noMeta" aria-controls="Profile-activities">
<a class="Tabs-link" href="/er/{{er.id}}/activities/">动态</a>
</li>

<li role="tab" class="Tabs-item" aria-controls="Profile-answers">
<a class="Tabs-link" href="/er/{{er.id}}/answers/">回答<span class="Tabs-meta">{{ext_info.answers_num}}</span></a>
</li>
<li role="tab" class="Tabs-item" aria-controls="Profile-asks">
<a class="Tabs-link" href="/er/{{er.id}}/asks/">提问<span class="Tabs-meta">{{ext_info.questions_num}}</span></a>
</li>
<li role="tab" class="Tabs-item" aria-controls="Profile-posts">
<a class="Tabs-link" href="/er/{{er.id}}/posts/">文章<span class="Tabs-meta">0</span></a>
</li>

<li role="tab" class="Tabs-item" aria-controls="Profile-columns">
<a class="Tabs-link" href="/er/{{er.id}}/columns/">专栏<span class="Tabs-meta">0</span></a>
</li>
<li role="tab" class="Tabs-item" aria-controls="Profile-pins">
<a class="Tabs-link" href="/er/{{er.id}}/pins/">想法<span class="Tabs-meta">0</span></a>
</li>
<li role="tab" class="Tabs-item" aria-controls="Profile-collections">
<a class="Tabs-link" href="/er/{{er.id}}/collections/">收藏<span class="Tabs-meta">0</span></a>
</li>

<li role="tab" class="Tabs-item" aria-controls="Profile-following">
<a class="Tabs-link" href="/er/{{er.id}}/following/">关注<span class="Tabs-meta"><svg viewBox="0 0 10 6" class="Icon ProfileMain-tabIcon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg></span></a>
</li>


<li role="tab" class="Tabs-item Tabs-item--noMeta">
<div class="Popover Tabs-link">
<button class="Button ProfileMain-menuToggler Button--plain" type="button" id="Popover-20486-79514-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover-20486-79514-content">更多<svg viewBox="0 0 10 6" class="Icon ProfileMain-tabIcon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg></button>
</div>
</li>
-->

</ul>
</div>

<div>
<div>
<div class="Sticky">
</div>
</div>
</div>


</div>
</div>

<div class="Profile-sideColumn">
<div class="Card FollowshipCard">
<!--<div class="NumberBoard FollowshipCard-counts NumberBoard--divider">
<a class="Button NumberBoard-item Button--plain" type="button" href="/er/{{er.id}}/following/followtos"><div class="NumberBoard-itemInner"><div class="NumberBoard-itemName">关注了</div><strong class="NumberBoard-itemValue" title="{{ext_info.followtos_num}}">{{ext_info.followtos_num}}</strong></div></a>
<a class="Button NumberBoard-item Button--plain" type="button" href="/er/{{er.id}}/following/followers"><div class="NumberBoard-itemInner"><div class="NumberBoard-itemName">关注者</div><strong class="NumberBoard-itemValue" title="{{ext_info.followers_num}}">{{ext_info.followers_num}}</strong></div></a>
</div>-->
</div>
<div class="Profile-lightList">
<!--<a class="Profile-lightItem" href="/er/{{er.id}}/following/topics"><span class="Profile-lightItemName">关注的话题</span><span class="Profile-lightItemValue">{{ext_info.followtopics_num}}</span></a>-->
<!--<a class="Profile-lightItem" href="/er/{{er.id}}/following/columns"><span class="Profile-lightItemName">关注的专栏</span><span class="Profile-lightItemValue">0</span></a>-->
<!--<a class="Profile-lightItem" href="/er/{{er.id}}/following/questions"><span class="Profile-lightItemName">关注的问题</span><span class="Profile-lightItemValue">{{ext_info.followquestions_num}}</span></a>-->
<!--<a class="Profile-lightItem" href="/er/{{er.id}}/following/collections"><span class="Profile-lightItemName">关注的收藏夹</span><span class="Profile-lightItemValue">0</span></a>-->
</div>
<div class="Profile-footerOperations">个人主页被浏览 2 次</div>
<footer class="Footer">
<!--<a class="Footer-item" target="_blank" href="//liukanshan.zhihu.com/">刘看山</a><span class="Footer-dot"></span><a class="Footer-item" target="_blank" href="/question/19581624">知乎指南</a><span class="Footer-dot"></span><a class="Footer-item" target="_blank" href="/terms">知乎协议</a><span class="Footer-dot"></span><a class="Footer-item" target="_blank" href="/app">应用</a><span class="Footer-dot"></span><a class="Footer-item" target="_blank" href="/careers">工作</a><br>-->
<!--<a class="Footer-item" target="_blank" href="https://zhuanlan.zhihu.com/p/28561671">侵权举报</a><span class="Footer-dot">-->
</span><a class="Footer-item" target="_blank" href="http://www.12377.cn">网上有害信息举报专区</a><br><span class="Footer-item">违法和不良信息举报：010-82716601</span><br><!--<a class="Footer-item" target="_blank" href="/jubao">儿童色情信息举报专区</a><br>--><a class="Footer-item" target="_blank" href="/">联系我们</a><span> © 2018 大大大</span>
</footer>
</div>
</div>
</div>
</div>
</main>


<div class="CornerButtons">
<div class="CornerAnimayedFlex">
<button class="Button CornerButton Button--plain" data-tooltip="建议反馈" data-tooltip-position="left" aria-label="建议反馈" type="button"><svg class="Zi Zi--Feedback" title="建议反馈" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M19.99 6.99L18 5s-1-1-2-1H8C7 4 6 5 6 5L4 7S3 8 3 9v9s0 2 2.002 2H19c2 0 2-2 2-2V9c0-1-1.01-2.01-1.01-2.01zM16.5 5.5L19 8H5l2.5-2.5h9zm-2 5.5s.5 0 .5.5-.5.5-.5.5h-5s-.5 0-.5-.5.5-.5.5-.5h5z"></path></svg></button>
</div>
<div class="CornerAnimayedFlex CornerAnimayedFlex--hidden">
<button class="Button CornerButton Button--plain" data-tooltip="回到顶部" data-tooltip-position="left" aria-label="回到顶部" type="button"><svg class="Zi Zi--BackToTop" title="回到顶部" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M16.036 19.59a1 1 0 0 1-.997.995H9.032a.996.996 0 0 1-.997-.996v-7.005H5.03c-1.1 0-1.36-.633-.578-1.416L11.33 4.29a1.003 1.003 0 0 1 1.412 0l6.878 6.88c.782.78.523 1.415-.58 1.415h-3.004v7.005z"></path></svg></button>
</div>
</div>
</div>
</div>
<span><div></div></span>

<!--
<div class="Modal-wrapper">
<div class="Modal-backdrop">
</div>
-->
<div id="upAvatarModal" class="modal fade 1Modal 1Modal--default 1UploadImageModal-modal" tabindex="-1" role="dialog" 1aria-labelledby="upAvatarModalLabel" 1aria-hidden="true">
<div class="modal-dialog" style="#width:200px;">

<div class="Modal-inner">
<h3 class="Modal-title">编辑头像</h3>
<div class="Modal-subtitle">调整头像尺寸和位置</div>
<div class="Modal-content">
<div>
<div class="UploadImageModal-container">
<div style="text-align:center">
<img id="preview_avatar" width="300px" height="300px" alt="" >
</div>
<div  id="chooseBox" style="width: 200px;height: 200px;border: 1px solid #4fb8e3;position: absolute;left: 200px;top: 163px;z-index: 1000"></div>
<canvas id="avatar_canvas" width="200" height="200" style="width: 200px; height: 200px;display:none"></canvas>
</div>
<div style="text-align:center">
<svg class="Zi Zi--Size" fill="currentColor" viewBox="0 0 24 24" width="18" height="18"><path d="M16.296 7h.697A1.01 1.01 0 0 1 18 8.003v10.995c0 .554-.45 1.003-1.007 1.003H4.007A1.01 1.01 0 0 1 3 18.998V8.003C3 7.449 3.45 7 4.007 7h12.289zm-.892 11a.6.6 0 0 0 .597-.601V9.601A.597.597 0 0 0 15.405 9H5.596A.599.599 0 0 0 5 9.602v7.797c0 .335.267.601.596.601h9.808zM7 4h13a1 1 0 0 1 1 1v11a1 1 0 0 1-2 0V6.5c0-.5-.5-.5-.5-.5H7a1 1 0 0 1 0-2z" fill-rule="evenodd"></path></svg>
<input id="adjust_choosebox"type="range" step="1" min="0" max="100" class="RangeInput" value="50" style="display:inline" oninput="adjustChooseBox()">
<svg class="Zi Zi--Size" fill="currentColor" viewBox="0 0 24 24" width="22" height="22"><path d="M16.296 7h.697A1.01 1.01 0 0 1 18 8.003v10.995c0 .554-.45 1.003-1.007 1.003H4.007A1.01 1.01 0 0 1 3 18.998V8.003C3 7.449 3.45 7 4.007 7h12.289zm-.892 11a.6.6 0 0 0 .597-.601V9.601A.597.597 0 0 0 15.405 9H5.596A.599.599 0 0 0 5 9.602v7.797c0 .335.267.601.596.601h9.808zM7 4h13a1 1 0 0 1 1 1v11a1 1 0 0 1-2 0V6.5c0-.5-.5-.5-.5-.5H7a1 1 0 0 1 0-2z" fill-rule="evenodd"></path></svg>
</div>
<div class="ModalButtonGroup ModalButtonGroup--vertical">
<button class="Button Button--primary Button--blue" type="button" onclick="saveFile()">保存</button>
</div>
</div>
</div>
</div>
<button data-dismiss="modal" class="Button Modal-closeButton Button--plain" aria-label="关闭" type="button">
<svg class="Zi Zi--Close Modal-closeIcon" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M13.486 12l5.208-5.207a1.048 1.048 0 0 0-.006-1.483 1.046 1.046 0 0 0-1.482-.005L12 10.514 6.793 5.305a1.048 1.048 0 0 0-1.483.005 1.046 1.046 0 0 0-.005 1.483L10.514 12l-5.208 5.207a1.048 1.048 0 0 0 .006 1.483 1.046 1.046 0 0 0 1.482.005L12 13.486l5.207 5.208a1.048 1.048 0 0 0 1.483-.006 1.046 1.046 0 0 0 .005-1.482L13.486 12z" fill-rule="evenodd"></path></svg>
</button>
</div>
</div>
<!-- ask（Modal） -->
{% include 'question/ask_modal.html' %}
<!-- ask（Modal） -->

<!-- letter（Modal） -->
<!-- append by js -->
<!-- letter（Modal） -->
<script>
function appendFollowElementSub(ret)
{
    if(("followtos"==g_subcmd)||("followers"==g_subcmd))
    {
        var people_id=ret[0];
        var people_name=ret[1];
        var people_anwser_nums=ret[2];
        var people_avatar=ret[3];
        var people_mood=ret[4];
        var people_follower_nums=ret[5];
        var people_followed=ret[6];
        var people_followed_each=ret[7];
        if("1"==people_followed)
            var followed_html='<button class="Button FollowButton Button--primary Button--grey" type="button">已关注</button>';
        else
            var followed_html='<button class="Button FollowButton Button--primary Button--green" type="button">关注</button>';
        if("1"==people_followed_each)
            var followed_each_html='<span class="FollowStatus">相互关注</span>';
        else
            var followed_each_html='';
        var data='<div class="List-item"><div class="ContentItem"><div class="ContentItem-main"><div class="ContentItem-image"><span class="UserLink UserItem-avatar"><div class="Popover"><div id="Popover-28784-64463-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover-28784-64463-content"><a class="UserLink-link" target="_blank" href="/er/'+people_id+'">\
                <img class="Avatar Avatar--large UserLink-avatar" width="60" height="60" src="'+people_avatar+'" srcset="'+people_avatar+'" alt="'+people_name+'"></a></div></div></span></div><div class="ContentItem-head"><h2 class="ContentItem-title"><div class="UserItem-title"><span class="UserLink UserItem-name"><div class="Popover"><div id="Popover-28784-44728-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover-28784-44728-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="/er/'+people_id+'">'+people_name+'</a></div></div></span>'+followed_each_html+'</div></h2><div class="ContentItem-meta"><div><div class="RichText">'+people_mood+'</div>\
                <div class="ContentItem-status"><span class="ContentItem-statusItem">'+people_anwser_nums+' 回答</span><span class="ContentItem-statusItem">0 文章</span><span class="ContentItem-statusItem">'+people_follower_nums+' 关注者</span></div></div></div></div><div class="ContentItem-extra">'+followed_html+'</div></div></div></div>';
        $("#appendArea").append(data);
    }
    else if("topics"==g_subcmd)
    {
        var topic_id=ret[0];
        var topic_name=ret[1];
        var topic_avatar=ret[2];
        var topic_detail=ret[3];
        
        var data='<div class="List-item"><div class="ContentItem"><div class="ContentItem-main"><div class="ContentItem-image"><img class="Avatar Avatar--large" width="60" height="60" src="'+topic_avatar+'" srcset="'+topic_avatar+' 2x"></div><div class="ContentItem-head"><h2 class="ContentItem-title"><a class="TopicLink" href="/topic/'+topic_id+'" target="_blank"><div class="Popover"><div id="Popover-92518-2569-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover-92518-2569-content">'+topic_name+'</div></div></a></h2><div class="ContentItem-meta"><div class="ContentItem-status">'+topic_detail+'</div></div></div></div></div></div>';
        $("#appendArea").append(data);
    }
    else if("questions"==g_subcmd)
    {
        var question_id=ret[0];
        var question_title=ret[1];
        var question_pubdate=ret[2];
        var question_answer_nums=ret[3];
        var question_follower_nums=ret[4];
        var data='\
                <div class="List-item">\
                <div class="ContentItem" ><h2 class="ContentItem-title"><div class="QuestionItem-title">\
                <a href="/question/'+question_id+'" target="_blank">'+question_title+'</a></div></h2>\
                <div class="ContentItem-status"><span class="ContentItem-statusItem">'+question_pubdate+'</span><span class="ContentItem-statusItem">'+question_answer_nums+' 个回答</span><span class="ContentItem-statusItem">'+question_follower_nums+' 个关注</span></div></div></div>\
                ';
        $("#appendArea").append(data);
    }
}

function appendFollowElement()
{
    var data='<div class="List" id="Profile-following"><div class="List-header"><h4 class="List-headerText"><div class="SubTabs">\
    <a class="SubTabs-item" href="/er/'+g_er_id+'/following/followtos">'+g_who_han+'关注的人</a>\
    <a class="SubTabs-item" href="/er/'+g_er_id+'/following/followers">关注'+g_who_han+'的人</a>\
    <a class="SubTabs-item" href="/er/'+g_er_id+'/following/topics">'+g_who_han+'关注的话题</a>\
    <a class="SubTabs-item" href="/er/'+g_er_id+'/following/questions">'+g_who_han+'关注的问题</a>\
    </div></h4></div><div id="appendArea"></div></div>';
    $("#ProfileMain").append(data);
    
    $(".SubTabs-item").each(function(){
        if($(this).attr("href"))
        {
            if($(this).attr("href").indexOf(g_subcmd)>-1)
                $(this).addClass("is-active");
        }
    });
    
    $.get("/ajax/er/"+g_er_id+"/following/"+g_subcmd+"/",function(ret){
        if("fail"!=ret)
        {
            for(i in ret)
                appendFollowElementSub(ret[i]);
        }
    });
}
function appendAnswerElement()
{
    var data='<div class="List Profile-answers"><div class="List-header"><h4 class="List-headerText"><span>'+g_who_han+'的回答</span></h4></div><div id="appendArea"></div></div>';
    $("#ProfileMain").append(data);
    $.get("/ajax/er/"+g_er_id+"/"+g_command+"/",function(ret){
        if("fail"!=ret)
        {
            console.log(ret);
            appendAnswerElementList(ret,"homepage");
            checkSets();
        }
    });
}
function appendQuestionElementSub(ret)
{
    var question_id=ret[0];
    var question_title=ret[1];
    var question_pubdate=ret[2];
    var question_answer_nums=ret[3];
    var question_follower_nums=ret[4];
    var data='<div class="List-item"><div class="ContentItem" ><h2 class="ContentItem-title"><div class="QuestionItem-title"><a href="/question/'+question_id+'" target="_blank">'+question_title+'</a></div></h2><div class="ContentItem-status"><span class="ContentItem-statusItem">'+question_pubdate+'</span><span class="ContentItem-statusItem">'+question_answer_nums+' 个回答</span><span class="ContentItem-statusItem">'+question_follower_nums+' 个关注</span></div></div></div>';
    $("#appendArea").append(data);
}
function appendQuestionElement()
{
    data='<div class="List Profile-answers"><div class="List-header"><h4 class="List-headerText"><span>'+g_who_han+'的问题</span></h4></div><div id="appendArea"></div></div>';
    $("#ProfileMain").append(data);
    $.get("/ajax/er/"+g_er_id+"/"+g_command+"/",function(ret){
        if("fail"!=ret)
        {
            for(i in ret)
                appendQuestionElementSub(ret[i]);
            checkSets();
        }
    });
}

function checkProfileSave()
{
	$(".save").off("click");
	$(".save").click(function(){
        var _this=$(this);
		var field_type=$(this).parents(".Field-content").attr("data-field-type")
		console.log(field_type);
		if("sexual"==field_type)
		{	
			var value=$("input[name='sexual']:checked").val();
			$.post("/ajax/profile_edit/sexual/",{content:value},function(ret){
                if("fail"!=ret)
                {
                    console.log(ret);
                    if("f"==ret)
                    {
                        g_er_sexual="she";
                        g_er_sexual_han="女";
                    }
                    else if("m"==ret)
                    {
                        g_er_sexual="he";
                        g_er_sexual_han="男";
                    }                    
                }
                var data='<div><span class="Field-text">'+g_er_sexual_han+'</span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div>';
                _this.parents(".Field-content").empty().append(data);
                checkProfileModify();
			});
		}
		else if("mood"==field_type)
		{
            var value=$("input[name='mood']").val();
			$.post("/ajax/profile_edit/mood/",{content:value},function(ret){
                if("fail"!=ret)
                {
                    g_er_mood=ret;                 
                }
                var data='<div><span class="Field-text"><span class="RichText">'+g_er_mood+'</span></span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div>';
                _this.parents(".Field-content").empty().append(data);
                checkProfileModify();
            });

		}
		else if("residence"==field_type)
		{
            var value=$("input[name='residence']").val();
			$.post("/ajax/profile_edit/residence/",{content:value},function(ret){
                if("fail"!=ret)
                {
                    g_er_residence=ret;                     
                }
                var data='<div><span class="Field-text"><span class="RichText">'+g_er_residence+'</span></span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div>';
                _this.parents(".Field-content").empty().append(data);
                checkProfileModify();
            });
		}
		else if("job"==field_type)
		{
            var value=$("input[name='job']").val();
			$.post("/ajax/profile_edit/job/",{content:value},function(ret){
                if("fail"!=ret)
                {
                    g_er_job=ret;
                }
                var data='<div><span class="Field-text">'+g_er_job+'</span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div>';
                _this.parents(".Field-content").empty().append(data);
                checkProfileModify();
            });
		}
		else if("intro"==field_type)
		{
            var value=$("textarea[name='intro']").val();
			$.post("/ajax/profile_edit/intro/",{content:value},function(ret){
                if("fail"!=ret)
                {
                    g_er_intro=ret;
                }
                var data='<div class="DescriptionField-content"><span class="Field-text"><span class="RichText">'+g_er_intro+'</span></span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div>';
                _this.parents(".Field-content").empty().append(data);
                checkProfileModify();
            });
		}
		checkProfileModify();
	});
	$(".cancle").off("click");
	//$(".cancle").each(function(){
	$(".cancle").click(function(){
		console.log("cancle click");
		var field_type=$(this).parents(".Field-content").attr("data-field-type")
		console.log(field_type);
		if("sexual"==field_type)
		{			
			var data='<div><span class="Field-text">'+g_er_sexual_han+'</span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div>';
		}
		else if("mood"==field_type)
		{
			var data='<div><span class="Field-text"><span class="RichText">'+g_er_mood+'</span></span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div>';
		}
		else if("residence"==field_type)
		{
			var data='<div><span class="Field-text"><span class="RichText">'+g_er_residence+'</span></span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div>';
		}
		else if("job"==field_type)
		{
			var data='<div><span class="Field-text">'+g_er_job+'</span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div>';
		}
		else if("intro"==field_type)
		{
			var data='<div class="DescriptionField-content"><span class="Field-text"><span class="RichText">'+g_er_intro+'</span></span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div>';
		}
		$(this).parents(".Field-content").empty().append(data);
		checkProfileModify();
	});
	//});
}
function checkProfileModify()
{
	$(".Field").off("mouseenter mouseleave");
	//$(".Field").each(function(){
		$(".Field").on("mouseenter mouseleave",function(event){
			if(event.type=="mouseenter")
			{
				$(this).find(".ModifyButton").removeClass("Field-modify-hidden");
			}
			else if(event.type=="mouseleave")
			{
				$(this).find(".ModifyButton").addClass("Field-modify-hidden");
			}
		});
	//});
	$(".Field").find(".ModifyButton").off("click");
	$(".Field").find(".ModifyButton").click(function(){
		var field_type=$(this).parents(".Field-content").attr("data-field-type");
		console.log(field_type);
		if("sexual"==field_type)
		{
			if("f"==g_er_sexual)
				var data='<div><input type="radio" name="sexual" value="m"> 男<input type="radio" name="sexual" value="f" checked style="margin-left: 30px;"> 女<div class="ButtonGroup"><button class="Button Button--primary Button--blue save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div></div>';
			else
				var data='<div><input type="radio" name="sexual" value="m" checked> 男<input type="radio" name="sexual" value="f" style="margin-left: 30px;"> 女<div class="ButtonGroup"><button class="Button Button--primary Button--blue save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div></div>';
		}
		else if("mood"==field_type)
		{
			var data='<div><div class="HeadlineField-input Input-wrapper"><input name="mood" class="Input" value="'+g_er_mood+'"></div><div class="HeadlineField-actions"><div class="ButtonGroup HeadlineField-buttonGroup"><button class="Button Button--primary Button--blue save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>';
		}
		else if("residence"==field_type)
		{
		    var data='<div><div class="HeadlineField-input Input-wrapper"><input name="residence" class="Input" value="'+g_er_residence+'"></div><div class="HeadlineField-actions"><div class="ButtonGroup HeadlineField-buttonGroup"><button class="Button Button--primary Button--blue save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>';
			$(this).parents(".Field-content").empty().append(data);
		}
		else if("job"==field_type)
		{
			var data='<div><div class="HeadlineField-input Input-wrapper"><input name="job" class="Input" value="'+g_er_job+'"></div><div class="HeadlineField-actions"><div class="ButtonGroup HeadlineField-buttonGroup"><button class="Button Button--primary Button--blue save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>';
		}
		else if("intro"==field_type)
		{
			var data='<div><textarea name="intro" rows="3" class="DescriptionField-input TextArea">'+g_er_intro+'</textarea><div class="DescriptionField-actions"><div class="ButtonGroup DescriptionField-buttonGroup"><button class="Button Button--primary Button--blue save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>';
		}
		$(this).parents(".Field-content").empty().append(data);
		checkProfileSave();
	});
		//ata-field-type="sexual"
}
function profileEdit()
{
    $("main").empty();
	var data='\
			<div class="ProfileEdit">\
			<div class="Card">\
			<div class="ProfileHeader-header">\
			<div class="UserCoverEditor">\
			<div>\
			<div class="UserCoverGuide">\
			<div class="UserCoverGuide-inner">\
			<div class="UserCoverGuide-buttonContainer">\
			<button class="Button DynamicColorButton" type="button"><svg viewBox="0 0 20 16" class="Icon Icon--camera Icon--left" width="14" height="16" aria-hidden="true" style="height: 16px; width: 14px;"><title></title><g><path d="M18.094 2H15s-1-2-2-2H7C6 0 5 2 5 2H2C0 2 0 3.967 0 3.967V14c0 2 2.036 2 2.036 2H17c3 0 3-1.983 3-1.983V4c0-2-1.906-2-1.906-2zM10 12c-1.933 0-3.5-1.567-3.5-3.5S8.067 5 10 5s3.5 1.567 3.5 3.5S11.933 12 10 12zm0 1.5c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm7.5-8c-.552 0-1-.448-1-1s.448-1 1-1 1 .448 1 1-.448 1-1 1z" fill-rule="evenodd"></path></g></svg>上传封面图片</button>\
			</div>\
			<div class="UserCoverGuide-dialog">\
			<h4 class="UserCoverGuide-dialogHead">上传一张图片，展示在这里</h4>\
			<div class="UserCoverGuide-dialogContent">\
			<p class="UserCoverGuide-dialogDescription">你可以使用自己的摄影作品、你喜欢的照片，或是任何能展现你特质的图片。</p>\
			<a href="https://www.danongling.com/question/21757507" target="_blank" rel="noopener noreferrer">哪里能找到可免费使用的优质图片？</a>\
			</div>\
			</div>\
			</div>\
			<ul class="UserCoverGuide-items">\
			</ul>\
			</div>\
			<div class="UserCover"></div>\
			</div>\
			<input type="file" accept="image/png,image/jpeg" style="display: none;">\
			</div></div>\
			<div class="ProfileHeader-main"><div>\
			<div class="UserAvatarEditor ProfileHeader-avatar">\
			<div class="UserAvatar">\
			<img id="id_avatar" class="Avatar Avatar--large UserAvatar-inner" width="160" height="160" src="'+g_er_avatar+'" srcset="'+g_er_avatar+'">\
			</div>\
			<div class="Mask UserAvatarEditor-mask">\
			<div class="Mask-mask Mask-mask--black UserAvatarEditor-maskInner">\
			</div>\
			<div class="Mask-content">\
			<svg class="Zi Zi--Camera UserAvatarEditor-cameraIcon" fill="currentColor" viewBox="0 0 24 24" width="36" height="36"><path d="M20.094 6S22 6 22 8v10.017S22 20 19 20H4.036S2 20 2 18V7.967S2 6 4 6h3s1-2 2-2h6c1 0 2 2 2 2h3.094zM12 16a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7zm0 1.5a5 5 0 1 0-.001-10.001A5 5 0 0 0 12 17.5zm7.5-8a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" fill-rule="evenodd"></path></svg>\
			<div class="UserAvatarEditor-maskInnerText">修改我的头像</div>\
			</div>\
			</div>\
			<input id="id_avatar_input" name="file" type="file" accept="image/png,image/jpeg" style="display: none;">\
			</div>\
			</div>\
			<div class="ProfileHeader-content">\
			<div class="ProfileHeader-contentHead">\
			<h1 class="ProfileHeader-title"><span class="ProfileHeader-name">'+g_er_name+'</span></h1>\
			<div class="ProfileHeader-expandActions ProfileEdit-expandActions">\
			<a class="Button Button--plain" type="button" href="/er/'+g_er_id+'">返回我的主页<svg viewBox="0 0 10 6" class="Icon ProfileEdit-arrowIcon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg></a>\
			</div>\
			</div>\
			<div class="ProfileEdit-fields">\
			<form class="Field"><h3 class="Field-label">性别</h3><div class="Field-content" data-field-type="sexual"><div><span class="Field-text">'+g_er_sexual_han+'</span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div></div></form>\
			<form class="Field"><h3 class="Field-label">一句话介绍</h3><div class="Field-content" data-field-type="mood"><div><span class="Field-text"><span class="RichText">'+g_er_mood+'</span></span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div></div></form>\
			<form class="Field"><h3 class="Field-label">居住地</h3><div class="Field-content" data-field-type="residence"><div><span class="Field-text"><span class="RichText">'+g_er_residence+'</span></span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div></div></form>\
			<form class="Field"><h3 class="Field-label">所在行业</h3><div class="Field-content" data-field-type="job"><div><span class="Field-text">'+g_er_job+'</span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div></div></form>\
			<form class="Field"><h3 class="Field-label">个人简介</h3><div class="Field-content" data-field-type="intro"><div class="DescriptionField-content"><span class="Field-text"><span class="RichText">'+g_er_intro+'</span></span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button"><svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>修改</button></div></div></form>\
			</div>\
			</div>\
			</div>\
			</div>\
			</div>';
    $("main").append(data);
	window.location.href="#edit";
	checkProfileModify();
}
function adjustChooseBox()
{
    var width=200;
    var height=200;
    var left=$("#preview_avatar").position().left+50;
    var top=$("#preview_avatar").position().top+50;
   
    var refLeft=$("#preview_avatar").position().left;
    var refTop=$("#preview_avatar").position().top;
    console.log(refLeft);
    console.log(refTop);
    /* 
    console.log($("#preview_avatar").offset().left);
    console.log($("#preview_avatar").offset().top);
    console.log($("#preview_avatar").position().left);
    console.log($("#preview_avatar").position().top);
    console.log($("#chooseBox").offset().left);
    console.log($("#chooseBox").offset().top);
    console.log($("#chooseBox").position().left);
    console.log($("#chooseBox").position().top);
    */
    
    var adjust=$("#adjust_choosebox").val();
    width=width+(adjust-50)*2;
    height=height+(adjust-50)*2;
    left=left-adjust+50;
    top=top-adjust+50;
    
    $('#chooseBox').css({
                    width:width+'px',
                    height:height+'px',
                    left:left+'px',
                    top:top+'px'
    });
    
    
    $('#chooseBox').mousedown(function (e) {
            var originX= e.offsetX;
            var originY= e.offsetY;
            left=$("#chooseBox").position().left;
            top=$("#chooseBox").position().top;
            console.log("mousedown");
            window.onmousemove=function (e) {
                //console.log("x=",originX,e.offsetX);
                //console.log("y=",originY,e.offsetY);
                //console.log($("#chooseBox").position().left);
                //console.log($("#chooseBox").position().top);
                $('#chooseBox').css({
                    position:'absolute',
                    left:left+e.offsetX-originX+'px',
                    top: top+e.offsetY-originY+'px'
                });              
                
                if($('#chooseBox').position().left<=refLeft){
                    $('#chooseBox').css({
                        left:refLeft+'px'
                    });
                }
                if($('#chooseBox').position().left>=refLeft+300-width){
                    $('#chooseBox').css({
                        left:refLeft+300-width+'px'
                    });
                }
                if($('#chooseBox').position().top<=refTop){
                    $('#chooseBox').css({
                        top:refTop+'px'
                    });
                }
                if($('#chooseBox').position().top>=refTop+300-height){
                    $('#chooseBox').css({
                        top:refTop+300-height+'px'
                    });
                }
                
                $('#chooseBox').mouseout(function () {
                    console.log("mouseout");
                    window.onmousemove=null;
                    return
                })
            };
            window.onmouseup= function () {
                console.log("onmouseup");
                window.onmousemove=null;
                return
            }
        });
}
//$(function(){
function checkAvatar(){
    $(".UserAvatarEditor").hover(
        function(){
            $(".Mask").removeClass("Mask-hidden");
        },
        function(){
            $(".Mask").addClass("Mask-hidden");
        }
    );
    
    $(".Mask-content").click(function(){
            $("#id_avatar_input").click();
            $("#id_avatar_input").on("change",function(){
               $("#upAvatarModal").modal('show');
                var objUrl = getObjectURL(this.files[0]);
                if (objUrl) {
                    //var image = new Image();
                    //image.src="/media/avatar/wudy1512464583.jpg";//objUrl;
                    //var cvs=document.getElementById("avatar_canvas");
                    //var ctx = cvs.getContext('2d');
                    //ctx.drawImage(image, 100, 100, 240, 240);  
                    $("#preview_avatar").attr("src", objUrl);
                    $("#adjust_choosebox").val(50);                    
                    
                    setTimeout(adjustChooseBox,1*1000);
                }
            });
    });
}
//});

function getObjectURL(file) {
    var url = null ;
    if (window.createObjectURL!=undefined) { // basic
        url = window.createObjectURL(file) ;
    } else if (window.URL!=undefined) { // mozilla(firefox)
        url = window.URL.createObjectURL(file) ;
    } else if (window.webkitURL!=undefined) { // webkit or chrome
        url = window.webkitURL.createObjectURL(file) ;
    }
    return url ;
}

/*
function dataURLtoBlob(dataurl) {
    var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
        bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
    while(n--){
        u8arr[n] = bstr.charCodeAt(n);
    }
    return new Blob([u8arr], {type:mime});
}
*/

function saveFile()
{
    var img=document.getElementById("preview_avatar");
    imgWidth=img.naturalWidth;
    var can=document.getElementById("avatar_canvas");
        //var btn=document.getElementById("btn");
        //var returnImg=document.getElementById("returnImg");
    var ctx=can.getContext("2d");
    var newX=($('#chooseBox').position().left-$('#preview_avatar').position().left)*(img.naturalWidth/300);
    var newY=($('#chooseBox').position().top-$('#preview_avatar').position().top)*(img.naturalHeight/300);
    var newWidth=newHeight=(200+($("#adjust_choosebox").val()-50)*2)*(img.naturalWidth/300);
    var newHeight=(200+($("#adjust_choosebox").val()-50)*2)*(img.naturalHeight/300);
    //console.log(img.naturalWidth);
    //console.log(img.naturalHeight);
    //console.log(newX,newY);
    //ctx.drawImage(img,newX,newY,200*3.45,200*2.6,0,0,200,200);
    ctx.drawImage(img,newX,newY,newWidth,newHeight,0,0,200,200);
    //var data=can.toDataURL("image/jpeg");
    //var blob = dataURLtoBlob(data);
    //console.log(blob);
    can.toBlob(function(blobUrl){
        console.log(blobUrl);
        fileUpload(blobUrl);
    },"image/jpeg");   
}

function fileUpload(file_info)
{
    var form_data = new FormData();
    //var file_info = $('#id_avatar_input')[0].files[0];
    form_data.append('imgfile',file_info,"image.jpg");
    //if(file_info==undefined)
    //alert('can`t select file');
    //return false
    //}
    $.ajax({
    url:"/ajax/upload/avatar/",
    type:'POST',
    data: form_data,
    processData: false,  // tell jquery not to process the data
    contentType: false, // tell jquery not to set contentType
    success: function(ret) {
            if("fail"!=ret)
            {
                $("#upAvatarModal").modal('hide');
                $("#id_avatar").attr("src",ret).attr("srcset",ret);
                console.log("fileupload success");
            }
            else
            {
                console.log("fileupload ail");
            }
        }
    }); // end ajax
}
function showProfileDetail()
{
    if("true"!=show_detailed)
    {
        var data='<div><div class="ProfileHeader-detail"><div class="ProfileHeader-detailItem"><span class="ProfileHeader-detailLabel">居住地</span><div class="ProfileHeader-detailValue"><span>'+g_er_residence+'</span></div></div><div class="ProfileHeader-detailItem"><span class="ProfileHeader-detailLabel">所在行业</span><div class="ProfileHeader-detailValue">'+g_er_job+'</div></div><div class="ProfileHeader-detailItem"><span class="ProfileHeader-detailLabel">个人简介</span><div class="RichText ProfileHeader-detailValue">'+g_er_intro+'</div></div></div></div>';
        $(".ProfileHeader-contentBody").css({"height":"129px"}).empty().append(data);
        $(".ProfileHeader-expandButton").empty().append('<svg viewBox="0 0 10 6" class="Icon ProfileHeader-arrowIcon is-active Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg>收起详细资料');
        show_detailed="true"
    }
    else
    {
        $(".ProfileHeader-contentBody").css({"height":"50px"}).empty().append(g_contentbody_data);
        $(".ProfileHeader-expandButton").empty().append('<svg viewBox="0 0 10 6" class="Icon ProfileHeader-arrowIcon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg>查看详细资料');
        show_detailed="false"
    }
}
function initElement()
{
	$("#MenuPopover").attr({"src":g_user_avatar,"srcset":g_user_avatar,"data-er-id":g_user_id});
	$(".ProfileHeader-name").text(g_er_name);
	$("#id_avatar").attr({"src":g_er_avatar,"srcset":g_er_avatar});
	$(".ProfileHeader-headline").text(g_er_mood);
    
    var job_element='<div class="ProfileHeader-infoItem"><div class="ProfileHeader-iconWrapper"><svg viewBox="0 0 20 18" class="Icon Icon--company" width="13" height="16" aria-hidden="true" style="height: 16px; width: 13px;"><title></title><g><path d="M15 3.998v-2C14.86.89 13.98 0 13 0H7C5.822 0 5.016.89 5 2v2l-3.02-.002c-1.098 0-1.97.89-1.97 2L0 16c0 1.11.882 2 1.98 2h16.033c1.1 0 1.98-.89 1.987-2V6c-.007-1.113-.884-2.002-1.982-2.002H15zM7 4V2.5s-.004-.5.5-.5h5c.5 0 .5.5.5.5V4H7z"></path></g></svg></div>'+g_er_job+'</div>'
	
	if("f"==g_er_sexual)
	{
		g_er_sexual_han="女";
		g_who="she";
		g_who_han="她";
	    var followed_text="关注她";
		var sexual_icon='<div class="ProfileHeader-infoItem"><div class="ProfileHeader-iconWrapper"><svg width="14" height="16" viewBox="0 0 12 16" class="Icon Icon--female" aria-hidden="true" style="height: 16px; width: 14px;"><title></title><g><path d="M6 0C2.962 0 .5 2.462.5 5.5c0 2.69 1.932 4.93 4.485 5.407-.003.702.01 1.087.01 1.087H3C1.667 12 1.667 14 3 14s1.996-.006 1.996-.006v1c0 1.346 2.004 1.346 1.998 0-.006-1.346 0-1 0-1S7.658 14 8.997 14c1.34 0 1.34-2-.006-2.006H6.996s-.003-.548-.003-1.083C9.555 10.446 11.5 8.2 11.5 5.5 11.5 2.462 9.038 0 6 0zM2.25 5.55C2.25 3.48 3.93 1.8 6 1.8c2.07 0 3.75 1.68 3.75 3.75C9.75 7.62 8.07 9.3 6 9.3c-2.07 0-3.75-1.68-3.75-3.75z" fill-rule="evenodd"></path></g></svg></div></div>';
	}
	else
	{
	    g_er_sexual_han="男";
		g_who="he";
		g_who_han="他";
		var followed_text="关注他";
		var sexual_icon='<div class="ProfileHeader-infoItem"><div class="ProfileHeader-iconWrapper"><svg width="14" height="16" viewBox="0 0 14 14" class="Icon Icon--male" aria-hidden="true" style="height: 16px; width: 14px;"><title></title><g><path d="M3.025 10.64c-1.367-1.366-1.367-3.582 0-4.95 1.367-1.366 3.583-1.366 4.95 0 1.367 1.368 1.367 3.584 0 4.95-1.367 1.368-3.583 1.368-4.95 0zm10.122-9.368c-.002-.414-.34-.75-.753-.753L8.322 0c-.413-.002-.746.33-.744.744.002.413.338.75.75.752l2.128.313c-.95.953-1.832 1.828-1.832 1.828-2.14-1.482-5.104-1.27-7.013.64-2.147 2.147-2.147 5.63 0 7.777 2.15 2.148 5.63 2.148 7.78 0 1.908-1.91 2.12-4.873.636-7.016l1.842-1.82.303 2.116c.003.414.34.75.753.753.413.002.746-.332.744-.745l-.52-4.073z" fill-rule="evenodd"></path></g></svg></div></div>';
	}
    g_contentbody_data='<div class="ProfileHeader-info">'+job_element+sexual_icon+'</div>';
	$(".ProfileHeader-contentBody").empty().append(g_contentbody_data);
	if(g_er_id==g_user_id)
	{
	    g_who="me";
		g_who_han="我";
		var data='<button class="Button ProfileHeader-expandButton Button--plain" type="button" onclick="showProfileDetail()"><svg viewBox="0 0 10 6" class="Icon ProfileHeader-arrowIcon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg>查看详细资料</button>\
		<div class="ProfileButtonGroup ProfileHeader-buttons"><button class="Button Button--blue" type="button" onclick="profileEdit()">编辑个人资料</button></div>';
	}
	else
	{
		if("true"==g_followed)
		{
			var followed_text="已关注";
			var followed_status="true";
			var followed_button_class="Button--grey";
		}
		else
		{
			var followed_status="false";
			var followed_button_class="Button--blue";
		}
		var data='<button class="Button ProfileHeader-expandButton Button--plain" type="button" onclick="showProfileDetail()"><svg viewBox="0 0 10 6" class="Icon ProfileHeader-arrowIcon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg>查看详细资料</button>\
					<div class="MemberButtonGroup ProfileButtonGroup ProfileHeader-buttons">\
					<button class="Button FollowButton Button--primary '+followed_button_class+'" type="button" data-er-id="'+g_er_id+'" data-who="'+g_who+'" data-follow-type="people" data-followed='+followed_status+'>'+followed_text+'</button>\
					<button class="Button Button--grey Button--withIcon Button--withLabel" type="button" data-toggle="modal" data-target="#letterModal"><span style="display: inline-flex; align-items: center;">&#8203;<svg class="Zi Zi--Comments Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M11 2c5.571 0 9 4.335 9 8 0 6-6.475 9.764-11.481 8.022-.315-.07-.379-.124-.78.078-1.455.54-2.413.921-3.525 1.122-.483.087-.916-.25-.588-.581 0 0 .677-.417.842-1.904.064-.351-.14-.879-.454-1.171A8.833 8.833 0 0 1 2 10c0-3.87 3.394-8 9-8zm10.14 9.628c.758.988.86 2.009.86 3.15 0 1.195-.619 3.11-1.368 3.938-.209.23-.354.467-.308.722.12 1.073.614 1.501.614 1.501.237.239-.188.562-.537.5-.803-.146-1.495-.42-2.546-.811-.29-.146-.336-.106-.563-.057-2.043.711-4.398.475-6.083-.927 5.965-.524 8.727-3.03 9.93-8.016z" fill-rule="evenodd"></path></svg></span>发私信</button>\
					</div>';
	}
    $(".ProfileHeader-contentFooter").append(data);
	
	answers_active="";
	asks_active="";
	posts_active="";
	following_active="";
	
	if ("answers"==g_command)
	{
	    answers_active="is-active";
        appendAnswerElement();
	}
    else if("asks"==g_command)
	{
		asks_active="is-active";
        appendQuestionElement();
	}
	else if("posts"==g_command)
	{
		posts_active="is-active";
        appendQuestionElement();
	}
    else if("following"==g_command)
	{
		following_active="is-active";
        appendFollowElement();
	}
    else 
        console.log("false");
		
	var tabs='<li role="tab" class="Tabs-item" aria-controls="Profile-answers"><a class="Tabs-link '+answers_active+'" href="/er/'+g_er_id+'/answers/">回答<span class="Tabs-meta">'+g_answers_num+'</span></a></li>\
				<li role="tab" class="Tabs-item" aria-controls="Profile-asks"><a class="Tabs-link '+asks_active+'" href="/er/'+g_er_id+'/asks/">提问<span class="Tabs-meta">'+g_questions_num+'</span></a></li>\
				<li role="tab" class="Tabs-item" aria-controls="Profile-posts"><a class="Tabs-link '+posts_active+'" href="/er/'+g_er_id+'/posts/">文章<span class="Tabs-meta">0</span></a></li>\
				<li role="tab" class="Tabs-item" aria-controls="Profile-following"><a class="Tabs-link '+following_active+'" href="/er/'+g_er_id+'/following/">关注<span class="Tabs-meta"><svg viewBox="0 0 10 6" class="Icon ProfileMain-tabIcon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg></span></a></li>';
	$(".Tabs.ProfileMain-tabs").append(tabs);
	
	
	var data='<div class="NumberBoard FollowshipCard-counts NumberBoard--divider">\
		<a class="Button NumberBoard-item Button--plain" type="button" href="/er/'+g_er_id+'/following/followtos"><div class="NumberBoard-itemInner"><div class="NumberBoard-itemName">关注了</div><strong class="NumberBoard-itemValue">'+g_followtos_num+'</strong></div></a>\
		<a class="Button NumberBoard-item Button--plain" type="button" href="/er/'+g_er_id+'/following/followers"><div class="NumberBoard-itemInner"><div class="NumberBoard-itemName">关注者</div><strong class="NumberBoard-itemValue NumberBoard-value" data-update-value-type="people-followed">'+g_followers_num+'</strong></div></a>\
		</div>';
	$(".Card.FollowshipCard").append(data);
	
	var data='<a class="Profile-lightItem" href="/er/'+g_er_id+'/following/topics"><span class="Profile-lightItemName">关注的话题</span><span class="Profile-lightItemValue">'+g_followtopics_num+'</span></a>\
			    <a class="Profile-lightItem" href="/er/'+g_er_id+'/following/questions"><span class="Profile-lightItemName">关注的问题</span><span class="Profile-lightItemValue">'+g_followquestions_num+'</span></a>';
	
	$(".Profile-lightList").append(data);
	
}

function initData()
{
    show_detailed="false";
    
	var str_main_data=$("main").attr("data-dfs-main");
	console.log(str_main_data);
	var main_data=JSON.parse(str_main_data);//str_main_data.parseJSON();
	var str_ext_data=$("main").attr("data-dfs-ext");
	console.log(str_ext_data);
	var ext_data=JSON.parse(str_ext_data);
	
	g_user_id=main_data.user_id;
	g_user_name=main_data.user_name;
	g_user_avatar=main_data.user_avatar;
	
	g_er_id=main_data.er_id;
    g_er_name=main_data.er_name;
    g_er_avatar=main_data.er_avatar;
    g_er_mood=main_data.er_mood;
	g_er_sexual=main_data.er_sexual;
	g_er_residence=main_data.er_residence;
	g_er_job=main_data.er_job;
	g_er_intro=main_data.er_intro;
	
	g_followed=main_data.followed;
	g_command=main_data.command;
    g_subcmd=main_data.subcmd;
	
	g_questions_num=ext_data.questions_num;
	g_answers_num=ext_data.answers_num;
	g_followtos_num=ext_data.followtos_num;
	g_followers_num=ext_data.followers_num;
	g_followtopics_num=ext_data.followtopics_num;
	g_followquestions_num=ext_data.followquestions_num;
}
function init()
{
    checkAvatar();
	initData();
	initElement();     
    appendLetterModal();
    setLetterReceiver(g_er_id,g_er_name);    
    checkSets();
    if("#edit"==location.hash)
        profileEdit();

}
</script>
</body>
</html>