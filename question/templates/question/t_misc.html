<!DOCTYPE html>
<html>
<head>
{%load static %}
<meta http-equiv="X-UA-Compatible" content="IE=11">
<meta charset="utf-8">
<title>首页 - 大大大</title>
<link rel="stylesheet" href="{% static 'common/bootstrap-3.3.7/css/bootstrap.css' %}">
<link rel="stylesheet" href="{% static 'common/bootstrap-select-1.12.4/css/bootstrap-select.css' %}">
<link rel="stylesheet" href="{% static 'common/summernote-0.8.8/summernote.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'common/z_main.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'common/main.css' %}">
    
<script src="{%static 'common/jquery.js' %}"></script>
<script src="{% static 'common/bootstrap-3.3.7/js/bootstrap.js' %}"></script>
<script src="{% static 'common/bootstrap-select-1.12.4/js/bootstrap-select.js' %}"></script>
<script src="{% static 'common/bootstrap-select-1.12.4/js/i18n/defaults-zh_CN.js' %}"></script>
<script src="{% static 'common/summernote-0.8.8/summernote.js' %}"></script>
<script src="{% static 'common/summernote-0.8.8/lang/summernote-zh-CN.js' %}"></script>
<script src="{% static 'common/main.js' %}"></script>
    
<script>
function setCookie(name,value,secs)
{
    var exp = new Date();
    exp.setTime(exp.getTime() + secs*1000);
    document.cookie = name + "="+ escape (value) + ";expires=" + exp.toGMTString();
}
function getCookie(name)
{
    var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
    if(arr=document.cookie.match(reg))
        return (arr[2]);
    else
        return null;
}
function delCookie(name)
{
    var exp = new Date();
    exp.setTime(exp.getTime() - 1);
    var cval=getCookie(name);
    if(cval!=null)
        document.cookie= name + "="+cval+";expires="+exp.toGMTString();
}
function countDown()
{
    if(0==g_countdown_secs)
    {
        $(".SignFlow-smsInputButton").removeClass("is-counting").text("获取短信验证码");
        delCookie("countdown");
    }
    else
    {
        g_countdown_secs-=1;
        $("#counting-num").text(g_countdown_secs);
        setCookie("countdown",g_countdown_secs,g_countdown_secs);
        setTimeout("countDown()",1000);        
    }
}
function checkSmsSend()
{
    $(".SignFlow-smsInputButton").off("click");
    $(".SignFlow-smsInputButton").click(function(){
        var is_counting=$(this).hasClass("is-counting");
        if(is_counting)
        {
            console.log("counting,can`t click");
        }
        else
        {
            var value=$("input[name='phoneNo']").val();
            var reg = /^1[3|4|5|7|8][0-9]{9}$/;
            var is_phone_no=reg.test(value)
            if(is_phone_no)
            {
                g_countdown_secs=59;
                $(this).addClass("is-counting").empty().append('<span id="counting-num">59</span>秒后可重发');
                setTimeout("countDown()",1000);
                setCookie("countdown",g_countdown_secs,g_countdown_secs);
                $.post("/ajax/send_sms/",{"phone_no":value,"type":"password_reset"},function(ret){
                    if("fail"!=ret)
                    {
                        if("unregistered"==ret)
                            $(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("该手机号未注册，无此用户");
                    }
                });
            }
            else
            {
                console.log("phone no error");
                $(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("手机号格式错误");
            }
        }
        
    });
}
function checkErrorMask()
{
    $(".SignFlowInput-errorMask").click(function(){
        console.log("error mask click");
        $(this).addClass("SignFlowInput-errorMask--hidden");
        $(this).siblings(".Input-wrapper").children(".Input").val("").focus();
    });
}
function checkNextStep()
{
    var result=true;

    var phone_no=$("input[name='phoneNo']").val();
    var reg = /^1[3|4|5|7|8][0-9]{9}$/;
    var is_check=reg.test(phone_no);
    if(!is_check)
    {
        console.log("phone no error");
        $(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("手机号格式错误");
        result=false;
    }

    var ver_code=$("input[name='digits']").val();
    var reg = /^[0-9]{6}$/;
    var is_check=reg.test(ver_code);
    if(!is_check)
    {
        console.log("verification code error");
        $(".SignFlow-smsInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("验证码格式错误");
        result=false;
    }
    if(false==result)
        return false;
    $.post("/ajax/check_sms/",{"phone_no":phone_no,"type":"password_reset","ver_code":ver_code},function(ret){
        if("fail"!=ret)
        {
            if("unregistered"==ret)
            {
                $(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("该手机号未注册，无此用户");
            }
            else if("ver_code_error"==ret)
            {
                $(".SignFlow-smsInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("验证码错误");
            }
            else if("ver_code_ok"==ret)
            {
                console.log("check next step ok");
            }
        }
    });
        
    return false;
}
function init()
{
    g_step=0;
    g_error_type=$("main").attr("data-error-type");
    if("e_ver_code"==g_error_type)
    {
        $("#errorText").text("验证码错误，注册失败，请尝试返回注册页面重新注册");
        $("#returnLink").text("返回重新注册");
        setTimeout(function(){window.location.href="/";},10*1000);
    }
    else if("e_u_p"==g_error_type)
    {
        $("#errorText").text("用户名密码错误，登录失败，请尝试返回登录页面重新登录");
        $("#returnLink").text("返回重新登录");
        setTimeout(function(){window.location.href="/";},10*1000);
    }
    else if("e_registered"==g_error_type)
    {
        $("#errorText").text("该手机号已被注册，请尝试找回密码或更换手机号重新注册");
        $("#returnLink").text("返回重新注册");
        setTimeout(function(){window.location.href="/";},10*1000);
    }
    checkSmsSend();
    checkErrorMask();
    var secs=getCookie("countdown");
    if(null!=secs)
    {
        g_countdown_secs=secs;
        $(".SignFlow-smsInputButton").addClass("is-counting").empty().append('<span id="counting-num">59</span>秒后可重发');
        setTimeout("countDown()",1000);
    }
}
</script>
</head>

<!--<body class="Entry-body" style="background-color:#ffffff">-->
<body class="" style="background-color:#ffffff">
<div id="root">
<div data-zop-usertoken="{}" data-reactroot="">
<div class="LoadingBar"></div>
<div>
<header role="banner" class="Sticky AppHeader" data-za-module="TopNavBar">
<div class="AppHeader-inner">
<a href="//www.zhihu.com" aria-label="知乎"><svg viewBox="0 0 200 91" class="Icon ZhihuLogo Icon--logo" style="height:30px;width:64px" width="64" height="30" aria-hidden="true"><title></title><g><path d="M53.29 80.035l7.32.002 2.41 8.24 13.128-8.24h15.477v-67.98H53.29v67.978zm7.79-60.598h22.756v53.22h-8.73l-8.718 5.473-1.587-5.46-3.72-.012v-53.22zM46.818 43.162h-16.35c.545-8.467.687-16.12.687-22.955h15.987s.615-7.05-2.68-6.97H16.807c1.09-4.1 2.46-8.332 4.1-12.708 0 0-7.523 0-10.085 6.74-1.06 2.78-4.128 13.48-9.592 24.41 1.84-.2 7.927-.37 11.512-6.94.66-1.84.785-2.08 1.605-4.54h9.02c0 3.28-.374 20.9-.526 22.95H6.51c-3.67 0-4.863 7.38-4.863 7.38H22.14C20.765 66.11 13.385 79.24 0 89.62c6.403 1.828 12.784-.29 15.937-3.094 0 0 7.182-6.53 11.12-21.64L43.92 85.18s2.473-8.402-.388-12.496c-2.37-2.788-8.768-10.33-11.496-13.064l-4.57 3.627c1.363-4.368 2.183-8.61 2.46-12.71H49.19s-.027-7.38-2.372-7.38zm128.752-.502c6.51-8.013 14.054-18.302 14.054-18.302s-5.827-4.625-8.556-1.27c-1.874 2.548-11.51 15.063-11.51 15.063l6.012 4.51zm-46.903-18.462c-2.814-2.577-8.096.667-8.096.667s12.35 17.2 12.85 17.953l6.08-4.29s-8.02-11.752-10.83-14.33zM199.99 46.5c-6.18 0-40.908.292-40.953.292v-31.56c1.503 0 3.882-.124 7.14-.376 12.773-.753 21.914-1.25 27.427-1.504 0 0 3.817-8.496-.185-10.45-.96-.37-7.24 1.43-7.24 1.43s-51.63 5.153-72.61 5.64c.5 2.756 2.38 5.336 4.93 6.11 4.16 1.087 7.09.53 15.36.277 7.76-.5 13.65-.76 17.66-.76v31.19h-41.71s.88 6.97 7.97 7.14h33.73v22.16c0 4.364-3.498 6.87-7.65 6.6-4.4.034-8.15-.36-13.027-.566.623 1.24 1.977 4.496 6.035 6.824 3.087 1.502 5.054 2.053 8.13 2.053 9.237 0 14.27-5.4 14.027-14.16V53.93h38.235c3.026 0 2.72-7.432 2.72-7.432z" fill-rule="evenodd"></path></g></svg></a>
<nav role="navigation" class="AppHeader-nav">
<a class="AppHeader-navItem" href="//www.zhihu.com/">首页</a>
<a class="AppHeader-navItem" href="//www.zhihu.com/explore">发现</a>
<a href="//www.zhihu.com/topic" class="AppHeader-navItem">话题</a>
</nav>
<div class="SearchBar" role="search">
<div class="SearchBar-toolWrapper">
<form class="SearchBar-tool">
<div>
<div class="Popover">
<div class="SearchBar-input Input-wrapper Input-wrapper--grey">
<input type="text" maxlength="100" value="" autocomplete="off" role="combobox" aria-expanded="false" aria-autocomplete="list" aria-activedescendant="AutoComplet-4926-2225--1" id="Popover-4926-97804-toggle" aria-haspopup="true" aria-owns="Popover-4926-97804-content" class="Input" placeholder="搜索你感兴趣的内容…">
<div class="Input-after">
<button aria-label="搜索" type="button" class="Button SearchBar-searchIcon Button--primary"><svg viewBox="0 0 16 16" class="Icon Icon--search" style="height:16px;width:16px" width="16" height="16" aria-hidden="true"><title></title><g><path d="M12.054 10.864c.887-1.14 1.42-2.57 1.42-4.127C13.474 3.017 10.457 0 6.737 0S0 3.016 0 6.737c0 3.72 3.016 6.737 6.737 6.737 1.556 0 2.985-.533 4.127-1.42l3.103 3.104c.765.46 1.705-.37 1.19-1.19l-3.103-3.104zm-5.317.925c-2.786 0-5.053-2.267-5.053-5.053S3.95 1.684 6.737 1.684 11.79 3.95 11.79 6.737 9.522 11.79 6.736 11.79z"></path></g></svg></button>
</div>
</div>
</div>
</div>
</form>
</div>
</div>
<div class="AppHeader-userInfo">
<div class="AppHeader-profile">
<div><button type="button" class="Button AppHeader-login Button--blue">登录</button><button type="button" class="Button Button--primary Button--blue">加入知乎</button></div>
</div>
</div>
</div>
</header>
</div>

<main role="main" class="App-main">

<!--<div class="SignFlowHomepage">
<div class="SignFlowHomepage-content">
<div class="Card SignContainer-content">
<div class="SignFlowHeader" style="padding-bottom:5px"><svg viewBox="0 0 200 91" class="Icon ZhihuLogo Icon--logo" style="height:65.625px;width:140px" width="140" height="65.625" aria-hidden="true"><title></title><g><path d="M53.29 80.035l7.32.002 2.41 8.24 13.128-8.24h15.477v-67.98H53.29v67.978zm7.79-60.598h22.756v53.22h-8.73l-8.718 5.473-1.587-5.46-3.72-.012v-53.22zM46.818 43.162h-16.35c.545-8.467.687-16.12.687-22.955h15.987s.615-7.05-2.68-6.97H16.807c1.09-4.1 2.46-8.332 4.1-12.708 0 0-7.523 0-10.085 6.74-1.06 2.78-4.128 13.48-9.592 24.41 1.84-.2 7.927-.37 11.512-6.94.66-1.84.785-2.08 1.605-4.54h9.02c0 3.28-.374 20.9-.526 22.95H6.51c-3.67 0-4.863 7.38-4.863 7.38H22.14C20.765 66.11 13.385 79.24 0 89.62c6.403 1.828 12.784-.29 15.937-3.094 0 0 7.182-6.53 11.12-21.64L43.92 85.18s2.473-8.402-.388-12.496c-2.37-2.788-8.768-10.33-11.496-13.064l-4.57 3.627c1.363-4.368 2.183-8.61 2.46-12.71H49.19s-.027-7.38-2.372-7.38zm128.752-.502c6.51-8.013 14.054-18.302 14.054-18.302s-5.827-4.625-8.556-1.27c-1.874 2.548-11.51 15.063-11.51 15.063l6.012 4.51zm-46.903-18.462c-2.814-2.577-8.096.667-8.096.667s12.35 17.2 12.85 17.953l6.08-4.29s-8.02-11.752-10.83-14.33zM199.99 46.5c-6.18 0-40.908.292-40.953.292v-31.56c1.503 0 3.882-.124 7.14-.376 12.773-.753 21.914-1.25 27.427-1.504 0 0 3.817-8.496-.185-10.45-.96-.37-7.24 1.43-7.24 1.43s-51.63 5.153-72.61 5.64c.5 2.756 2.38 5.336 4.93 6.11 4.16 1.087 7.09.53 15.36.277 7.76-.5 13.65-.76 17.66-.76v31.19h-41.71s.88 6.97 7.97 7.14h33.73v22.16c0 4.364-3.498 6.87-7.65 6.6-4.4.034-8.15-.36-13.027-.566.623 1.24 1.977 4.496 6.035 6.824 3.087 1.502 5.054 2.053 8.13 2.053 9.237 0 14.27-5.4 14.027-14.16V53.93h38.235c3.026 0 2.72-7.432 2.72-7.432z" fill-rule="evenodd"></path></g></svg>
<div class="SignFlowHeader-slogen">登录知乎，发现更大的世界</div>
</div>
<div class="1SignContainer-inner">

<div class="1Register">
<div>
<div class="Register-content">
<form novalidate="" class="SignFlow" action="" method="post" onsubmit="return checkRegisterValid()">
{% csrf_token %}
<div class="SignFlow-account">
<div class="SignFlowInput SignFlow-accountInputContainer">
<div class="SignFlow-accountInput Input-wrapper"><input type="tel" value="" name="regPhoneNo" class="Input" placeholder="手机号"></div>
<div class="SignFlowInput-errorMask SignFlowInput-requiredErrorMask SignFlowInput-errorMask--hidden"></div>
</div>
</div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
</div>-->


<div class="Step SignContainer-content">
<div class="Step-inner PasswordReset">
<form novalidate="" class="PasswordReset-step" action="" method="post" onsubmit="return checkNextStep()">
<div class="StepHeader">
<h1 class="StepHeader-title">找回密码</h1>
<h2 class="StepHeader-subtitle">验证码已发送至你的注册手机</h2>
</div>

<div class="SignFlow-account">
<div class="SignFlowInput SignFlow-accountInputContainer">
<div class="SignFlow-accountInput Input-wrapper"><input type="tel" value="" name="phoneNo" class="Input" placeholder="手机号"></div>
<div class="SignFlowInput-errorMask SignFlowInput-requiredErrorMask SignFlowInput-errorMask--hidden"></div>
</div>
</div>

<div class="Register-SMSInput">
<div class="SignFlow SignFlow-smsInputContainer">
<div class="SignFlowInput SignFlow-smsInput">
<div class="Input-wrapper"><input type="number" value="" name="digits" class="Input" placeholder="输入 6 位短信验证码"></div>
<div class="SignFlowInput-errorMask SignFlowInput-requiredErrorMask SignFlowInput-errorMask--hidden"></div>
</div>
<button class="Button CountingDownButton SignFlow-smsInputButton Button--plain" type="button">获取短信验证码</button>
</div>
</div>



<button type="submit" class="Button PasswordReset-nextStep Button--primary Button--blue">下一步</button>

</form>
</div>
</div>
</main>
</div>
</div>

</body>

</html>