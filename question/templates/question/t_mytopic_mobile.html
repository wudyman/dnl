<!DOCTYPE html>
<html>

<head>
{%load static %}
<meta charset="utf-8">
<title>设置 - 大农令</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover">
<meta name="renderer" content="webkit">
<meta name="force-rendering" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">


<link rel="stylesheet" href="{% static 'common/bootstrap-3.3.7/css/bootstrap.css' %}">
<link rel="stylesheet" href="{% static 'common/bootstrap-select-1.12.4/css/bootstrap-select.css' %}">
<link rel="stylesheet" href="{% static 'common/summernote-0.8.8/summernote.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'common/mobile_z_main.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'common/mobile_main.css' %}">

<script src="{%static 'common/jquery.js' %}"></script>
<script src="{% static 'common/bootstrap-3.3.7/js/bootstrap.js' %}"></script>
<script src="{% static 'common/bootstrap-select-1.12.4/js/bootstrap-select.js' %}"></script>
<script src="{% static 'common/bootstrap-select-1.12.4/js/i18n/defaults-zh_CN.js' %}"></script>
<script src="{% static 'common/summernote-0.8.8/summernote.js' %}"></script>
<script src="{% static 'common/summernote-0.8.8/lang/summernote-zh-CN.js' %}"></script>
<script src="{% static 'common/mobile_main.js' %}"></script>

<script>
function followTopics()
{
    $("a[name='follow']").off("click");
    $("a[name='follow']").on("click",function(){
        var element=$(this);
        var topic_id=element.attr("data-topic-id");
        if("true"==element.attr("data-followed"))
        {
            $.post("/ajax/topic_follow/0/"+topic_id+"/",function(ret){
                if("fail"!=ret)
                {
                    element.removeClass("zg-unfollow").addClass("zg-follow").text("关注");
                    element.attr("data-followed","false");
                    //updateValue("topic-followed",ret);
                }
            }); 
        }
        else
        {
            $.post("/ajax/topic_follow/1/"+topic_id+"/",function(ret){
                if("fail"!=ret)
                {
                    element.removeClass("zg-follow").addClass("zg-unfollow").text("取消关注");
                    element.attr("data-followed","true");
                    //update_value("topic-followed",ret);
                }
            });  
        }
    });
}
function appendTopicElement(ret)
{
    for( var i in ret)
    {
        var topic_id=ret[i][0];
        var topic_name=ret[i][1];
        var topic_avatar=ret[i][2];
        var topic_detail=ret[i][3];
        var topic_question_nums=ret[i][4];
        var topic_follower_nums=ret[i][5];
        var topic_pub_date=ret[i][6];
        var topic_followed=ret[i][7];
        
        if(topic_followed)
            var follow_button_data='<button class="Button Button--grey FollowButton" type="button" data-follow-type="topic" data-topic-id="'+topic_id+'" data-followed="true">已关注</button>';
        else
            var follow_button_data='<button class="Button Button--blue FollowButton" type="button" data-follow-type="topic" data-topic-id="'+topic_id+'" data-followed="false">关注话题</button>';
        
        var data='<div class="List-item">\
                    <div class="ContentItem">\
                    <div class="ContentItem-main">\
                    <div class="ContentItem-image">\
                    <span class="TopicLink TopicItem-avatar">\
                    <a class="TopicLink-link" target="_blank" href="/topic/'+topic_id+'">\
                    <img class="Avatar Avatar--large TopicLink-avatar" width="60" height="60" src="'+topic_avatar+'"  alt="'+topic_name+'" data-author-id="'+topic_id+'" data-toggle="popover" data-placement="bottom" data-trigger="manual" data-content="null" data-html="true">\
                    </a>\
                    </span>\
                    </div>\
                    <div class="ContentItem-head">\
                    <h2 class="ContentItem-title">\
                    <div class="TopicItem-title">\
                    <span class="TopicLink TopicItem-name">\
                    <a class="TopicLink-link" target="_blank" href="/er/'+topic_id+'"><span class="RichText">'+topic_name+'</span></a>\
                    </span>\
                    </div>\
                    </h2>\
                    <div class="ContentItem-meta">\
                    <div>\
                    <div class="ContentItem-status">\
                    <div class="ContentItem-statusItem">'+topic_detail+'</div>\
                    </div>\
                    </div>\
                    </div>\
                    </div>\
                    <div class="ContentItem-extra">'+follow_button_data+'</div>\
                    </div>\
                    </div>\
                    </div>\
                    ';
        $("#feedArea").append(data);
    }
} 
function getMoreData() {
    var nums=g_last_getmoredata_index;//$('.Setting-item').length;
    var order=1;//pub_date
    var start=nums;
    var end=start+STEP*2;
    var bIsGetAll=0;
    $.get('/ajax/topics/'+bIsGetAll+'/'+start+'/'+end+'/',function(ret){
        if("fail"!=ret)
        {
            appendTopicElement(ret); 
            followTopics();            
            checkSets();
            g_last_getmoredata_index+=STEP*2;
        }
        setLockScrollMoreData("false");
    });
} 
function initElement()
{
    if("true"==g_logged)
        $("#myfollow").attr("href","/er/"+g_user_id+"/following/topics/");
}
function initData()
{
    g_last_getmoredata_index=0;
	var str_main_data=$("main").attr("data-dfs-main");
	console.log(str_main_data);
	var main_data=JSON.parse(str_main_data);//str_main_data.parseJSON();
	g_logged=main_data.logged;
    if("true"==g_logged)
    {
        g_user_id=main_data.user_id;
        g_user_name=main_data.user_name;
        g_user_avatar=main_data.user_avatar;
    }	
} 
function init()
{
    initData();
    initElement();
    getMoreData();
    checkSets();
    //appendLetterModal();
}
</script>
</head>

<body class="Mobile-body">
<div id="root">
<div class="App">
<div class="LoadingBar"></div>
<div>

<header class="Sticky MobileAppHeader" style="line-height: 50px;">
<div class="MobileAppHeader-inner">
<a class="MobileAppHeader-logo" href="/" aria-label="大农令"><svg viewBox="0 0 200 91" width="56" height="28" fill="#0f88eb"><title></title><g><path d="M53.29 80.035l7.32.002 2.41 8.24 13.128-8.24h15.477v-67.98H53.29v67.978zm7.79-60.598h22.756v53.22h-8.73l-8.718 5.473-1.587-5.46-3.72-.012v-53.22zM46.818 43.162h-16.35c.545-8.467.687-16.12.687-22.955h15.987s.615-7.05-2.68-6.97H16.807c1.09-4.1 2.46-8.332 4.1-12.708 0 0-7.523 0-10.085 6.74-1.06 2.78-4.128 13.48-9.592 24.41 1.84-.2 7.927-.37 11.512-6.94.66-1.84.785-2.08 1.605-4.54h9.02c0 3.28-.374 20.9-.526 22.95H6.51c-3.67 0-4.863 7.38-4.863 7.38H22.14C20.765 66.11 13.385 79.24 0 89.62c6.403 1.828 12.784-.29 15.937-3.094 0 0 7.182-6.53 11.12-21.64L43.92 85.18s2.473-8.402-.388-12.496c-2.37-2.788-8.768-10.33-11.496-13.064l-4.57 3.627c1.363-4.368 2.183-8.61 2.46-12.71H49.19s-.027-7.38-2.372-7.38zm128.752-.502c6.51-8.013 14.054-18.302 14.054-18.302s-5.827-4.625-8.556-1.27c-1.874 2.548-11.51 15.063-11.51 15.063l6.012 4.51zm-46.903-18.462c-2.814-2.577-8.096.667-8.096.667s12.35 17.2 12.85 17.953l6.08-4.29s-8.02-11.752-10.83-14.33zM199.99 46.5c-6.18 0-40.908.292-40.953.292v-31.56c1.503 0 3.882-.124 7.14-.376 12.773-.753 21.914-1.25 27.427-1.504 0 0 3.817-8.496-.185-10.45-.96-.37-7.24 1.43-7.24 1.43s-51.63 5.153-72.61 5.64c.5 2.756 2.38 5.336 4.93 6.11 4.16 1.087 7.09.53 15.36.277 7.76-.5 13.65-.76 17.66-.76v31.19h-41.71s.88 6.97 7.97 7.14h33.73v22.16c0 4.364-3.498 6.87-7.65 6.6-4.4.034-8.15-.36-13.027-.566.623 1.24 1.977 4.496 6.035 6.824 3.087 1.502 5.054 2.053 8.13 2.053 9.237 0 14.27-5.4 14.027-14.16V53.93h38.235c3.026 0 2.72-7.432 2.72-7.432z" fill-rule="evenodd"></path></g></svg></a>
{% ifequal logged 'true' %}
<div class="MobileAppHeader-actions">
<a class="MobileAppHeader-downloadLink" href="https://www.danongling.com/app?auto_download=true&amp;utm_source=zhihu&amp;utm_campaign=guest_feed&amp;utm_content=guide">下载 App</a>
<div class="MobileAppHeader-navItem MobileAppHeader-moreIconWrapper">
<span class="MobileAppHeader-expandBtn"><svg class="Zi Zi--More" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M3.5 5h16a1.5 1.5 0 0 1 0 3h-16a1.5 1.5 0 0 1 0-3zm0 6h16a1.5 1.5 0 0 1 0 3h-16a1.5 1.5 0 0 1 0-3zm0 6h16a1.5 1.5 0 0 1 0 3h-16a1.5 1.5 0 0 1 0-3z" fill-rule="evenodd"></path></svg></span>
</div>
</div>
{% else %}
<div class="MobileAppHeader-actions"><a class="MobileAppHeader-downloadLink" href="https://www.danongling.com/app?auto_download=true&amp;utm_source=zhihu&amp;utm_campaign=guest_feed&amp;utm_content=guide">下载 App</a>
<a class="MobileAppHeader-authLink" href="/signinup/?next=/">注册或登录</a></div>
{% endifequal %}
</div>
</header>

</div>

<main role="main" class="App-main" data-dfs-main='{"logged":"{{logged}}","user_id":"{{user.id}}","user_name":"{{user.first_name}}","user_avatar":"{{user.userprofile.avatar}}"}'>

<div id="mytopic">

{% ifequal logged 'true' %}
<div class="Card">
<div class="Card-header">
<div class="Card-headerText">
<a id="myfollow" target="_blank" href="">已关注的话题</a> 
</div>
</div>
<div class="Card-section">
{% if mytopic_list %}
{% for topic in mytopic_list %}
<div class="Tag FollowedTopic 1QuestionTopic" data-topic-id="{{ topic.id }}">
<span class="Tag-content">
<a class="1TopicLink" href="/topic/{{ topic.id }}">{{ topic.name }}</a>
</span>
</div>
{% endfor %}
{% endif %} 
</div>  
</div>
{% endifequal %}

<div class="Card">
<div class="Card-header">
<div class="Card-headerText">
全部的话题
</div>
</div>
<div class="List">
<div id="feedArea" class="">
<!--<div class="List-item SearchItem">-->
</div>
</div>
</div>

<!--<button class="OpenInAppButton OpenInApp is-shown">App 内打开</button>-->

</div>
</main>

</div>
</div>

<!-- 提问（Modal） -->
<div class="modal fade" id="askModal" tabindex="-1" role="dialog" aria-labelledby="askModalLabel" aria-hidden="true">
	<div class="modal-dialog askmodal">
        <div class="Modal-inner">
            <h3 class="Modal-title" id="askModalLabel">写下你的问题</h3>
            <div class="Modal-subtitle">描述精确的问题更易得到解答</div>
                <div class="Modal-content">
                    <div class="QuestionAsk">
                        <form method="post" action="/question/" id="form_ask">
                        {% csrf_token %}            
                            <div class="QuestionAsk-section">
                                <div class="QuestionAsk-title">
                                        <div class="Input-wrapper Input-wrapper--spread Input-wrapper--multiline Input-wrapper--large">
                                        <textarea required="" name="title" rows="2" autocomplete="off" role="combobox" aria-expanded="false" aria-autocomplete="list" aria-activedescendant="AutoComplet-64372-3800-0" id="Popover-64372-42711-toggle" aria-haspopup="true" aria-owns="Popover-64372-42711-content" class="Input" placeholder="问题标题"></textarea>
                                        </div>
                                </div>
                            </div>
            
                            <div class="QuestionAsk-section">
                                <div class="TagInput TagInput--empty">
                                            <select id="topics_select" name="topics_selected" class="selectpicker show-menu-arrow form-control" multiple data-live-search="true" data-max-options="5" data-style="Input-wrapper Input-wrapper--spread Input-wrapper--large" title="添加话题"></select>
                                </div>
                            </div>

                            <input id="hide_for_submit" type="hidden" name="topics" value="null123">
                
                            <div class="QuestionAsk-section QuestionAsk-DetailSection">问题描述（可选）:<textarea id="summernote_question" name="detail" 1rows="5" 1cols="70" 1maxlength="160"></textarea>              
                            </div>
                           
                            <div class="ModalButtonGroup QuestionAsk-buttonGroup ModalButtonGroup--vertical">
                                <button class="1Button 1Button--primary 1Button--green btn btn-success" type="submit" form="form_ask">提交问题</button>
                            </div>
                        </form>
                    </div>
                </div>
		</div>        
        <button data-dismiss="modal" aria-hidden="true" class="Button Modal-closeButton Button--plain close" style="right:0px;" aria-label="关闭" type="button">
        <svg class="Zi Zi--Close Modal-closeIcon" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M13.486 12l5.208-5.207a1.048 1.048 0 0 0-.006-1.483 1.046 1.046 0 0 0-1.482-.005L12 10.514 6.793 5.305a1.048 1.048 0 0 0-1.483.005 1.046 1.046 0 0 0-.005 1.483L10.514 12l-5.208 5.207a1.048 1.048 0 0 0 .006 1.483 1.046 1.046 0 0 0 1.482.005L12 13.486l5.207 5.208a1.048 1.048 0 0 0 1.483-.006 1.046 1.046 0 0 0 .005-1.482L13.486 12z" fill-rule="evenodd"></path></svg></button>        
	</div>
</div>

</body>
</html>