if(!HTMLCanvasElement.prototype.toBlob){Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(d,b,c){var a=this;setTimeout(function(){var g=atob(a.toDataURL(b,c).split(",")[1]);var f=g.length,e=new Uint8Array(f);for(var h=0;h<f;h++){e[h]=g.charCodeAt(h)}d(new Blob([e],{type:b||"image/png"}))})}})}function utf8_to_b64(a){return window.btoa(unescape(encodeURIComponent(a)))}function b64_to_utf8(a){return decodeURIComponent(escape(window.atob(a)))}function setCookie(a,c,b){var d=new Date();d.setTime(d.getTime()+b*1000);document.cookie=a+"="+c+";expires="+d.toGMTString()+";path=/"}function getCookie(b){var a,c=new RegExp("(^| )"+b+"=([^;]*)(;|$)");if(a=document.cookie.match(c)){return(a[2])}else{return null}}function delCookie(a){var c=new Date();c.setTime(c.getTime()-1);var b=getCookie(a);if(b!=null){document.cookie=a+"="+b+";expires="+c.toGMTString()+";path=/"}}function getTimeNow(){var a=new Date();var b=a.getMonth()+1;return a.getFullYear()+"-"+b+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}function getDateDiff(h){var o=Date.parse(new Date(h.replace(/-/g,"/")));var k=o/1000,b,n,e,j,l=parseInt(new Date().getTime()/1000),q,g=new Date(k*1000),c=g.getFullYear(),p=g.getMonth()+1,a=g.getDate(),r=g.getHours(),f=g.getMinutes(),t=g.getSeconds();if(p<10){p="0"+p}if(a<10){a="0"+a}if(r<10){r="0"+r}if(f<10){f="0"+f}if(t<10){t="0"+t}q=l-k;j=parseInt(q/86400);e=parseInt(q/3600);n=parseInt(q/60);b=parseInt(q);if(j>0&&j<8){return j+"天前"}else{if(j<=0&&e>0){return e+"小时前"}else{if(e<=0&&n>0){return n+"分钟前"}else{if(b<60){if(b<=0){return"刚刚"}else{return b+"秒前"}}else{if(j>=8&&j<30){return c+"-"+p+"-"+a+" "+r+":"+f}else{if(j>=30){return c+"-"+p+"-"+a+" "+r+":"+f}}}}}}}function countDown(){if(0==g_countdown_secs){$(".SignFlow-smsInputButton").removeClass("is-counting").text("获取短信验证码");delCookie("countdown")}else{g_countdown_secs-=1;$("#counting-num").text(g_countdown_secs);setCookie("countdown",g_countdown_secs,g_countdown_secs);setTimeout("countDown()",1000)}}function adjustChooseBox(){var d=200;var a=200;var g=$("#preview_avatar").position().left+50;var f=$("#preview_avatar").position().top+50;var b=$("#preview_avatar").position().left;var c=$("#preview_avatar").position().top;var e=$("#adjust_choosebox").val();d=d+(e-50)*2;a=a+(e-50)*2;g=g-e+50;f=f-e+50;$("#chooseBox").css({width:d+"px",height:a+"px",left:g+"px",top:f+"px"});$("#chooseBox").mousedown(function(k){var j=k.offsetX;var h=k.offsetY;g=$("#chooseBox").position().left;f=$("#chooseBox").position().top;console.log("mousedown");window.onmousemove=function(l){$("#chooseBox").css({position:"absolute",left:g+l.offsetX-j+"px",top:f+l.offsetY-h+"px"});if($("#chooseBox").position().left<=b){$("#chooseBox").css({left:b+"px"})}if($("#chooseBox").position().left>=b+300-d){$("#chooseBox").css({left:b+300-d+"px"})}if($("#chooseBox").position().top<=c){$("#chooseBox").css({top:c+"px"})}if($("#chooseBox").position().top>=c+300-a){$("#chooseBox").css({top:c+300-a+"px"})}$("#chooseBox").mouseout(function(){console.log("mouseout");window.onmousemove=null;return})};window.onmouseup=function(){console.log("onmouseup");window.onmousemove=null;return}})}function getObjectURL(b){var a=null;if(window.createObjectURL!=undefined){a=window.createObjectURL(b)}else{if(window.URL!=undefined){a=window.URL.createObjectURL(b)}else{if(window.webkitURL!=undefined){a=window.webkitURL.createObjectURL(b)}}}return a}function getScrollTop(){var a=0;if(document.documentElement&&document.documentElement.scrollTop){a=document.documentElement.scrollTop}else{if(document.body){a=document.body.scrollTop}}return a}function getClientHeight(){var a=0;if(document.body.clientHeight&&document.documentElement.clientHeight){a=Math.min(document.body.clientHeight,document.documentElement.clientHeight)}else{a=Math.max(document.body.clientHeight,document.documentElement.clientHeight)}return a}function getScrollHeight(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}function uploadImage(c,b){if("forAvatar"==c){var a="/ajax/upload/avatar/"}else{if("forTopicAvatar"==c){var a="/ajax/upload/topic_avatar/"+g_topic_id+"/"}else{var a="/ajax/upload/img/"}}var d=new FormData();d.append("imgfile",b,"image.jpg");$.ajax({data:d,type:"POST",url:a,cache:false,contentType:false,processData:false,success:function(f){if("fail"!=f){if("forQuestion"==c){$("#summernote_question").summernote("insertImage",f,"image name")}else{if("forAnswer"==c){$("#summernote_answer").summernote("insertImage",f,"image name")}else{if("forWrite"==c){$("#summernote_write").summernote("insertImage",f,"image name")}else{if(("forAvatar"==c)||("forTopicAvatar"==c)){$("#upAvatarModal").modal("hide");$("#id_avatar").attr("src",f);var e=getCookie("up"+g_user_token);g_user_profile_list=b64_to_utf8(e).split(",");g_user_profile_list[2]=f;saveUserDataToCookie("up",g_user_profile_list)}else{if("forBusiness"==c){appendBusinessPostPicture(f)}}}}}}}})}function scaleAndUploadImage(d,b,c){var a=new FileReader();a.readAsDataURL(b);a.onload=function(g){var f=new Image();f.onload=function(){var k=c;var j=(k)/(f.naturalWidth)*(f.naturalHeight);if(j*9>k*16){j=k*16/9}var e=document.createElement("canvas");var h=e.getContext("2d");e.width=k;e.height=j;h.drawImage(f,0,0,k,j);e.toBlob(function(l){uploadImage(d,l)},"image/jpeg")};f.src=this.result}}function getIndexImg(d){var c=/<img.*?(?:>|\/>)/gi;var b=d.match(c);if(b!=null){var a=/src=[\'\"]?([^\'\"]*)[\'\"]?/i;imgsrc=b[0].match(a);return imgsrc[1]}else{return null}}function removeImg(c){var a=/<img.*?(?:>|\/>)/gi;var b=c.replace(a,"").replace(/<[^>]+>/g,"").replace(/&nbsp;/ig,"").substr(0,150);return b}function addClassImg(c,b){var a=c.replace(/<img/gi,"<img "+b);return a}function appendMessageElement(k){var q=$("#MenuPopover").attr("data-er-id");$(".Messages-list").empty();for(i in k){var n=k[i][0];var d=k[i][1];var j=k[i][2];var p=k[i][3];var b=k[i][4];var a=k[i][5];var o=k[i][6];var g=k[i][7];var m=k[i][8];var e=k[i][9];if(d==q){continue}if(p!=g_user_id){var c=p;var l=b;var h=a}else{var c=o;var l=g;var h=m}var f='<a href="/conversations/?i='+n+'" class="Messages-item Messages-followItem"><span class="UserLink"><img class="Avatar Avatar--medium UserLink-avatar" width="40" height="40" src="'+h+'" alt="'+l+'"></span><div class="Messages-user"><div class="Messages-userName"><span class="UserLink">'+l+'</span></div><div class="Messages-itemContent">'+e+"</div></div></a>";$(".Messages-list").append(f)}}function appendNotificationElement(h){$(".PushNotifications-list").empty();for(i in h){var a=h[i][0];var j=h[i][1];var g=h[i][2];var b=h[i][3];var f=h[i][4];var k=h[i][5];var d=h[i][6];var c=h[i][7];if("invite"==j){var e='<div class="PushNotifications-item"><span><span><span class="UserLink"><a class="UserLink-link" href="/er/'+b+'">'+f+'</a></span></span></span><span> 邀请你回答 </span><span><a href="/question/'+k+'">'+d+"</a></span></div>"}$(".PushNotifications-list").append(e)}}function appendCommentsElement(g){for(var e in g){var c=g[e][0];var h=g[e][1];var b=g[e][2];var f=g[e][3];var l=g[e][4];var m=g[e][5];var j=g[e][6];var k=g[e][7];var d=g[e][8];var a='<div class="CommentItem" data-comment-id="'+c+'" data-comment-author-name="'+j+'"><div><div class="CommentItem-meta"><span class="UserLink CommentItem-avatar"><a class="UserLink-link" target="_blank" href="/er/'+m+'"><img class="Avatar UserLink-avatar" width="24" height="24" src="'+k+'" alt="'+j+'"></a></span><span class="UserLink"><a class="UserLink-link" target="_blank" href="'+m+'">'+j+'</a></span><span class="CommentItem-time">'+getDateDiff(l)+'</span></div><div class="RichText ztext CommentItem-content">'+h+'</div><div class="CommentItem-footer"><button type="button" class="Button-like-nouse Button CommentItem-likeBtn Button--plain" data-like-type="comment" data-like-id="'+c+'">'+like_icon_svg+b+'</button><button type="button" class="Button CommentItem-hoverBtn Button--plain"><svg viewBox="0 0 22 16" class="Icon Icon--reply Icon--left" width="13" height="16" aria-hidden="true" style="height: 16px; width: 13px;"><title></title><g><path d="M21.96 13.22c-1.687-3.552-5.13-8.062-11.637-8.65-.54-.053-1.376-.436-1.376-1.56V.677c0-.52-.635-.915-1.116-.52L.47 6.67C.18 6.947 0 7.334 0 7.763c0 .376.14.722.37.987 0 0 6.99 6.818 7.442 7.114.453.295 1.136.124 1.135-.5V13c.027-.814.703-1.466 1.532-1.466 1.185-.14 7.596-.077 10.33 2.396 0 0 .395.257.535.257.892 0 .614-.967.614-.967z"></path></g></svg>回复</button></div></div></div>';$(".CommentList.CommentList--current").append(a);if(0!=f){$(".CommentItem").each(function(){if($(this).attr("data-comment-id")==f){parent_element=$(this)}else{if($(this).attr("data-comment-id")==c){var q=$(this);var p=parent_element[0].innerHTML;var o=parent_element.attr("data-comment-id");var r=parent_element.attr("data-comment-author-name");var n='<div class="CommentItem CommentItem--border" data-comment-id="'+o+'" data-comment-author-name="'+r+'">'+p+"</div>";q.find(".CommentItem-meta").after(n)}}})}}if(g.length>10){$(".CommentEditor--nouse--bottom").removeClass("is-hide")}$(".CommentItem-hoverBtn").off("click");$(".CommentItem-hoverBtn").on("click",function(){console.log("comment-reply click");$(".CommentItem-footer").removeClass("is-hide");$(".CommentItem-editor").remove();var n=$(this).closest(".CommentItem");var p=n.attr("data-comment-id");var o=n.attr("data-comment-author-name");var q='<div class="CommentItem-editor CommentEditor--inCommentItem CommentEditor--nouse"><div class="CommentEditor-input Input-wrapper Input-wrapper--spread Input-wrapper--large Input-wrapper--noPadding"><div class="Input Editable"><div class="Dropzone RichText ztext" style="min-height: 198px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner">回复'+o+'</div></div><div class="DraftEditor-editorContainer"><div class="notranslate public-DraftEditor-content" contenteditable="true" role="textbox" spellcheck="true" tabindex="0" style="outline: none; white-space: pre-wrap; word-wrap: break-word;"></div></div></div></div><div></div></div></div><div class="CommentEditor-actions"><button type="button" class="Button Button-comment-cancle Button--plain">取消</button><button disabled="" type="button" class="Button Button-comment-send Button--primary Button--green">评论</button></div></div>';n.append(q);n.find(".CommentItem-footer").addClass("is-hide");checkComment()})}function appendAnswerElementList(E,S,l){E.sort();for(i in E){if(("all"==S)){var w=E[i][0];var P=E[i][1];var v=E[i][2];var H=E[i][3];var z=E[i][4];var B=E[i][5];var F=E[i][6];var a=E[i][7];var N=E[i][8];var p=E[i][9];var M=E[i][10];var b=E[i][11];var m=E[i][12];var e=E[i][13];var C=E[i][14];var O=E[i][15];var R=E[i][16];var o="RichContent--unescapable";var k="Button ContentItem-more ContentItem-rightButton Button--plain is-hide";var j="Button ContentItem-less ContentItem-rightButton Button--plain is-hide";var q="";var A='data-content-type="answer" data-content-id="'+w+'"';var c='<svg viewBox="0 0 10 6" class="Icon ContentItem-arrowIcon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg>';var Q='<svg viewBox="0 0 10 6" class="Icon ContentItem-arrowIcon is-active Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg>';var J='<div class="RichContent '+o+'"><div class="RichContent-expand"><div class="RichContent-inner" style="max-height: 400px;"><span class="RichText CopyrightRichText-richText">'+addClassImg(P,'class="origin_image"')+'</span></div><button class="'+k+'" type="button">展开阅读全文'+c+'</button></div><div class="ContentItem-actions"><span><button class="Button-like-nouse Button Button--plain" type="button" data-like-type="answer" data-like-id="'+w+'">'+like_icon_svg+v+'</button></span><button class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel" type="button"><span style="display: inline-flex; align-items: center;">&#8203;'+comment_icon_svg+"</span>"+H+" 条评论</button>"+share_button+'<button class="'+j+'" type="button"><span class="RichContent-collapsedText">收起</span>'+Q+"</button></div></div>"}else{if(("topic"==S)||("homepage"==S)){if("topic"==S){var h=E[i][22];if("article"==h){var G=E[i][0];var u=E[i][1];var d=E[i][2];var t=E[i][3];var I=E[i][4];var s=E[i][5];var q='<h2 class="ContentItem-title"><div><a target="_blank" href="/article/'+G+'/">'+u+"</a></div></h2>";var K='data-content-url="/article/'+G+'/"';var A='data-content-type="article" data-content-id="'+G+'"';var g='data-like-type="article" data-like-id="'+G+'"';if($.inArray(""+G,g_cache_article_id_list)>=0){continue}else{g_cache_article_id_list.push(""+G)}}else{var D=E[i][0];var y=E[i][1];var d=E[i][2];var n=E[i][3];var I=E[i][4];var w=E[i][5];var q='<h2 class="ContentItem-title"><div><a target="_blank" href="/question/'+D+"/?ans="+w+'">'+y+"</a></div></h2>";var K='data-content-url="/question/'+D+"/?ans="+w+'"';var A='data-content-type="answer" data-content-id="'+w+'"';var g='data-like-type="answer" data-like-id="'+w+'"';if($.inArray(""+D,g_cache_question_id_list)>=0){continue}else{g_cache_question_id_list.push(""+D)}}var P=E[i][6];var v=E[i][7];var H=E[i][8];var z=E[i][9];var B=E[i][10];var F=E[i][11];var a=E[i][12];var N=E[i][13];var p=E[i][14];var M=E[i][15];var b=E[i][16];var m=E[i][17];var e=E[i][18];var C=E[i][19];var O=E[i][20];var R=E[i][21]}else{if("homepage"==S){var w=E[i][0];var D=E[i][1];var y=E[i][2];var P=E[i][3];var z=E[i][4];var v=E[i][5];var H=E[i][6];var B=E[i][7];var F=E[i][8];var a=E[i][9];var N=E[i][10];var q='<h2 class="ContentItem-title"><div><a target="_blank" href="/question/'+D+"/?ans="+w+'">'+y+"</a></div></h2>";var K='data-content-url="/question/'+D+"/?ans="+w+'"';var A='data-content-type="answer" data-content-id="'+w+'"';var g='data-like-type="answer" data-like-id="'+w+'"'}}var x=getIndexImg(P);var r='<svg viewBox="0 0 64 64" class="Icon Icon--play" width="50" height="50" aria-hidden="true" style="height: 50px; width: 50px;"><title></title><g><path fill-opacity="0.9" fill="#fff" d="M32,64 C14.326888,64 0,49.673112 0,32 C0,14.326888 14.326888,0 32,0 C49.673112,0 64,14.326888 64,32 C64,49.673112 49.673112,64 32,64 Z M32.2363929,61.6 C48.5840215,61.6 61.8363929,48.3476286 61.8363929,32 C61.8363929,15.6523714 48.5840215,2.4 32.2363929,2.4 C15.8887643,2.4 2.63639293,15.6523714 2.63639293,32 C2.63639293,48.3476286 15.8887643,61.6 32.2363929,61.6 Z"></path>   <circle fill-opacity="0.3" fill="#000" cx="32" cy="32" r="29.6"></circle>   <path fill-opacity="0.9" fill="#fff" d="M43.5634409,30.7271505 C44.6882014,31.4301259 44.6868607,32.5707121 43.5634409,33.2728495 L28.4365591,42.7271505 C27.3117986,43.4301259 26.4,42.9221451 26.4,41.5999847 L26.4,22.4000153 C26.4,21.0745235 27.3131393,20.5707121 28.4365591,21.2728495 L43.5634409,30.7271505 Z"></path></g></svg>';var J='<div class="RichContent is-collapsed"><div class="RichContent-content" '+K+'><div class="RichContent-cover"><div class="RichContent-cover-inner" data-index-img-url="'+x+'"></div><div class="RichContent-cover-play is-hide">'+r+'</div></div><div class="RichContent-inner"><span class="RichText CopyrightRichText-richText">'+removeImg(P)+'</span></div></div><div class="ContentItem-actions"><span><button class="Button-like-nouse Button Button--plain" type="button" '+g+">"+like_icon_svg+v+'</button></span><button class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel" type="button"><span style="display: inline-flex; align-items: center;">&#8203;'+comment_icon_svg+"</span>"+H+" 条评论</button>"+share_button+"</div></div>"}}var L='data-author-id="'+B+'" data-author-name="'+F+'" data-author-avatar="'+a+'" data-author-mood="'+N+'" data-author-sexual="'+p+'" data-author-answer-nums="'+m+'" data-author-article-nums="'+b+'" data-author-follower-nums="'+C+'"';var f='<div class="List-item ScrollIntoMark"><div class="ContentItem AnswerItem" '+A+' data-comment-nums="'+H+'">'+q+'<div class="ContentItem-meta"><div class="AnswerItem-meta AnswerItem-meta--related"><div class="AuthorInfo"><span class="UserLink AuthorInfo-avatarWrapper"><a class="UserLink-link PeoplePopover" href="/er/'+B+'" '+L+' data-toggle="popover" data-placement="right" data-trigger="manual" data-content="null" data-html="true"><img class="Avatar AuthorInfo-avatar" width="40" height="40" src="'+a+'" alt="'+F+'"></a></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><a class="UserLink-link" href="/er/'+B+'">'+F+'</a></span></div><div class="AuthorInfo-detail"><div class="AuthorInfo-badge"><div class="RichText AuthorInfo-badgeText">'+N+'</div></div></div></div></div></div></div><div class="ContentItem-time"><span>'+getDateDiff(z)+"</span></div>"+J+"</div></div>";if("prepend"==l){$("#appendArea").prepend(f)}else{$("#appendArea").append(f)}}}function appendAnswerElementCard(ret,type,direction){ret.sort();for(i in ret){var content_type=ret[i][22];if("article"==content_type){var article_id=ret[i][0];var article_title=ret[i][1];var click_nums=ret[i][2];var article_id_nouse1=ret[i][3];var topics=ret[i][4];var article_id_nouse2=ret[i][5];var question_element='<h2 class="ContentItem-title"><a href="/article/'+article_id+'/">'+article_title+"</a></h2>";var data_content_url='data-content-url="/article/'+article_id+'/"';var content_type_element='data-content-type="article" data-content-id="'+article_id+'"';var like_element_attr='data-like-type="article" data-like-id="'+article_id+'"';if($.inArray(""+article_id,g_cache_article_id_list)>=0){continue}else{g_cache_article_id_list.push(""+article_id)}}else{var question_id=ret[i][0];var question_title=ret[i][1];var click_nums=ret[i][2];var push_answer_id=ret[i][3];var topics=ret[i][4];var answer_id=ret[i][5];var question_element='<h2 class="ContentItem-title"><a href="/question/'+question_id+"/?ans="+answer_id+'">'+question_title+"</a></h2>";var data_content_url='data-content-url="/question/'+question_id+"/?ans="+answer_id+'"';var content_type_element='data-content-type="answer" data-content-id="'+answer_id+'"';var like_element_attr='data-like-type="answer" data-like-id="'+answer_id+'"';if($.inArray(""+question_id,g_cache_question_id_list)>=0){continue}else{g_cache_question_id_list.push(""+question_id)}}var content=ret[i][6];var like_nums=ret[i][7];var comment_nums=ret[i][8];var pub_date=ret[i][9];var author_id=ret[i][10];var author_name=ret[i][11];var author_avatar=ret[i][12];var author_mood=ret[i][13];var author_sexual=ret[i][14];var author_question_nums=ret[i][15];var author_article_nums=ret[i][16];var author_answer_nums=ret[i][17];var author_followto_nums=ret[i][18];var author_follower_nums=ret[i][19];var author_followtopic_nums=ret[i][20];var author_followquestion_nums=ret[i][21];var topics_data="";var topics_array=eval("("+topics+")");for(i in topics_array){var topic_array=topics_array[i].split(":");var topic_id=topic_array[0];var topic_name=topic_array[1];topics_data+='<span style="margin-right:15px;"><a href="/topic/'+topic_id+'/" class="1TopicPopover" data-topic-id="'+topic_id+'" data-toggle="popover" data-placement="bottom" data-trigger="manual" data-content="null" data-html="true">'+topic_name+"</a></span>"}var topic_element='<div class="Feed-title"><div class="Feed-meta"><span class="Feed-meta-item">'+topics_data+"</span></div></div>";var index_img_url=getIndexImg(content);var people_popover_data='data-author-id="'+author_id+'" data-author-name="'+author_name+'" data-author-avatar="'+author_avatar+'" data-author-mood="'+author_mood+'" data-author-sexual="'+author_sexual+'" data-author-answer-nums="'+author_answer_nums+'" data-author-article-nums="'+author_article_nums+'" data-author-follower-nums="'+author_follower_nums+'"';var author_info_element='<div class="AuthorInfo Feed-meta-author AuthorInfo--plain"><span class="UserLink AuthorInfo-avatarWrapper"><a class="UserLink-link PeoplePopover" href="/er/'+author_id+'/" '+people_popover_data+' data-toggle="popover" data-placement="right" data-trigger="manual" data-content="null" data-html="true"><img src="'+author_avatar+'" width="40" height="40"></a></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><a href="/er/'+author_id+'/" class="UserLink-link 1PeoplePopover" data-author-id="'+author_id+'" data-toggle="popover" data-placement="right" data-trigger="manual" data-content="null" data-html="true">'+author_name+'</a></span></div><div class="AuthorInfo-detail"><div class="AuthorInfo-badge"><div class="RichText AuthorInfo-badgeText">'+author_mood+"</div></div></div></div></div>";var answer_element='<div class="ContentItem AnswerItem" '+content_type_element+' data-comment-nums="'+comment_nums+'">'+question_element+'<div class="RichContent is-collapsed"><div class="RichContent-content" '+data_content_url+'><div class="RichContent-cover"><div class="RichContent-cover-inner" data-index-img-url="'+index_img_url+'"></div></div><div class="RichContent-inner"><span class="RichText CopyrightRichText-richText">'+removeImg(content)+'</span></div></div><div class="ContentItem-actions"><span><button class="Button-like-nouse Button Button--plain" type="button" '+like_element_attr+">"+like_icon_svg+like_nums+'</button></span><button class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel" type="button"><span style="display: inline-flex; align-items: center;">&#8203;'+comment_icon_svg+"</span>"+comment_nums+" 条评论</button>"+share_button+"</div></div></div>";var appendElement='<div class="Card QuestionFrame ScrollIntoMark"><div class="Feed">'+topic_element+author_info_element+answer_element+"</div></div>";if("prepend"==direction){$("#appendArea").prepend(appendElement)}else{$("#appendArea").append(appendElement)}}}function appendTopicElement(k){for(var c in k){var h=k[c][0];var l=k[c][1];var j=k[c][2];var a=k[c][3];var d=k[c][4];var g=k[c][5];var f=k[c][6];console.log(g_user_follow_topics_list);if($.inArray(""+h,g_user_follow_topics_list)>=0){var e='<button class="Button Button--grey FollowButton" type="button" data-follow-type="topic" data-topic-id="'+h+'" data-followed="true">已关注</button>'}else{var e='<button class="Button Button--green FollowButton" type="button" data-follow-type="topic" data-topic-id="'+h+'" data-followed="false">关注栏目</button>'}var b='<div class="List-item"><div class="ContentItem"><div class="ContentItem-main"><div class="ContentItem-image"><span class="TopicLink TopicItem-avatar"><a class="TopicLink-link" target="_blank" href="/topic/'+h+'"><img class="Avatar Avatar--large TopicLink-avatar" width="60" height="60" src="'+j+'"  alt="'+l+'"></a></span></div><div class="ContentItem-head"><h2 class="ContentItem-title"><div class="TopicItem-title"><span class="TopicLink TopicItem-name"><a class="TopicLink-link" target="_blank" href="/topic/'+h+'"><span class="RichText">'+l+'</span></a></span></div></h2><div class="ContentItem-meta"><div><div class="ContentItem-status"><div class="ContentItem-statusItem">'+a+'</div></div></div></div></div><div class="ContentItem-extra">'+e+"</div></div></div></div>";$("#appendArea").append(b)}}function appendInviteElement(c){for(i in c){var b=c[i][0];var a=c[i][1];var f=c[i][2];var e=c[i][3];var d='<div class="List-item"><div class="ContentItem"><div class="ContentItem-main"><div class="ContentItem-image"><span class="UserLink UserItem-avatar"><a class="UserLink-link" target="_blank" href="/er/'+b+'"><img class="Avatar Avatar--large UserLink-avatar 1PeoplePopover" width="60" height="60" src="'+f+'" alt="'+a+'" data-author-id="'+b+'" data-toggle="popover" data-placement="bottom" data-trigger="manual" data-content="null" data-html="true"></a></span></div><div class="ContentItem-head"><h2 class="ContentItem-title"><div class="UserItem-title"><span class="UserLink UserItem-name"><a class="UserLink-link" target="_blank" href="/er/'+b+'"><span class="RichText">'+a+'</span></a></span></div></h2><div class="ContentItem-meta"><div><div class="ContentItem-status"><div class="ContentItem-statusItem">'+e+'</div></div></div></div></div><div class="ContentItem-extra"><button class="Button Button--green Invite" type="button" data-receiver="'+b+'">邀请回答</button></div></div></div></div>';$(".QuestionInvitation-content.List").append(d)}}function appendSearchPageElement(r){var s=r[0];var b=r[1];var l=r[2];var o=r[3];if("content"==g_search_type){for(var n in s){var p=s[n][0];var m=s[n][1];m=m.replace(g_search_keyword,"<em>"+g_search_keyword+"</em>");var t='<div class="List-item"><div class="ContentItem AnswerItem"><h2 class="ContentItem-title"><div><meta itemprop="url" content="/question/'+p+'"><a target="_blank" href="/question/'+p+'"><span class="Highlight">'+m+"</span></a></div></h2></div></div>";$("#appendArea").append(t)}for(var n in b){var c=b[n][0];var a=b[n][1];a=a.replace(g_search_keyword,"<em>"+g_search_keyword+"</em>");var t='<div class="List-item"><div class="ContentItem AnswerItem"><h2 class="ContentItem-title"><div><meta itemprop="url" content="/article/'+c+'"><a target="_blank" href="/article/'+c+'"><span class="Highlight">'+a+"</span></a></div></h2></div></div>";$("#appendArea").append(t)}}else{if("people"==g_search_type){for(var n in l){var j=l[n][0];var d=l[n][1];var q=l[n][2];var k=l[n][3];var t='<div class="List-item"><div class="ContentItem"><div class="ContentItem-main"><div class="ContentItem-image"><span class="UserLink UserItem-avatar"><div class="Popover"><a class="UserLink-link" target="_blank" href="/er/'+j+'"><img class="Avatar Avatar--large UserLink-avatar" width="60" height="60" src="'+q+'" alt="'+d+'"></a></div></span></div><div class="ContentItem-head"><h2 class="ContentItem-title"><div class="UserItem-title"><span class="UserLink UserItem-name"><div class="Popover"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="/er/'+j+'">'+d+'</a></div></span></div></h2><div class="ContentItem-meta"><div><div class="RichText">'+k+"</div></div></div></div></div></div></div>";$("#appendArea").append(t)}}else{if("topic"==g_search_type){for(var n in o){var h=o[n][0];var g=o[n][1];var e=o[n][2];var f=o[n][3];var t='<div class="List-item"><div class="ContentItem"><div class="ContentItem-main"><div class="ContentItem-image"><img class="Avatar Avatar--large" width="60" height="60" src="'+e+'"></div><div class="ContentItem-head"><h2 class="ContentItem-title"><a class="TopicLink" href="/topic/'+h+'" target="_blank"><div class="Popover"><div>'+g+'</div></div></a></h2><div class="ContentItem-meta"><div class="ContentItem-status">'+f+"</div></div></div></div></div></div>";$("#appendArea").append(t)}}}}}function pushOneConversationMessagesElement(e){var b=$("#letterText").val();var a=new Date();var d=a.toLocaleTimeString();var c='<div class="List-item Conversation-messages-item" data-action="delete_conversation_message" data-action-id="'+e+'"><a class="zm-item-link-avatar50" href="/er/'+g_user_id+'"><img class="zm-item-img-avatar50" src="'+g_user_avatar+'"></a><div class="zm-pm-item-main"><a class="pm-touser author-link" title="verna wu" href="/er/'+g_user_id+'">我</a>：'+b+'</div><div class="zg-gray zu-pm-item-meta"><span class="zg-gray zg-left">'+d+'</span><a class="zg-link-litblue" href="javascript:;" name="delete">删除</a></div></div>';$(".List-item.Conversation-messages-head").after(c);checkSettingPage()}function appendSettingPageElement(x){for(i in x){if("conversations"==g_setting_type){var t=x[i][0];var r=x[i][1];var F=x[i][2];var A=x[i][3];var w=x[i][4];var B=x[i][5];var o=x[i][6];var e=x[i][7];var f=x[i][8];var j=x[i][9];if(r==g_user_id){continue}if(A!=g_user_id){var D=A;var s=w;var u=B}else{var D=o;var s=e;var u=f}var I='<div class="List-item Conversations-item" data-action="delete_conversation" data-action-id="'+t+'" data-receiver-id="'+D+'"  data-receiver-name="'+s+'"><a class="zm-item-link-avatar50" href="/er/'+D+'"><img class="zm-item-img-avatar50" src="'+u+'"></a><div class="zm-pm-item-main"><a class="pm-touser author-link" href="/er/'+D+'">'+s+"</a>："+j+'</div><div class="zg-gray zu-pm-item-meta"><span class="zg-gray zg-left">'+F+'</span><a class="zg-link-litblue" href="javascript:;" name="messages">查看对话</a><span class="zg-bull">|</span><a class="zg-link-litblue" href="javascript:;" name="reply" data-receiver-id="'+D+'"  data-receiver-name="'+s+'" data-toggle="modal" data-target="#letterModal">回复</a><span class="zg-bull">|</span><a class="zg-link-litblue" href="javascript:;" name="delete">删除</a></div></div>';$("#appendArea").append(I)}else{if("conversation_messages"==g_setting_type){var L=x[i][0];var q=x[i][1];var l=x[i][2];var C=x[i][3];var k=x[i][4];var y=x[i][5];var n=x[i][6];var p=x[i][7];var E=x[i][8];var G=x[i][9];var c=x[i][10];if(C==g_user_id){continue}if(y==g_user_id){var n="我";var H=E;var a=G}else{var H=y;var a=n}$(".Conversation-messages-head .zg-gray-darker").text(a);$(".Conversation-messages-head #letterText").attr("data-receiver-id",H);var I='<div class="List-item Conversation-messages-item" data-action="delete_conversation_message" data-action-id="'+L+'"><a class="zm-item-link-avatar50" href="/er/'+y+'"><img class="zm-item-img-avatar50" src="'+p+'"></a><div class="zm-pm-item-main"><a class="pm-touser author-link" href="/er/'+y+'">'+n+"</a>："+q+'</div><div class="zg-gray zu-pm-item-meta"><span class="zg-gray zg-left">'+getDateDiff(k)+'</span><a class="zg-link-litblue" href="javascript:;" name="delete">删除</a></div></div>';$("#appendArea").append(I)}else{if("notifications"==g_setting_type){var g=x[i][0];var b=x[i][1];var J=x[i][2];var h=x[i][3];var K=x[i][4];var z=x[i][5];var d=x[i][6];var m=x[i][7];if("invite"==b){var v=x[i][7];var I='<div class="List-item day"><h3>'+getDateDiff(J)+'</h3><div><i></i><div><span><span><a href="/er/'+h+'" target="_blank">'+K+'</a></span>邀请你回答 <a href="/question/'+z+'">'+d+"</a></span></div></div></div>"}$("#appendArea").append(I)}}}}checkSettingPage()}function appendInvitedQuestionElement(l){for(var j in l){var b=l[j][0];var m=l[j][1];var k=l[j][2];var c=l[j][3];var h=l[j][4];var f=l[j][5];var d=l[j][6];var n=l[j][7];var a=l[j][8];var e=l[j][9];var g='<div class="List-item"><div class="ContentItem"><h3 class="ContentItem-title"><div class="QuestionItem-title"><a href="/question/'+f+'" target="_blank">'+d+'</a></div></h3><div class="ContentItem-status"><span class="ContentItem-statusItem"><a href="/er/'+c+'">'+h+'</a></span><span class="ContentItem-statusItem">邀请你回答</span><span class="ContentItem-statusItem">'+getDateDiff(k)+' </span><span class="ContentItem-statusItem">'+n+' 个回答</span><span class="ContentItem-statusItem">'+a+" 个关注</span></div></div></div>";$("#appendArea").append(g)}}function appendQuestionElement(e){for(var f in e){var a=e[f][0];var d=e[f][1];var h=e[f][2];var c=e[f][3];var b=e[f][4];var g='<div class="List-item"><div class="ContentItem"><h2 class="ContentItem-title"><div class="QuestionItem-title"><a href="/question/'+a+'" target="_blank">'+d+'</a></div></h2><div class="ContentItem-status"><span class="ContentItem-statusItem">'+getDateDiff(b)+'</span><span class="ContentItem-statusItem">'+h+' 个回答</span><span class="ContentItem-statusItem">'+c+" 个关注</span></div></div></div>";$("#appendArea").append(g)}}function appendHomeBusinessElement(c){for(var d in c){var e=c[d][0];var b=c[d][1];var a=c[d][2];var g=c[d][3];var f='<div class="List-item"><div class="ContentItem"><h2 class="ContentItem-title"><div class="QuestionItem-title"><a href="/business/'+e+'" target="_blank">'+b+'</a></div></h2><div class="ContentItem-status"><span class="ContentItem-statusItem">'+getDateDiff(g)+'</span><span class="ContentItem-statusItem">'+a+"</span></div></div></div>";$("#appendArea").append(f)}}function appendArticleElement(b){for(var d in b){var a=b[d][0];var c=b[d][1];var f=b[d][2];var e='<div class="List-item"><div class="ContentItem"><h2 class="ContentItem-title"><div class="QuestionItem-title"><a href="/article/'+a+'" target="_blank">'+c+'</a></div></h2><div class="ContentItem-status"><span class="ContentItem-statusItem">'+getDateDiff(f)+"</span></div></div></div>";$("#appendArea").append(e)}}function appendFollowOrMoreElement(x){for(var r in x){if(("followtos"==g_subcmd)||("followers"==g_subcmd)){var g=x[r][0];var a=x[r][1];var w=x[r][2];var h=x[r][3];var t=x[r][4];var m=x[r][5];var v=x[r][6];var l=x[r][7];if("f"==t){var s="she";var j="她"}else{var s="he";var j="他"}if($.inArray(""+g,g_user_follow_peoples_list)>=0){var o='<button class="Button FollowButton Button--primary Button--grey" type="button" data-er-id="'+g+'" data-er-sexual="'+t+'" data-follow-type="people" data-followed="true" data-who="'+s+'">已关注</button>'}else{var o='<button class="Button FollowButton Button--primary Button--green" type="button" data-er-id="'+g+'" data-er-sexual="'+t+'" data-follow-type="people" data-followed="false" data-who="'+s+'">关注'+j+"</button>"}var n="";var y='<div class="List-item"><div class="ContentItem"><div class="ContentItem-main"><div class="ContentItem-image"><span class="UserLink UserItem-avatar"><div class="Popover"><div><a class="UserLink-link" target="_blank" href="/er/'+g+'"><img class="Avatar Avatar--large UserLink-avatar" width="60" height="60" src="'+w+'" alt="'+a+'"></a></div></div></span></div><div class="ContentItem-head"><h2 class="ContentItem-title"><div class="UserItem-title"><span class="UserLink UserItem-name"><div class="Popover"><div><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="/er/'+g+'">'+a+"</a></div></div></span>"+n+'</div></h2><div class="ContentItem-meta"><div><div class="RichText">'+h+'</div><div class="ContentItem-status"><span class="ContentItem-statusItem">'+m+' 回答</span><span class="ContentItem-statusItem">'+v+' 文章</span><span class="ContentItem-statusItem">'+l+' 关注者</span></div></div></div></div><div class="ContentItem-extra">'+o+"</div></div></div></div>";$("#appendArea").append(y)}else{if("topics"==g_subcmd){var f=x[r][0];var e=x[r][1];var c=x[r][2];var d=x[r][3];var y='<div class="List-item"><div class="ContentItem"><div class="ContentItem-main"><div class="ContentItem-image"><img class="Avatar Avatar--large" width="60" height="60" src="'+c+'"></div><div class="ContentItem-head"><h2 class="ContentItem-title"><a class="TopicLink" href="/topic/'+f+'" target="_blank"><div class="Popover"><div>'+e+'</div></div></a></h2><div class="ContentItem-meta"><div class="ContentItem-status">'+d+"</div></div></div></div></div></div>";$("#appendArea").append(y)}else{if("questions"==g_subcmd){var u=x[r][0];var q=x[r][1];var k=x[r][2];var p=x[r][3];var b=x[r][4];var y='                    <div class="List-item"><div class="ContentItem" ><h2 class="ContentItem-title"><div class="QuestionItem-title"><a href="/question/'+u+'" target="_blank">'+q+'</a></div></h2><div class="ContentItem-status"><span class="ContentItem-statusItem">'+getDateDiff(b)+'</span><span class="ContentItem-statusItem">'+k+' 个回答</span><span class="ContentItem-statusItem">'+p+" 个关注</span></div></div></div>";$("#appendArea").append(y)}}}}}function appendFollowOrMoreHead(){var a='<div class="List" id="Profile-following"><div class="List-header"><h4 class="List-headerText"><div class="SubTabs"><a class="SubTabs-item" href="/er/'+g_er_id+'/following/followtos">'+g_who_han+'关注的人</a><a class="SubTabs-item" href="/er/'+g_er_id+'/following/followers">关注'+g_who_han+'的人</a><a class="SubTabs-item" href="/er/'+g_er_id+'/following/topics">'+g_who_han+'关注的栏目</a><a class="SubTabs-item" href="/er/'+g_er_id+'/following/questions">'+g_who_han+'关注的问题</a></div></h4></div><div id="appendArea"></div></div>';$("#profileMainContent").append(a);$(".SubTabs-item").each(function(){if($(this).attr("href")){if($(this).attr("href").indexOf(g_subcmd)>-1){$(this).addClass("is-active")}}})}function appendLetterModal(){var b='<svg class="Zi Zi--Close Modal-closeIcon" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M13.486 12l5.208-5.207a1.048 1.048 0 0 0-.006-1.483 1.046 1.046 0 0 0-1.482-.005L12 10.514 6.793 5.305a1.048 1.048 0 0 0-1.483.005 1.046 1.046 0 0 0-.005 1.483L10.514 12l-5.208 5.207a1.048 1.048 0 0 0 .006 1.483 1.046 1.046 0 0 0 1.482.005L12 13.486l5.207 5.208a1.048 1.048 0 0 0 1.483-.006 1.046 1.046 0 0 0 .005-1.482L13.486 12z" fill-rule="evenodd"></path></svg>';var a='<div class="modal fade" id="letterModal" tabindex="0" role="dialog" aria-labelledby="letterModalLabel" aria-hidden="true"><div class="modal-dialog lettermodal"><div class="Modal-inner"><h3 class="Modal-title">发送私信</h3><div class="Modal-content"><div class="Messages-newDialog"><div class="Messages-receiver"><span class="Messages-receiverInfo" data-receiver-id="">who</span></div><div class="Messages-sendContent Input-wrapper Input-wrapper--spread Input-wrapper--multiline"><textarea id="letterTextModal" rows="5" class="Input" placeholder="私信内容"></textarea></div><span class="Messages-warning"></span><div class="ModalButtonGroup ModalButtonGroup--vertical"><button class="Button Messages-sendButton Button--primary Button--green" type="button" onclick="sendLetterViaModal()">发送</button></div></div></div></div><button class="Button Modal-closeButton Button--plain" data-dismiss="modal" aria-label="关闭" type="button">'+b+"</button></div></div>";$("body").append(a);$("#letterModal").on("show.bs.modal",function(){$(".PeoplePopover").popover("hide");if(false==veriLogin()){return}})}function invite(){$(".Invite").each(function(a,b){$(b).click(function(){receiver=$(b).attr("data-receiver");if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/invite/",{question:g_question_id,to:receiver},function(c){$(b).attr("disabled","").text("已邀请");g_lock_ajax="false"})})})}function showInvite(){if(false==veriLogin()){return}var a="";$(".TopicLink").each(function(){a+=($(this).attr("data-topic-id"))+";"});if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/topic_adept/",{topics:a},function(b){if("fail"!=b){$(".QuestionInvitation-content.List").empty();appendInviteElement(b);$("#inviteModal").modal("show");checkSets();invite()}g_lock_ajax="false"})}function sendLetter(){var b=$("#letterText").val();var a=$("#letterText").attr("data-receiver-id");if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/send_message/"+a+"/",{content:b},function(c){if("fail"!=c){var d=c;pushOneConversationMessagesElement(d)}g_lock_ajax="false"})}function sendLetterViaModal(){var b=$("#letterTextModal").val();var a=$(".Messages-receiverInfo").attr("data-receiver-id");console.log(b);$("#letterModal").modal("toggle");if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/send_message/"+a+"/",{content:b},function(c){if("fail"!=c){console.log(c)}g_lock_ajax="false"})}function setLetterReceiver(b,a){$(".Messages-receiverInfo").attr("data-receiver-id",b);$(".Messages-receiverInfo").text(a)}function checkFollow(){$(".FollowButton").off("click");$(".FollowButton").each(function(){var b=$(this);b.click(function(){console.log("checkFollow");if(false==veriLogin()){return}if("true"==b.attr("data-followed")){follow_action="0"}else{follow_action="1"}if("people"==b.attr("data-follow-type")){var f=b.attr("data-who");if("she"==f){var d="关注她"}else{var d="关注他"}var j="people";var g="people-followed";var e=b.attr("data-er-id")}else{if("topic"==b.attr("data-follow-type")){var d="关注栏目";var j="topic";var g="topic-followed";var e=b.attr("data-topic-id")}else{if("question"==b.attr("data-follow-type")){var d="关注问题";var j="question";var g="question-followed";var e=b.attr("data-question-id")}}}var h={follow_type:j,follow_id:e,follow_action:follow_action};var c="/ajax/follow/";if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post(c,h,function(k){if("fail"!=k){if("true"==b.attr("data-followed")){if("alltopics"==g_module){b.removeClass("zg-unfollow").addClass("zg-follow").removeClass("Button--grey").addClass("Button--green").text(d)}else{b.removeClass("Button--grey").addClass("Button--green").text(d)}b.attr("data-followed","false")}else{if("alltopics"==g_module){b.removeClass("zg-follow").addClass("zg-unfollow").removeClass("Button--green").addClass("Button--grey").text("已关注")}else{b.removeClass("Button--green").addClass("Button--grey").text("已关注")}b.attr("data-followed","true")}if("question"==j){saveUserDataToCookie("ufq",k[1]);g_user_follow_questions_list=String(k[1]).split(",")}else{if("people"==j){saveUserDataToCookie("ufp",k[1]);g_user_follow_peoples_list=String(k[1]).split(",")}else{if("topic"==j){saveUserDataToCookie("uft",k[1]);g_user_follow_topics_list=String(k[1]).split(",")}}}a(g,k[0])}g_lock_ajax="false"})})});function a(b,c){$(".NumberBoard-value").each(function(){var d=$(this);if(b==d.attr("data-update-value-type")){d.text(c)}})}}function checkContentClick(){$(".RichContent-content").off("click");$(".RichContent-content").each(function(){var a=$(this).find(".RichContent-cover-inner").attr("data-index-img-url");if("null"==a){$(this).find(".RichContent-cover").addClass("is-hide")}else{$(this).find(".RichContent-cover-inner").append('<img src="'+a+'">')}$(this).click(function(){var b=$(this).attr("data-content-url");location.href=b})})}function checkContentCollapse(){$(".ContentItem-less").off("click");$(".ContentItem-less").each(function(){$(this).click(function(){$(this).addClass("is-hide");$(this).parent().siblings(".RichContent-expand").children(".ContentItem-more").removeClass("is-hide");$(this).parents(".RichContent").addClass("is-collapsed");$(this).parent().siblings(".RichContent-expand").children(".RichContent-inner").css("max-height","400px");if($(this).parents(".ScrollIntoMark").length>0){var a=$(this).parents(".ScrollIntoMark").attr("id");document.getElementById(a).scrollIntoView();$(this).parents(".ScrollIntoMark").removeAttr("id")}})})}function checkContentExpand(){$(".RichContent-expand").off("click");$(".RichContent-expand").each(function(){console.log($(this).height());if($(this).height()>=400){$(this).find(".ContentItem-more").removeClass("is-hide");$(this).parents(".RichContent").addClass("is-collapsed")}else{$(this).find(".ContentItem-more").remove();$(this).siblings(".ContentItem-actions").find(".ContentItem-less").remove()}if($(this).parents(".ScrollIntoMark").length>0){var a=""+Math.random();$(this).parents(".ScrollIntoMark").attr("id",a)}$(this).click(function(){$(this).children(".ContentItem-more").addClass("is-hide");$(this).siblings(".ContentItem-actions").children(".ContentItem-less").removeClass("is-hide");$(this).parent().removeClass("is-collapsed");$(this).children(".RichContent-inner").css("max-height","");if($(this).parents(".ScrollIntoMark").length>0){var b=""+Math.random();$(this).parents(".ScrollIntoMark").attr("id",b)}})})}function checkQuestionDetailCollapse(){$(".QuestionHeader-detail-less").off("click");$(".QuestionHeader-detail-less").each(function(){$(this).click(function(){$(this).addClass("is-hide");$(this).parents(".RichContent").find(".QuestionHeader-detail-more").removeClass("is-hide");$(this).parents(".RichContent").addClass("is-collapsed");$(this).parents(".RichContent").find(".RichContent-inner").css("max-height","200px");if($(this).parents(".ScrollIntoMark").length>0){var a=$(this).parents(".ScrollIntoMark").attr("id");document.getElementById(a).scrollIntoView();$(this).parents(".ScrollIntoMark").removeAttr("id")}})})}function checkQuestionDetailExpand(){$(".QuestionHeader-detail-expand").off("click");$(".QuestionHeader-detail-expand").each(function(){console.log($(this).height());if($(this).height()>=200){$(this).find(".QuestionHeader-detail-more").removeClass("is-hide");$(this).parents(".RichContent").addClass("is-collapsed")}else{$(this).find(".QuestionHeader-detail-more").addClass("is-hide");$(this).parents(".RichContent").find(".QuestionHeader-detail-less").addClass("is-hide")}if($(this).parents(".ScrollIntoMark").length>0){var a=""+Math.random();$(this).parents(".ScrollIntoMark").attr("id",a)}$(this).click(function(){$(this).children(".QuestionHeader-detail-more").addClass("is-hide");$(this).parents(".RichContent").find(".QuestionHeader-detail-less").removeClass("is-hide");$(this).parent().removeClass("is-collapsed");$(this).children(".RichContent-inner").css("max-height","");if($(this).parents(".ScrollIntoMark").length>0){var b=""+Math.random();$(this).parents(".ScrollIntoMark").attr("id",b)}})})}function checkSearchSelect(){$(".Menu-item").off("mouseenter mouseleave");$(".Menu-item").on("mouseenter mouseleave",function(a){if(a.type=="mouseenter"){$(this).addClass("is-active")}else{if(a.type=="mouseleave"){$(this).removeClass("is-active")}}})}function checkSearchHot(){var a="/ajax/hotwords/";if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post(a,function(c){if("fail"!=c){for(i in c){var b=c[i][0];var d='<div class="TopSearch-item"><a class="TopSearch-itemLink" target="_blank" href="javascript:"><span class="TopSearch-itemText">'+b+"</span></a></div>";$(".TopSearch-items").append(d)}$(".TopSearch-itemLink").each(function(){$(this).click(function(){g_search_keyword=$(this).children(".TopSearch-itemText").text();$("#searchInput").val(g_search_keyword);$("#appendArea").empty();g_last_getmoredata_index=0;getMoreData()})})}g_lock_ajax="false"})}function checkSearch(){var a="false";$("#searchInput").off("keyup click");$("#searchInput").on("keyup click",function(){if("search"!=g_module){location.href="/search/"}else{if("false"==a){var b=$(this).val();g_search_keyword=b.replace(/[^\a-\z\A-\Z0-9\u4E00-\u9FA5]/g,"");if(""!=g_search_keyword){$(".Icon.Icon--search").css({fill:"#228b22"})}else{$(".Icon.Icon--search").css({fill:"#afbdcf"})}}}});$("#search_button").off("click");$("#search_button").on("click",function(){if("false"==a){if(""!=g_search_keyword){$("#appendArea").empty();g_last_getmoredata_index=0;getMoreData()}else{$("#appendArea").empty().append('<div class="List-item NoMoreData"><div class="ContentItem" ><div class="ContentItem-status"  style="text-align:center">请输入有效的关键字</div></div></div>')}}});$("#searchInput").off("blur");$("#searchInput").on("blur",function(){a="false"});$("#searchInput").off("compositionstart");$("#searchInput").on("compositionstart",function(b){a="true"});$("#searchInput").off("compositionend");$("#searchInput").on("compositionend",function(b){a="false"});$(".SearchTabs .Tabs-link").off("click");$(".SearchTabs .Tabs-link").on("click",function(){$(".SearchTabs .Tabs-link").removeClass("is-active");$(this).addClass("is-active");g_search_type=$(this).attr("data-search-type");$("#appendArea").empty();g_last_getmoredata_index=0;getMoreData()})}function checkPopoverShow(){$(".PeoplePopover").off("mouseenter mouseleave");$(".PeoplePopover").on("mouseenter mouseleave",function(c){if(c.type=="mouseenter"){var k=$(this);var d=k.attr("data-author-id");var f=k.attr("data-author-name");var m=k.attr("data-author-avatar");var p=k.attr("data-author-mood");var e=k.attr("data-author-sexual");var n=k.attr("data-author-answer-nums");var l=k.attr("data-author-article-nums");var a=k.attr("data-author-follower-nums");if("f"==e){var o="she";var b="她"}else{var o="he";var b="他"}var h='<div><div class="HoverCard-titleContainer HoverCard-titleContainer--noAvatar"><img class="Avatar Avatar--large HoverCard-avatar" width="68" height="68" src="'+m+'"><div class="HoverCard-titleText"><div class="HoverCard-title"><span><a href="/er/'+d+'">'+f+'</a></span></div><div class="HoverCard-subtitle"><span class="RichText">'+p+'</span></div></div></div></div><div class="HoverCard-item"><div class="NumberBoard"><a class="Button NumberBoard-item Button--plain" type="button" href="/er/'+d+'/answers"><div class="NumberBoard-name">回答</div><div class="NumberBoard-value">'+n+'</div></a><a class="Button NumberBoard-item Button--plain" type="button" href="/er/'+d+'/articles"><div class="NumberBoard-name">文章</div><div class="NumberBoard-value">'+l+'</div></a><a class="Button NumberBoard-item Button--plain" type="button" href="/er/'+d+'/followers"><div class="NumberBoard-name">关注者</div><div class="NumberBoard-value" data-update-value-type="people-followed">'+a+"</div></a></div>";if($.inArray(""+d,g_user_follow_peoples_list)>=0){var g='<div class="MemberButtonGroup ProfileButtonGroup HoverCard-buttons"><button class="Button FollowButton Button--primary Button--grey" type="button" data-er-id="'+d+'" data-follow-type="people" data-followed="true" data-who="'+o+'">已关注</button><button class="Button" type="button" data-toggle="modal" data-target="#letterModal">'+letter_icon_svg+"<span>发私信</span></button></div></div>"}else{var g='<div class="MemberButtonGroup ProfileButtonGroup HoverCard-buttons"><button class="Button FollowButton Button--primary Button--green" type="button" data-er-id="'+d+'" data-follow-type="people" data-followed="false" data-who="'+o+'">关注'+b+'</button><button class="Button" type="button" data-toggle="modal" data-target="#letterModal">'+letter_icon_svg+"<span>发私信</span></button></div></div>"}var j=h+g;k.attr("data-content",j);k.popover("show");setLetterReceiver(d,f);checkFollow();$(".popover").on("mouseleave",function(){k.popover("hide")})}else{if(c.type=="mouseleave"){var k=$(this);console.log("PeoplePopover hide");setTimeout(function(){console.log($(".popover:hover").length);if(!$(".popover:hover").length){k.popover("hide")}},300)}}});$(".TopicPopover").off("mouseenter mouseleave");$(".TopicPopover").on("mouseenter mouseleave",function(a){if(a.type=="mouseenter"){var g=$(this);var k=g.attr("data-topic-id");var m=g.attr("data-topic-name");var l=g.attr("data-topic-avatar");var e=g.attr("data-topic-detail");var h=g.attr("data-topic-question-nums");var b=g.attr("data-topic-article-nums");var j=g.attr("data-topic-follower-nums");var d='<div><div class="HoverCard-titleContainer HoverCard-titleContainer--noAvatar"><img class="Avatar Avatar--large HoverCard-avatar" width="68" height="68" src="'+l+'"><div class="HoverCard-titleText"><div class="HoverCard-title"><a target="_blank" href="/topic/'+k+'">'+m+'</a></div></div></div></div><div class="HoverCard-item"><div class="NumberBoard"><a class="Button NumberBoard-item Button--plain" href="/topic/'+k+'/questions" type="button"><div class="NumberBoard-name">问题&nbsp;</div><div class="NumberBoard-value">'+h+'</div></a><a class="Button NumberBoard-item Button--plain" href="/topic/'+k+'/followers" type="button"><div class="NumberBoard-name">关注者</div><div class="NumberBoard-value" data-update-value-type="topic-followed">'+j+"</div></a></div>";if($.inArray(""+k,g_user_follow_topics_list)>=0){var c='<div class="HoverCard-buttons"><button class="Button FollowButton Button--primary Button--grey" type="button" data-topic-id="'+k+'" data-follow-type="topic" data-followed="true">已关注</button></div></div>'}else{var c='<div class="HoverCard-buttons"><button class="Button FollowButton Button--primary Button--green" type="button" data-topic-id="'+k+'" data-follow-type="topic" data-followed="false">关注</button></div></div>'}var f=d+c;g.attr("data-content",f);g.popover("show");checkFollow();$(".popover").on("mouseleave",function(){g.popover("hide")})}else{if(a.type=="mouseleave"){var g=$(this);setTimeout(function(){console.log($(".popover:hover").length);if(!$(".popover:hover").length){g.popover("hide")}},300)}}});$("#NotificationPopover").off("click");$("#NotificationPopover").click(function(b){saveUserDataToCookie("lnt",getTimeNow());saveUserDataToCookie("gnn",0);$("#NotificationPopover .PushNotifications-count").addClass("is-hide");$("#MessagePopover").popover("hide");$("#MenuPopover").popover("hide");b.stopPropagation();var a='<div class="Menu PushNotifications-menu"><div class="PushNotifications-content"><div class="PushNotifications-header" role="tablist"><button class="Button PushNotifications-tab PushNotifications-tab-active Button--plain" type="button">我的提醒</button></div><div class="PushNotifications-list"></div><div class="Notifications-footer"><a class="Button Button--plain" href="/settings/?sub=notification" type="button"><svg viewBox="0 0 20 20" class="Icon Button-icon Icon--setting" width="14" height="16" aria-hidden="true" style="height: 16px; width: 14px;"><title></title><g><path d="M18.868 15.185c-.164.096-.315.137-.452.137-.123 0-1.397-.26-1.617-.233-1.355.013-1.782 1.275-1.836 1.74-.055.454 0 .893.19 1.304.138.29.125.577-.067.85-.863.893-2.165 1.016-2.357 1.016-.123 0-.247-.055-.356-.15-.11-.097-.685-1.14-1.07-1.47-1.303-.954-2.246-.328-2.63 0-.397.33-.67.7-.835 1.126-.07.18-.18.302-.33.37-1.354.426-2.918-.92-3.014-1.056-.082-.11-.123-.22-.123-.356-.014-.138.383-1.276.342-1.688-.342-1.9-1.836-1.687-2.096-1.673-.303.014-.604.068-.92.178-.205.056-.396.03-.588-.054-.888-.462-1.137-2.332-1.11-2.51.055-.315.192-.52.438-.604.425-.164.81-.452 1.15-.85.932-1.262.344-2.25 0-2.634-.34-.356-.725-.645-1.15-.81-.137-.04-.233-.15-.328-.315C-.27 6.07.724 4.95.978 4.733c.255-.22.6-.055.723 0 .426.164.878.22 1.344.15C4.7 4.636 4.784 3.14 4.81 2.908c.015-.247-.11-1.29-.136-1.4-.027-.123-.014-.22.027-.315C5.318.178 7.073 0 7.223 0c.178 0 .33.055.44.178.108.124.63 1.11 1 1.4.398.338 1.582.83 2.588.013.398-.273.96-1.288 1.083-1.412.123-.123.26-.178.384-.178 1.56 0 2.33 1.03 2.438 1.22.083.124.096.248.07.37-.03.152-.33 1.153-.262 1.606.366 1.537 1.384 1.742 1.89 1.783.494.027 1.645-.357 1.81-.344.164.014.315.083.424.206.535.31.85 1.715.905 2.14.027.233-.014.44-.11.562-.11.138-1.165.714-1.48 1.112-.855.982-.342 2.25-.068 2.606.26.37 1.22.905 1.288.96.15.137.26.302.315.494.146 1.413-.89 2.387-1.07 2.47zm-8.905-.535c.644 0 1.246-.123 1.822-.356.575-.248 1.082-.59 1.493-1.016.425-.425.754-.92 1-1.495.247-.562.357-1.18.357-1.81 0-.66-.11-1.262-.356-1.825-.248-.562-.577-1.056-1.002-1.48-.41-.427-.918-.756-1.493-1.003-.576-.233-1.178-.357-1.822-.357-.644 0-1.247.124-1.81.357-.56.247-1.067.576-1.478 1.002-.425.425-.768.92-1 1.48-.247.564-.37 1.167-.37 1.826 0 .644.123 1.248.37 1.81.232.563.575 1.07 1 1.495.424.426.917.768 1.48 1.016.56.233 1.164.356 1.808.356z"></path></g></svg>设置</a><a class="Button Button--plain" href="/notifications" type="button">查看全部提醒</a></div></div></div>';$("#NotificationPopover").attr("data-content",a);$("#NotificationPopover").popover("show");if("null"==notifications){$.get("/ajax/notifications/1/0/10/",function(c){if("fail"!=c){notifications=c;appendNotificationElement(notifications)}})}else{appendNotificationElement(notifications)}$(".PushNotifications-tab").click(function(){$.get("/ajax/notifications/1/0/10/",function(c){if("fail"!=c){notifications=c;appendNotificationElement(notifications)}})});$(".Menu.PushNotifications-menu").click(function(c){c.stopPropagation()})});$("#MessagePopover").off("click");$("#MessagePopover").click(function(b){saveUserDataToCookie("lct",getTimeNow());saveUserDataToCookie("gcn",0);$("#MessagePopover .Messages-count").addClass("is-hide");$("#NotificationPopover").popover("hide");$("#MenuPopover").popover("hide");b.stopPropagation();var a='<div class="Menu Messages-menu"><div class="Messages-content"><div class="Messages-header" role="tablist"><button class="Button Messages-tab Messages-myMessageTab Button--plain" type="button">我的私信</button></div><div class="Messages-list"><div></div></div><div class="Messages-footer"><a class="Button Button--plain" href="/settings/?sub=conversation" type="button"><svg viewBox="0 0 20 20" class="Icon Button-icon Icon--setting" width="14" height="16" aria-hidden="true" style="height: 16px; width: 14px;"><title></title><g><path d="M18.868 15.185c-.164.096-.315.137-.452.137-.123 0-1.397-.26-1.617-.233-1.355.013-1.782 1.275-1.836 1.74-.055.454 0 .893.19 1.304.138.29.125.577-.067.85-.863.893-2.165 1.016-2.357 1.016-.123 0-.247-.055-.356-.15-.11-.097-.685-1.14-1.07-1.47-1.303-.954-2.246-.328-2.63 0-.397.33-.67.7-.835 1.126-.07.18-.18.302-.33.37-1.354.426-2.918-.92-3.014-1.056-.082-.11-.123-.22-.123-.356-.014-.138.383-1.276.342-1.688-.342-1.9-1.836-1.687-2.096-1.673-.303.014-.604.068-.92.178-.205.056-.396.03-.588-.054-.888-.462-1.137-2.332-1.11-2.51.055-.315.192-.52.438-.604.425-.164.81-.452 1.15-.85.932-1.262.344-2.25 0-2.634-.34-.356-.725-.645-1.15-.81-.137-.04-.233-.15-.328-.315C-.27 6.07.724 4.95.978 4.733c.255-.22.6-.055.723 0 .426.164.878.22 1.344.15C4.7 4.636 4.784 3.14 4.81 2.908c.015-.247-.11-1.29-.136-1.4-.027-.123-.014-.22.027-.315C5.318.178 7.073 0 7.223 0c.178 0 .33.055.44.178.108.124.63 1.11 1 1.4.398.338 1.582.83 2.588.013.398-.273.96-1.288 1.083-1.412.123-.123.26-.178.384-.178 1.56 0 2.33 1.03 2.438 1.22.083.124.096.248.07.37-.03.152-.33 1.153-.262 1.606.366 1.537 1.384 1.742 1.89 1.783.494.027 1.645-.357 1.81-.344.164.014.315.083.424.206.535.31.85 1.715.905 2.14.027.233-.014.44-.11.562-.11.138-1.165.714-1.48 1.112-.855.982-.342 2.25-.068 2.606.26.37 1.22.905 1.288.96.15.137.26.302.315.494.146 1.413-.89 2.387-1.07 2.47zm-8.905-.535c.644 0 1.246-.123 1.822-.356.575-.248 1.082-.59 1.493-1.016.425-.425.754-.92 1-1.495.247-.562.357-1.18.357-1.81 0-.66-.11-1.262-.356-1.825-.248-.562-.577-1.056-1.002-1.48-.41-.427-.918-.756-1.493-1.003-.576-.233-1.178-.357-1.822-.357-.644 0-1.247.124-1.81.357-.56.247-1.067.576-1.478 1.002-.425.425-.768.92-1 1.48-.247.564-.37 1.167-.37 1.826 0 .644.123 1.248.37 1.81.232.563.575 1.07 1 1.495.424.426.917.768 1.48 1.016.56.233 1.164.356 1.808.356z"></path></g></svg>设置</a><a class="Button Button--plain" href="/conversations/" type="button">查看全部私信</a></div></div></div>';$("#MessagePopover").attr("data-content",a);$("#MessagePopover").popover("show");if("null"==messages){$.get("/ajax/conversations/1/0/10/",function(c){if("fail"!=c){messages=c;appendMessageElement(messages)}})}else{appendMessageElement(messages)}$(".Messages-tab").click(function(){$.get("/ajax/conversations/1/0/10/",function(c){if("fail"!=c){messages=c;appendMessageElement(messages)}})});$(".Menu.Messages-menu").click(function(c){c.stopPropagation()})});$("#MenuPopover").off("click");$("#MenuPopover").click(function(c){$("#NotificationPopover").popover("hide");$("#MessagePopover").popover("hide");c.stopPropagation();var a=$(this).attr("data-er-id");var b='<div class="Menu Home-menu"><a class="Button Menu-item AppHeaderProfileMenu-item Button--plain" type="button" href="/er/'+a+'/"><svg viewBox="0 0 20 20" class="Icon Button-icon Icon--profile" width="14" height="16" aria-hidden="true" style="height: 16px; width: 14px;"><title></title><g><path d="M13.4170937,10.9231839 C13.0412306,11.5757324 12.5795351,12.204074 12.6542924,12.7864225 C12.9457074,15.059449 18.2164534,14.5560766 19.4340179,15.8344151 C20,16.4286478 20,16.4978969 20,19.9978966 C13.3887136,19.9271077 6.63736785,19.9978966 0,19.9978966 C0.0272309069,16.4978969 0,16.5202878 0.620443914,15.8344151 C1.92305664,14.3944356 7.20116276,15.1185829 7.40016946,12.7013525 C7.44516228,12.1563518 7.02015319,11.5871442 6.63736814,10.9228381 C4.51128441,7.2323256 3.69679769,4.67956187e-11 10,9.32587341e-14 C16.3032023,-4.66091013e-11 15.4216968,7.4429255 13.4170937,10.9231839 Z"></path></g></svg>我的主页</a><a class="Button Menu-item AppHeaderProfileMenu-item Button--plain" href="/settings/?sub=profile" type="button"><svg viewBox="0 0 20 20" class="Icon Button-icon Icon--setting" width="14" height="16" aria-hidden="true" style="height: 16px; width: 14px;"><title></title><g><path d="M18.868 15.185c-.164.096-.315.137-.452.137-.123 0-1.397-.26-1.617-.233-1.355.013-1.782 1.275-1.836 1.74-.055.454 0 .893.19 1.304.138.29.125.577-.067.85-.863.893-2.165 1.016-2.357 1.016-.123 0-.247-.055-.356-.15-.11-.097-.685-1.14-1.07-1.47-1.303-.954-2.246-.328-2.63 0-.397.33-.67.7-.835 1.126-.07.18-.18.302-.33.37-1.354.426-2.918-.92-3.014-1.056-.082-.11-.123-.22-.123-.356-.014-.138.383-1.276.342-1.688-.342-1.9-1.836-1.687-2.096-1.673-.303.014-.604.068-.92.178-.205.056-.396.03-.588-.054-.888-.462-1.137-2.332-1.11-2.51.055-.315.192-.52.438-.604.425-.164.81-.452 1.15-.85.932-1.262.344-2.25 0-2.634-.34-.356-.725-.645-1.15-.81-.137-.04-.233-.15-.328-.315C-.27 6.07.724 4.95.978 4.733c.255-.22.6-.055.723 0 .426.164.878.22 1.344.15C4.7 4.636 4.784 3.14 4.81 2.908c.015-.247-.11-1.29-.136-1.4-.027-.123-.014-.22.027-.315C5.318.178 7.073 0 7.223 0c.178 0 .33.055.44.178.108.124.63 1.11 1 1.4.398.338 1.582.83 2.588.013.398-.273.96-1.288 1.083-1.412.123-.123.26-.178.384-.178 1.56 0 2.33 1.03 2.438 1.22.083.124.096.248.07.37-.03.152-.33 1.153-.262 1.606.366 1.537 1.384 1.742 1.89 1.783.494.027 1.645-.357 1.81-.344.164.014.315.083.424.206.535.31.85 1.715.905 2.14.027.233-.014.44-.11.562-.11.138-1.165.714-1.48 1.112-.855.982-.342 2.25-.068 2.606.26.37 1.22.905 1.288.96.15.137.26.302.315.494.146 1.413-.89 2.387-1.07 2.47zm-8.905-.535c.644 0 1.246-.123 1.822-.356.575-.248 1.082-.59 1.493-1.016.425-.425.754-.92 1-1.495.247-.562.357-1.18.357-1.81 0-.66-.11-1.262-.356-1.825-.248-.562-.577-1.056-1.002-1.48-.41-.427-.918-.756-1.493-1.003-.576-.233-1.178-.357-1.822-.357-.644 0-1.247.124-1.81.357-.56.247-1.067.576-1.478 1.002-.425.425-.768.92-1 1.48-.247.564-.37 1.167-.37 1.826 0 .644.123 1.248.37 1.81.232.563.575 1.07 1 1.495.424.426.917.768 1.48 1.016.56.233 1.164.356 1.808.356z"></path></g></svg>设置</a><a class="Button Menu-item AppHeaderProfileMenu-item Button--plain" href="/exit/" type="button"><svg viewBox="0 0 20 20" class="Icon Button-icon Icon--logout" width="14" height="16" aria-hidden="true" style="height: 16px; width: 14px;"><title></title><g><path d="M0 10C0 7.242 1.154 4.58 3.167 2.697c.51-.477 1.31-.45 1.79.06.475.51.45 1.31-.06 1.787C3.37 5.975 2.53 7.91 2.53 10c0 4.118 3.35 7.468 7.47 7.468 4.12 0 7.47-3.35 7.47-7.47 0-2.04-.81-3.948-2.28-5.37-.5-.485-.514-1.286-.028-1.788.485-.5 1.286-.517 1.79-.03C18.915 4.712 20 7.265 20 10c0 5.512-4.486 9.998-10 9.998s-10-4.486-10-10zm8.7-.483V1.26C8.7.564 9.26 0 9.96 0c.695 0 1.26.564 1.26 1.26v8.257c0 .696-.565 1.26-1.26 1.26-.698 0-1.26-.564-1.26-1.26z"></path></g></svg>退出</a></div>';$("#MenuPopover").attr("data-content",b);$("#MenuPopover").popover("show");$(".Menu.Home-menu").click(function(d){d.stopPropagation()})})}function checkSmsSend(){$(".SignFlow-smsInputButton").off("click");$(".SignFlow-smsInputButton").click(function(){var e=$(this).hasClass("is-counting");if(e){console.log("counting,can`t click")}else{if("sign"==g_module){var c=$("input[name='regPhoneNo']").val()}else{var c=$("input[name='phoneNo']").val()}console.log(c);var b=/^1[3|4|5|7|8][0-9]{9}$/;var a=b.test(c);if(a){g_countdown_secs=59;$(this).addClass("is-counting").empty().append('<span id="counting-num">59</span>秒后可重发');setTimeout("countDown()",1000);setCookie("countdown",g_countdown_secs,g_countdown_secs);if("sign"==g_module){var d={phone_no:c,type:"register"}}else{if("misc"==g_module){var d={phone_no:c,type:"password_reset"}}}if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/send_sms/",d,function(f){if("fail"!=f){if("registered"==f){$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("该手机号已注册")}else{if("unregistered"==f){$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("该手机号未注册，无此用户")}else{$(".StepHeader-subtitle").text("验证码已发送到您的手机上，请查看并输入")}}}g_lock_ajax="false"})}else{console.log("phone no error");$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("手机号格式错误")}}})}function checkSignAndMiscPage(){$(".SignFlowInput-errorMask").click(function(){console.log("error mask click");$(this).addClass("SignFlowInput-errorMask--hidden");$(this).siblings(".Input-wrapper").children(".Input").val("").focus()});$(".SignFlow-switchPassword").off("click");$(".SignFlow-switchPassword").click(function(){var a=$(this).parents(".SignFlow-password").find(".Input");if("password"==a.attr("type")){a.attr("type","text");var b='<svg width="24" height="20" viewBox="0 0 24 24" class="Icon SignFlow-switchPasswordIcon Icon--read" aria-hidden="true" style="vertical-align: middle; height: 20px; width: 24px;"><title></title><g><title>Read</title><path d="M1 11.5C1 15 7 19 12 19s11-4 11-7.5S17 4 12 4 1 8 1 11.5zm11 5c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm-3-5c0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3-3 1.34-3 3z" fill-rule="evenodd"></path></g></svg>'}else{a.attr("type","password");var b='<svg width="24" height="20" viewBox="0 0 24 24" class="Icon SignFlow-switchPasswordIcon Icon--inconspicuous" aria-hidden="true" style="vertical-align: middle; height: 20px; width: 24px;"><title></title><g><title>Inconspicuous</title><path d="M17.007 11.504c0 .65-.13 1.26-.36 1.83l3 3.073S23 14.136 23 11.504C23 8.008 17.255 4 11.995 4c-1.4 0-2.741.25-3.982.701l2.161 2.16c.57-.23 1.18-.36 1.831-.36a5.004 5.004 0 0 1 5.002 5.003zM2.57 4.342l2.067 2.075C3.499 7.258 1 9.119 1 11.504c0 3.336 5.79 7.503 11.005 7.503 1.55 0 3.031-.3 4.382-.84l.42.42 2.125 2.118s.782.571 1.314 0-.074-1.305-.074-1.305L3.955 3.183s-.76-.742-1.385-.19c-.626.554 0 1.35 0 1.35zm4.963 4.96l1.55 1.552c-.05.21-.08.43-.08.65 0 1.66 1.341 3.001 3.002 3.001.22 0 .44-.03.65-.08l1.551 1.551c-.67.33-1.41.53-2.2.53a5.004 5.004 0 0 1-5.003-5.002c0-.79.2-1.53.53-2.201zm4.312-.78l3.151 3.152.02-.16c0-1.66-1.34-3.001-3.001-3.001l-.17.01z" fill-rule="evenodd"></path></g></svg>'}$(this).empty().append(b)});$("#switchRegisterLogin").click(function(){var a=$(".SignContainer-switch");if("login"==a.attr("data-action")){$(this).text("登录");$("#registerLoginText").text("已有帐号？");a.attr("data-action","register");$(".SignFlowHeader-title").text("注册"+SITE);$(".SignFlowHeader-slogen").text(SITE_SLOGAN);$("#register").removeClass("is-hide");$("#login").addClass("is-hide")}else{$(this).text("注册");$("#registerLoginText").text("没有帐号？");a.attr("data-action","login");$(".SignFlowHeader-title").text("登录"+SITE);$(".SignFlowHeader-slogen").text(SITE_SLOGAN);$("#register").addClass("is-hide");$("#login").removeClass("is-hide")}});$(".Login-cannotLogin").click(function(){location.href="/account/?arg=password_reset"});$(".Icon.Icon--remove").click(function(){console.log("Icon click");location.href="/"})}function checkRegisterValid(){console.log("need checkRegisterValid");var a=true;var d=$("input[name='regPhoneNo']").val();var b=/^1[3|4|5|7|8][0-9]{9}$/;var c=b.test(d);if(!c){console.log("phone no error");$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("手机号格式错误");a=false}var d=$("input[name='digits']").val();var b=/^[0-9]{6}$/;var c=b.test(d);if(!c){console.log("verification code error");$(".SignFlow-smsInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("验证码格式错误");a=false}var d=$("input[name='nickname']").val();if(d.length>=30){console.log("nickname too long:"+d.length);$(".SignFlow-username>.SignFlowInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("输入的昵称太长");a=false}var d=$("input[name='regPassword']").val();var b=/^[A-Za-z0-9]{6,18}$/;var c=b.test(d);if(!c){console.log("password error");$(".SignFlow-password>.SignFlowInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("密码为6~18位的字母或数字");a=false}return a}function checkLoginValid(){console.log("need checkLoginValid");var a=true;var d=$("input[name='loginPhoneNo']").val();var b=/^1[3|4|5|7|8][0-9]{9}$/;var c=b.test(d);if(!c){console.log("phone no error");$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("手机号格式错误");a=false}var d=$("input[name='loginPassword']").val();console.log(d);var b=/^[A-Za-z0-9]{6,18}$/;var c=b.test(d);if(!c){console.log("password error");$(".SignFlow-password>.SignFlowInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("密码为6~18位的字母或数字");a=false}return a}function checkSecondStep(){var a=true;var e=$("input[name='password']").val();var b=/^[A-Za-z0-9]{6,18}$/;var d=b.test(e);if(!d){console.log("password error");$(".SignFlow-password.SignFlow-password-first>.SignFlowInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("6~18位的字母或数字");a=false}var g=$("input[name='repeatPassword']").val();var b=/^[A-Za-z0-9]{6,18}$/;var d=b.test(g);if(!d){console.log("password error");$(".SignFlow-password.SignFlow-password-second>.SignFlowInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("6~18位的字母或数字");a=false}if(false==a){return false}if(e!=g){console.log("password not equal");$(".SignFlow-password>.SignFlowInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("两次密码输入不一致");a=false}if(false==a){return false}var f=$("input[name='phoneNo']").val();var c=$("input[name='digits']").val();if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/reset_pwd/",{phone_no:f,veri_code:c,pwd:e},function(h){if("fail"!=h){if("success"==h){console.log("reset ok");location.href="/account/?arg=reset_pwd_success"}}g_lock_ajax="false"});return false}function checkFirstStep(){var a=true;var e=$("input[name='phoneNo']").val();console.log(e);var b=/^1[3|4|5|7|8][0-9]{9}$/;var d=b.test(e);if(!d){console.log("phone no error");$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("手机号格式错误");a=false}var c=$("input[name='digits']").val();var b=/^[0-9]{6}$/;var d=b.test(c);if(!d){console.log("verification code error");$(".SignFlow-smsInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("验证码格式错误");a=false}if(false==a){return false}if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/check_sms/",{phone_no:e,type:"password_reset",veri_code:c},function(f){if("fail"!=f){if("unregistered"==f){$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("该手机号未注册，无此用户")}else{if("veri_code_error"==f){$(".SignFlow-smsInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("验证码错误")}else{if("veri_code_ok"==f){console.log("check next step ok");$(".SignFlow-account").addClass("is-hide");$(".SignFlow-SMSInput").addClass("is-hide");$(".SignFlow-password").removeClass("is-hide");$(".PasswordReset-nextStep").text("重置密码");$(".StepHeader-title").text("设置新密码");$(".StepHeader-subtitle").text("新密码长度为6~18位，包含字母或数字");$(".PasswordReset-step").attr("onsubmit","return checkSecondStep()")}}}}g_lock_ajax="false"});return false}function checkReturnHomePage(){$(".ReturnHomePage").off("click");$(".ReturnHomePage").click(function(){$("main").empty().append(g_cache_page);checkHomePage();checkNextPage()})}function checkNextPage(){$(".NextPage").off("click");$(".NextPage").on("click",function(){console.log(this);g_subcmd=$(this).attr("data-next-page-type");g_cache_page=$("main").html();var a='<div class="Card Profile-datalist" id="Profile-datalist"><div id="appendArea" class=""><div class="ProfileHeader-expandActions ProfileEdit-expandActions"><button class="Button--green ReturnHomePage" style="margin:3px" type="button">返回我的主页</button></div></div></div>';$("main").empty().append(a);getMoreData();checkReturnHomePage()})}function checkAvatar(){$(".Avatar-editor").hover(function(){$(".Mask").removeClass("Mask-hidden")},function(){$(".Mask").addClass("Mask-hidden")});$(".Mask-content").click(function(){$("#id_avatar_input").click()});$("#id_avatar_input").on("change",function(){$("#upAvatarModal").modal("show");var a=getObjectURL(this.files[0]);if(a){$("#preview_avatar").attr("src",a);$("#adjust_choosebox").val(50);setTimeout(adjustChooseBox,1*1000)}});$(".AvatarSave").click(function(){var d=$(this).attr("data-avatar-type");var c=document.getElementById("preview_avatar");imgWidth=c.naturalWidth;var f=document.getElementById("avatar_canvas");var b=f.getContext("2d");var h=($("#chooseBox").position().left-$("#preview_avatar").position().left)*(c.naturalWidth/300);var g=($("#chooseBox").position().top-$("#preview_avatar").position().top)*(c.naturalHeight/300);var e=a=(200+($("#adjust_choosebox").val()-50)*2)*(c.naturalWidth/300);var a=(200+($("#adjust_choosebox").val()-50)*2)*(c.naturalHeight/300);b.drawImage(c,h,g,e,a,0,0,200,200);f.toBlob(function(j){console.log(j);uploadImage(d,j)},"image/jpeg")})}function checkHomePage(){$(".ProfileEditButton,.ProfileHeader-expandButton").click(function(){g_cache_page=$("main").html();if($(this).hasClass("ProfileHeader-expandButton")){if("true"!=g_show_detailed){var e='<div><div class="ProfileHeader-detail"><div class="ProfileHeader-detailItem"><span class="ProfileHeader-detailLabel">居住地</span><div class="ProfileHeader-detailValue"><span>'+g_er_residence+'</span></div></div><div class="ProfileHeader-detailItem"><span class="ProfileHeader-detailLabel">所在行业</span><div class="ProfileHeader-detailValue">'+g_er_job+'</div></div><div class="ProfileHeader-detailItem"><span class="ProfileHeader-detailLabel">个人简介</span><div class="RichText ProfileHeader-detailValue">'+g_er_intro+"</div></div></div></div>";$(".ProfileHeader-contentBody").css({height:"129px"}).empty().append(e);$(".ProfileHeader-expandButton").empty().append('<svg viewBox="0 0 10 6" class="Icon ProfileHeader-arrowIcon is-active Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg>收起详细资料');g_show_detailed="true"}else{$(".ProfileHeader-contentBody").css({height:"50px"}).empty().append(g_contentbody_data);$(".ProfileHeader-expandButton").empty().append('<svg viewBox="0 0 10 6" class="Icon ProfileHeader-arrowIcon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg>查看详细资料');g_show_detailed="false"}}else{var c='<div class="ProfileHeader-header"><div class="UserCoverEditor"><div><div class="UserCoverGuide"><div class="UserCoverGuide-inner"><div class="UserCoverGuide-buttonContainer"><button class="Button DynamicColorButton" type="button"><svg viewBox="0 0 20 16" class="Icon Icon--camera Icon--left" width="14" height="16" aria-hidden="true" style="height: 16px; width: 14px;"><title></title><g><path d="M18.094 2H15s-1-2-2-2H7C6 0 5 2 5 2H2C0 2 0 3.967 0 3.967V14c0 2 2.036 2 2.036 2H17c3 0 3-1.983 3-1.983V4c0-2-1.906-2-1.906-2zM10 12c-1.933 0-3.5-1.567-3.5-3.5S8.067 5 10 5s3.5 1.567 3.5 3.5S11.933 12 10 12zm0 1.5c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm7.5-8c-.552 0-1-.448-1-1s.448-1 1-1 1 .448 1 1-.448 1-1 1z" fill-rule="evenodd"></path></g></svg>上传封面图片</button></div><div class="UserCoverGuide-dialog"><h4 class="UserCoverGuide-dialogHead">上传一张图片，展示在这里</h4><div class="UserCoverGuide-dialogContent"><p class="UserCoverGuide-dialogDescription">你可以使用自己的摄影作品、你喜欢的照片，或是任何能展现你特质的图片。</p><a href="" target="_blank" rel="noopener noreferrer">哪里能找到可免费使用的优质图片？</a></div></div></div><ul class="UserCoverGuide-items"></ul></div><div class="UserCover"></div></div><input type="file" accept="image/png,image/jpeg" style="display: none;"></div></div>';var d='<div><div class="UserAvatarEditor ProfileHeader-avatar"><div class="UserAvatar"><img id="id_avatar" class="Avatar Avatar--large UserAvatar-inner" width="160" height="160" src="'+g_er_avatar+'"></div><div class="Mask UserAvatarEditor-mask"><div class="Mask-mask Mask-mask--black UserAvatarEditor-maskInner"></div><div class="Mask-content"><svg class="Zi Zi--Camera UserAvatarEditor-cameraIcon" fill="currentColor" viewBox="0 0 24 24" width="36" height="36"><path d="M20.094 6S22 6 22 8v10.017S22 20 19 20H4.036S2 20 2 18V7.967S2 6 4 6h3s1-2 2-2h6c1 0 2 2 2 2h3.094zM12 16a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7zm0 1.5a5 5 0 1 0-.001-10.001A5 5 0 0 0 12 17.5zm7.5-8a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" fill-rule="evenodd"></path></svg><div class="UserAvatarEditor-maskInnerText">修改我的头像</div></div></div><input id="id_avatar_input" name="file" type="file" accept="image/png,image/jpeg" style="display: none;"></div></div>';var f='<div class="ProfileHeader-content"><div class="ProfileHeader-contentHead"><h1 class="ProfileHeader-title"><span class="ProfileHeader-name">'+g_er_name+'</span></h1><div class="ProfileHeader-expandActions ProfileEdit-expandActions"><a class="Button Button--plain" type="button" href="/er/'+g_er_id+'">返回我的主页<svg viewBox="0 0 10 6" class="Icon ProfileEdit-arrowIcon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg></a></div></div><div class="ProfileEdit-fields"><form class="Field"><h3 class="Field-label">昵称</h3><div class="Field-content" data-field-type="nickname"><div><span class="Field-text"><span class="RichText">'+g_er_name+'</span></span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button">'+modify_icon_svg+'修改</button></div></div></form><form class="Field"><h3 class="Field-label">性别</h3><div class="Field-content" data-field-type="sexual"><div><span class="Field-text">'+g_er_sexual_han+'</span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button">'+modify_icon_svg+'修改</button></div></div></form><form class="Field"><h3 class="Field-label">一句话介绍</h3><div class="Field-content" data-field-type="mood"><div><span class="Field-text"><span class="RichText">'+g_er_mood+'</span></span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button">'+modify_icon_svg+'修改</button></div></div></form><form class="Field"><h3 class="Field-label">居住地</h3><div class="Field-content" data-field-type="residence"><div><span class="Field-text"><span class="RichText">'+g_er_residence+'</span></span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button">'+modify_icon_svg+'修改</button></div></div></form><form class="Field"><h3 class="Field-label">所在行业</h3><div class="Field-content" data-field-type="job"><div><span class="Field-text">'+g_er_job+'</span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button">'+modify_icon_svg+'修改</button></div></div></form><form class="Field"><h3 class="Field-label">个人简介</h3><div class="Field-content" data-field-type="intro"><div class="DescriptionField-content"><span class="Field-text"><span class="RichText">'+g_er_intro+'</span></span><button class="Button ModifyButton Field-modify Field-modify-hidden Button--link" type="button">'+modify_icon_svg+"修改</button></div></div></form></div></div></div>";var e='<div class="ProfileEdit"><div class="Card">'+c+'<div class="ProfileHeader-main">'+d+f+"</div></div>";$("main").empty().append(e);checkReturnHomePage();checkAvatar();b()}});function a(){$(".save").off("click");$(".save").click(function(){var e=$(this);var d=$(this).parents(".Field-content").attr("data-field-type");var c=$("input[name='"+d+"']").val();if("sexual"==d){var c=$("input[name='sexual']:checked").val()}else{if("intro"==d){var c=$("textarea[name='intro']").val()}}if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/profile_edit/",{field_type:d,content:c},function(f){if("fail"!=f){if("nickname"==d){g_er_name=f;var g='<div><span class="Field-text"><span class="RichText">'+g_er_name+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>";$(".ProfileHeader-name").empty().append(g_er_name)}else{if("sexual"==d){if("f"==f){g_er_sexual="she";g_er_sexual_han="女"}else{if("m"==f){g_er_sexual="he";g_er_sexual_han="男"}}var g='<div><span class="Field-text">'+g_er_sexual_han+'</span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("mood"==d){g_er_mood=f;var g='<div><span class="Field-text"><span class="RichText">'+g_er_mood+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("residence"==d){g_er_residence=f;var g='<div><span class="Field-text"><span class="RichText">'+g_er_residence+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("job"==d){g_er_job=f;var g='<div><span class="Field-text">'+g_er_job+'</span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("intro"==d){g_er_intro=f;var g='<div class="DescriptionField-content"><span class="Field-text"><span class="RichText">'+g_er_intro+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}}}}}}e.parents(".Field-content").empty().append(g)}g_lock_ajax="false";b()})});$(".cancle").off("click");$(".cancle").click(function(){var d=$(this).parents(".Field-content").attr("data-field-type");if("nickname"==d){var c='<div><span class="Field-text"><span class="RichText">'+g_er_name+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("sexual"==d){var c='<div><span class="Field-text">'+g_er_sexual_han+'</span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("mood"==d){var c='<div><span class="Field-text"><span class="RichText">'+g_er_mood+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("residence"==d){var c='<div><span class="Field-text"><span class="RichText">'+g_er_residence+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("job"==d){var c='<div><span class="Field-text">'+g_er_job+'</span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("intro"==d){var c='<div class="DescriptionField-content"><span class="Field-text"><span class="RichText">'+g_er_intro+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}}}}}}$(this).parents(".Field-content").empty().append(c);b()})}function b(){$(".Field").off("mouseenter mouseleave");$(".Field").on("mouseenter mouseleave",function(c){if(c.type=="mouseenter"){$(this).find(".ModifyButton").removeClass("Field-modify-hidden")}else{if(c.type=="mouseleave"){$(this).find(".ModifyButton").addClass("Field-modify-hidden")}}});$(".Field").find(".ModifyButton").off("click");$(".Field").find(".ModifyButton").click(function(){var d=$(this).parents(".Field-content").attr("data-field-type");if("nickname"==d){var c='<div><div class="HeadlineField-input Input-wrapper"><input name="nickname" class="Input" value="'+g_er_name+'"></div><div class="HeadlineField-actions"><div class="ButtonGroup HeadlineField-buttonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>'}else{if("sexual"==d){if("f"==g_er_sexual){var c='<div><input type="radio" name="sexual" value="m"> 男<input type="radio" name="sexual" value="f" checked style="margin-left: 30px;"> 女<div class="ButtonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div></div>'}else{var c='<div><input type="radio" name="sexual" value="m" checked> 男<input type="radio" name="sexual" value="f" style="margin-left: 30px;"> 女<div class="ButtonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div></div>'}}else{if("mood"==d){var c='<div><div class="HeadlineField-input Input-wrapper"><input name="mood" class="Input" value="'+g_er_mood+'"></div><div class="HeadlineField-actions"><div class="ButtonGroup HeadlineField-buttonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>'}else{if("residence"==d){var c='<div><div class="HeadlineField-input Input-wrapper"><input name="residence" class="Input" value="'+g_er_residence+'"></div><div class="HeadlineField-actions"><div class="ButtonGroup HeadlineField-buttonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>';$(this).parents(".Field-content").empty().append(c)}else{if("job"==d){var c='<div><div class="HeadlineField-input Input-wrapper"><input name="job" class="Input" value="'+g_er_job+'"></div><div class="HeadlineField-actions"><div class="ButtonGroup HeadlineField-buttonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>'}else{if("intro"==d){var c='<div><textarea name="intro" rows="3" class="DescriptionField-input TextArea">'+g_er_intro+'</textarea><div class="DescriptionField-actions"><div class="ButtonGroup DescriptionField-buttonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>'}}}}}}$(this).parents(".Field-content").empty().append(c);a()})}}function checkSettingPage(){$("a[name='messages']").off("click");$("a[name='messages']").on("click",function(){var d=$(this).parents(".List-item");var b=d.attr("data-action-id");var e=d.attr("data-receiver-id");var c=d.attr("data-receiver-name");a(b,e,c)});$("a[name='reply']").off("click");$("a[name='reply']").on("click",function(){var c=$(this).parents(".List-item");console.log(c);var d=c.attr("data-receiver-id");var b=c.attr("data-receiver-name");setLetterReceiver(d,b)});$("a[name='delete']").off("click");$("a[name='delete']").on("click",function(){var c=$(this).parents(".List-item");var d=c.attr("data-action");var b=c.attr("data-action-id");if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/"+d+"/"+b+"/",function(e){if("success"==e){c.remove()}g_lock_ajax="false"})});function a(k,d,j){var g='<div class="List-item Conversation-messages-head"><div class="zg-section"><a href="/conversations">« 返回</a></div><div class="zg-section zg-14px"><span class="zg-gray-normal">发私信给 </span><span class="zg-gray-darker">'+j+'</span>：</div><div class="zg-section LetterSend" id="zh-pm-editor-form"><div class="zg-editor-simple-wrap zg-form-text-input"><div class="zg-user-name" style="display:none"></div><textarea id="letterText" class="zg-editor-input zu-seamless-input-origin-element" style="font-weight: normal; height: 22px;" data-receiver-id="'+d+'"></textarea></div><div class="zh-pm-warnmsg" style="display:none;text-align:right;color:#C3412F;"></div><div class="zm-command"><button class="Button Messages-sendButton Button--primary Button--green" type="button" onclick="sendLetter()">发送</button></div></div></div>';$("#appendArea").empty().prepend(g);g_last_getmoredata_index=0;g_setting_type="conversation_messages";var l=g_last_getmoredata_index;var e=1;var c=l;var f=c+STEP;var b="/ajax/"+g_setting_type+"/"+k+"/"+e+"/"+c+"/"+f+"/";var h="";if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post(b,h,function(m){if("fail"!=m){g_last_getmoredata_index+=STEP;appendSettingPageElement(m)}else{console.log("no more data");$("#appendArea").append('<div class="List-item NoMoreData"><div class="ContentItem" ><div class="ContentItem-status"  style="text-align:center">没有更多内容</div></div></div>')}g_lock_ajax="false"})}}function checkSelectOption(){$(".selectpicker").on("show.bs.select",function(f){if("false"==g_selectpicker_init){if(""==cache_topics){var c="1";if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/topics/"+c+"/0/0/",function(h){if("fail"!=h){cache_topics=h;for(var j in cache_topics){var g=cache_topics[j][0];var e=cache_topics[j][1];$(".selectpicker").append("<option value="+g+":"+e+">"+e+"</option>")}$(".selectpicker").selectpicker("refresh");g_selectpicker_init="true"}g_lock_ajax="false"})}else{for(var d in cache_topics){var b=cache_topics[d][0];var a=cache_topics[d][1];$(".selectpicker").append("<option value="+b+":"+a+">"+a+"</option>")}$(".selectpicker").selectpicker("refresh");g_selectpicker_init="true"}}else{console.log("select has init")}})}function getComments(a,c){var b={c_type:a,a_id:c};if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/get_comments/",b,function(d){if("fail"!=d){console.log("get comments success");appendCommentsElement(d)}checkComment();g_lock_ajax="false"})}function checkComment(){var b="";var a="false";$(".Button-comment-send.CommentEditor-singleButton").attr("disabled","");$(".Comments-footer").find(".public-DraftEditorPlaceholder-inner").removeClass("is-hide");$(".Comments-footer").find(".public-DraftEditor-content").empty();$(".Button-comment-send").off("mousedown");$(".Button-comment-send").on("mousedown",function(){console.log("mousedown");if(false==veriLogin()){return}var d=$(this).closest(".CommentItem").attr("data-comment-id");if("article"==g_module){var c="article";var f=g_article_id}else{var c=$(this).parents(".ContentItem.AnswerItem").attr("data-content-type");var f=$(this).parents(".ContentItem.AnswerItem").attr("data-content-id")}if(typeof(d)=="undefined"){d=0}console.log(f);console.log(d);if(b.length>MIDDLE_TEXT_MAX_LENGTH){b=b.substr(0,MIDDLE_TEXT_MAX_LENGTH-1)}var e={c_type:c,a_id:f,c_content:b,parent_comment_id:d};$.post("/ajax/comment/",e,function(g){if("fail"!=g){console.log("comment success");appendCommentsElement(g);checkComment()}});$(this).attr("disabled","");$(this).parents(".Comments-footer").find(".public-DraftEditorPlaceholder-inner").removeClass("is-hide");$(this).parents(".Comments-footer").find(".public-DraftEditor-content").empty();$(this).closest(".CommentItem").find(".CommentItem-footer").removeClass("is-hide");$(this).closest(".CommentItem-editor").remove()});$(".Button-comment-cancle").off("mousedown");$(".Button-comment-cancle").on("mousedown",function(){console.log("mousedown");$(this).closest(".CommentItem").find(".CommentItem-footer").removeClass("is-hide");$(this).closest(".CommentItem-editor").remove()});$(".public-DraftEditor-content").off("click");$(".public-DraftEditor-content").on("click",function(){$(this).parents(".CommentEditor--nouse").addClass("CommentEditor--active");$(this).parents(".CommentEditor-input").addClass("is-focus");$(this).parents(".Input.Editable").addClass("Editable--focus")});$(".public-DraftEditor-content").off("keyup");$(".public-DraftEditor-content").on("keyup",function(){$(this).parents(".DraftEditor-root").find(".public-DraftEditorPlaceholder-inner").addClass("is-hide");if("false"==a){b=$(this).text();console.log(b);if(""!=b){$(this).parents(".CommentEditor--nouse").find(".Button-comment-send").removeAttr("disabled")}else{$(this).parents(".CommentEditor--nouse").find(".Button-comment-send").attr("disabled","")}}});$(".public-DraftEditor-content").off("compositionstart");$(".public-DraftEditor-content").on("compositionstart",function(c){a="true"});$(".public-DraftEditor-content").off("compositionend");$(".public-DraftEditor-content").on("compositionend",function(c){a="false"});$(".public-DraftEditor-content").off("blur");$(".public-DraftEditor-content").on("blur",function(){console.log("blur");$(this).parents(".CommentEditor--nouse").removeClass("CommentEditor--active");$(this).parents(".CommentEditor-input").removeClass("is-focus");$(this).parents(".Input.Editable").removeClass("Editable--focus");a="false"});$(".Comments-Packup-Button").off("click");$(".Comments-Packup-Button").on("click",function(){var e=$(this).parents(".ContentItem.AnswerItem");e.find(".Comments-container").remove();var c=e.attr("data-comment-nums");var d=e.find(".Zi--Comment.Button-zi").closest("span");e.find(".Zi--Comment.Button-zi").closest("button").empty().append(d).children("span").after(c+" 条评论");$(this).closest("span").remove()});$(".Button-like-nouse").off("click");$(".Button-like-nouse").each(function(){$(this).click(function(){var c=$(this);var d=c.attr("data-like-type");var f=c.attr("data-like-id");if("comment"==d){if(c.closest(".ContentItem.AnswerItem").length>0){d="comment_answer"}else{d="comment_article"}}console.log(d);console.log(f);var e={l_type:d,l_id:f};if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/like/",e,function(g){if("fail"!=g){var h=c.children("svg");c.attr("disabled","").empty().append(h).append(g)}g_lock_ajax="false"})})})}function checkInteractionButton(){$(".Button-like-nouse").off("click");$(".Button-like-nouse").each(function(){$(this).click(function(){var a=$(this);var b=a.attr("data-like-type");var d=a.attr("data-like-id");if("comment"==b){if(a.closest(".ContentItem.AnswerItem").length>0){b="comment_answer"}else{b="comment_article"}}console.log(b);console.log(d);var c={l_type:b,l_id:d};if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/like/",c,function(e){if("fail"!=e){var f=a.children("svg");a.attr("disabled","").empty().append(f).append(e)}g_lock_ajax="false"})})});$(".Zi--Comment.Button-zi").closest("button").off("click");$(".Zi--Comment.Button-zi").closest("button").on("click",function(){if("article"==g_module){console.log("scroll into comment");document.getElementsByClassName("CommentList")[0].scrollIntoView()}else{var g=$(this).parents(".ContentItem.AnswerItem");if(g.find(".Comments-container").length>0){g.find(".Comments-container").remove();var a=g.attr("data-comment-nums");var f=$(this).children("span");$(this).empty().append(f).children("span").after(a+" 条评论");g.find(".Comments-Packup-Button").closest("span").remove()}else{$(".CommentList").removeClass("CommentList--current");var a=g.attr("data-comment-nums");var d='<div class="Comments-container"><div class="Comments Comments--withEditor Comments-withPagination"><div class="Topbar CommentTopbar"><div class="Topbar-title"><h2 class="CommentTopbar-title">'+a+' 条评论</h2></div><div class="Topbar-options"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display: inline-flex; align-items: center;">&#8203;<svg class="Zi Zi--Switch Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M13.004 7V4.232c0-.405.35-.733.781-.733.183 0 .36.06.501.17l6.437 5.033c.331.26.376.722.1 1.033a.803.803 0 0 1-.601.264H2.75a.75.75 0 0 1-.75-.75V7.75A.75.75 0 0 1 2.75 7h10.254zm-1.997 9.999v2.768c0 .405-.35.733-.782.733a.814.814 0 0 1-.5-.17l-6.437-5.034a.702.702 0 0 1-.1-1.032.803.803 0 0 1 .6-.264H21.25a.75.75 0 0 1 .75.75v1.499a.75.75 0 0 1-.75.75H11.007z" fill-rule="evenodd"></path></svg></span>切换为时间排序</button></div></div><div class="Comments-footer CommentEditor--normal CommentEditor--nouse"><div class="CommentEditor-input Input-wrapper Input-wrapper--spread Input-wrapper--large Input-wrapper--noPadding"><div class="Input Editable"><div class="Dropzone RichText ztext" style="min-height: 198px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner">写下你的评论...</div></div><div class="DraftEditor-editorContainer"><div class="notranslate public-DraftEditor-content" contenteditable="true" role="textbox" spellcheck="true" tabindex="0" style="outline: none; white-space: pre-wrap; word-wrap: break-word;"></div></div></div></div><div></div></div></div><button disabled="" type="button" class="Button Button-comment-send CommentEditor-singleButton Button--primary Button--green">评论</button></div><div class="CommentList CommentList--current"></div><div class="Comments-footer CommentEditor--normal CommentEditor--nouse CommentEditor--nouse--bottom is-hide"><div class="CommentEditor-input Input-wrapper Input-wrapper--spread Input-wrapper--large Input-wrapper--noPadding"><div class="Input Editable"><div class="Dropzone RichText ztext" style="min-height: 198px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner">写下你的评论...</div></div><div class="DraftEditor-editorContainer"><div class="notranslate public-DraftEditor-content" contenteditable="true" role="textbox" spellcheck="true" tabindex="0" style="outline: none; white-space: pre-wrap; word-wrap: break-word;"></div></div></div></div><div></div></div></div><button disabled="" type="button" class="Button Button-comment-send CommentEditor-singleButton Button--primary Button--green">评论</button></div></div></div>';g.append(d);var f=$(this).children("span");$(this).empty().append(f).children("span").after("收起评论");var e='<span><button class="Comments-Packup-Button" style="left: 673px;z-index:999;">收起评论<svg viewBox="0 0 10 6" class="Icon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg></button></span>';g.append(e);var b=g.attr("data-content-id");var c=g.attr("data-content-type");getComments(c,b)}}})}function checkAnswerQuestion(){var b="";function a(){if((b.length>=TEXT_MIN_LENGTH_LOW)){$(".AnswerForm-submit").removeAttr("disabled")}else{$(".AnswerForm-submit").attr("disabled","")}}$("#summernote_answer").on("summernote.change",function(d,e,c){b=e.replace("<p><br></p>","").replace("<p>","").replace("</p>","");a()});$(".ShowAnswerBar-nouse").off("click");$(".ShowAnswerBar-nouse").on("click",function(){if(false==veriLogin()){return}if($(".AnswerToolbar").hasClass("is-hide")){$(".AnswerToolbar").removeClass("is-hide");$(".AnswerToolbar .AuthorInfo-avatar").attr("src",g_user_avatar).attr("alt",g_user_name);$(".AnswerToolbar .AuthorInfo-name").empty().append(g_user_name)}else{$(".AnswerToolbar").addClass("is-hide")}});$(".HideAnswerBar-nouse").off("click");$(".HideAnswerBar-nouse").on("click",function(){$(".AnswerToolbar").addClass("is-hide")});$(".AnswerForm-submit").off("click");$(".AnswerForm-submit").on("click",function(){var c="/ajax/question_answer/"+g_question_id+"/";var d=$("#summernote_answer").summernote("code");if(d>LARGE_TEXT_MAX_LENGTH){d=d.substr(0,LARGE_TEXT_MAX_LENGTH-1)}var e=new FormData();e.append("content",d);$.ajax({data:e,type:"POST",url:c,cache:false,contentType:false,processData:false,success:function(f){if("fail"!=f){location.href=f}}})})}function checkAsk(){var g="";var d=[];var c="";function b(){if((""!=g)&&(d.length>0)){$(".QuestionAsk .QuestionAsk-buttonGroup>button").removeAttr("disabled")}else{$(".QuestionAsk .QuestionAsk-buttonGroup>button").attr("disabled","")}}function f(){$(".QuestionAsk .QuestionAsk-title textarea").on("input",function(){g=$("textarea[name='title']").val();b()})}function a(){$(".QuestionAsk .selectpicker").on("changed.bs.select",function(h){d=$(".QuestionAsk .selectpicker").val();if(d.length>0){$(".QuestionAsk .pull-left").addClass("selected")}else{$(".QuestionAsk .pull-left").removeClass("selected")}b();$(".bootstrap-select .dropdown-menu").trigger("click")})}function e(){$("#summernote_question").on("summernote.change",function(j,k,h){c=k.replace("<p><br></p>","").replace("<p>","").replace("</p>","")})}$(".QuestionAsk .QuestionAsk-buttonGroup>button").click(function(){if(g.length>LITTLE_TEXT_MAX_LENGTH){g=g.substr(0,LITTLE_TEXT_MAX_LENGTH-1);$("textarea[name='title']").val(g)}if(c.length>MIDDLE_TEXT_MAX_LENGTH){c=c.substr(0,MIDDLE_TEXT_MAX_LENGTH-1)}$("input[name='detail']").val(c);$(this).closest("form").submit()});f();a();e();$("#askModal").on("shown.bs.modal",function(){if(false==veriLogin()){return}$("#askModal").off("click.dismiss.bs.modal",'[data-dismiss="modal"]');$("#askModal").on("click.dismiss.bs.modal",'[data-dismiss="modal"]',function(){$("#askModal .modal").modal("hide");$("#askModal").modal("hide")})});$("#askModal .note-editor button.close").off("mousedown");$("#askModal .note-editor button.close").on("mousedown",function(h){$("#askModal").off("click.dismiss.bs.modal",'[data-dismiss="modal"]');h.preventDefault();setTimeout(function(){$("#askModal").on("click.dismiss.bs.modal",'[data-dismiss="modal"]',function(){$("#askModal .modal").modal("hide");$("#askModal").modal("hide")})},1000)});$("#askModal .Modal-closeButton").off("click");$("#askModal .Modal-closeButton").on("click",function(){console.log("modal close buttion click");$("textarea[name='title']").val("");$(".selectpicker").empty();$(".selectpicker").selectpicker("refresh");g_selectpicker_init="false";$("#summernote_question").summernote("code","")})}function checkWrite(){var g="";var f=[];var e="";if("revise"==g_module){g=g_article_title;f=["fake"];e=g_article_content}function b(){if((""!=g)&&(f.length>0)&&(e.length>=TEXT_MIN_LENGTH_HIGH)){$(".WritePost").removeAttr("disabled")}else{$(".WritePost").attr("disabled","")}}function d(){$(".WriteIndex-titleInput .Input").on("input",function(){g=$("input[name='writeTitle']").val();b()})}function c(){$(".Wirte-select .selectpicker").on("changed.bs.select",function(h){f=$(".Wirte-select .selectpicker").val();if(f.length>0){$(".Wirte-select .pull-left").addClass("selected")}else{$(".Wirte-select .pull-left").removeClass("selected")}b();$(".bootstrap-select .dropdown-menu").trigger("click")})}function a(){$("#summernote_write").on("summernote.change",function(j,k,h){e=k.replace("<p><br></p>","").replace("<p>","").replace("</p>","");b()})}$(".WritePost").click(function(){if(g.length>LITTLE_TEXT_MAX_LENGTH){g=g.substr(0,LITTLE_TEXT_MAX_LENGTH-1);$("input[name='writeTitle']").val(g)}if(e.length>LARGE_TEXT_MAX_LENGTH){e=e.substr(0,LARGE_TEXT_MAX_LENGTH-1)}$("input[name='writeContent']").val(e);$(this).closest("form").submit()});d();c();a()}function checkSets(){checkAsk();checkFollow();checkContentClick();checkContentExpand();checkContentCollapse();checkPopoverShow();checkInteractionButton();checkAnswerQuestion();checkSearch()}function getMoreData(){if($(".List-item.NoMoreData").length>0){return}if("index"==g_module){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;var d="/ajax/questions/"+a+"/"+g+"/"+b+"/";var f={follow_topics:""+g_user_follow_topics_list}}else{if("question"==g_module){if("all"==g_list_type){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;var d="/ajax/answers/"+g_question_id+"/"+a+"/"+g+"/"+b+"/";var f=""}else{return}}else{if("topic"==g_module){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;var d="/ajax/topic/"+g_topic_id+"/"+a+"/"+g+"/"+b+"/";var f={type:g_type}}else{if("mytopic"==g_module){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;var d="/ajax/topic/"+g_topic_id+"/"+a+"/"+g+"/"+b+"/";var f={type:"hot"}}else{if("alltopics"==g_module){var e=g_last_getmoredata_index;var c="0";var g=e;var b=g+STEP;var d="/ajax/topics/"+c+"/"+g+"/"+b+"/";var f=""}else{if("search"==g_module){if((""!=g_search_keyword)&&(""!=g_search_type)){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;var d="/ajax/search/"+g_search_type+"/"+a+"/"+g+"/"+b+"/";var f={keyword:g_search_keyword}}else{return}}else{if("setting"==g_module){if("settings"==g_setting_type){return}var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;if("conversation_messages"==g_setting_type){var d="/ajax/"+g_setting_type+"/"+g_conversation_id+"/"+a+"/"+g+"/"+b+"/"}else{var d="/ajax/"+g_setting_type+"/"+a+"/"+g+"/"+b+"/"}var f=""}else{if("home"==g_module){if("answers"==g_command){var d="/ajax/er/"+g_er_id+"/answers/";var f={start:g_last_getmoredata_index,end:g_last_getmoredata_index+STEP}}else{if("asks"==g_command){var d="/ajax/er/"+g_er_id+"/asks/";var f={start:g_last_getmoredata_index,end:g_last_getmoredata_index+STEP}}else{if("businesses"==g_command){var d="/ajax/er/"+g_er_id+"/businesses/";var f={start:g_last_getmoredata_index,end:g_last_getmoredata_index+STEP}}else{if("articles"==g_command){var d="/ajax/er/"+g_er_id+"/articles/";var f={start:g_last_getmoredata_index,end:g_last_getmoredata_index+STEP}}else{if("following"==g_command){var d="/ajax/er/"+g_er_id+"/following/"+g_subcmd+"/";var f={start:g_last_getmoredata_index,end:g_last_getmoredata_index+STEP}}}}}}}else{if("answer_page"==g_module){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;var d="/ajax/answer_page/"+g_type+"/"+a+"/"+g+"/"+b+"/";var f=""}else{if("businesses"==g_module){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;var d="/ajax/businesses/"+g_business_type+"/"+a+"/"+g+"/"+b+"/";var f={addr:addr,addr_value:addr_value,keyword:business_keyword}}else{return}}}}}}}}}}if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post(d,f,function(h){if("fail"!=h){if("index"==g_module){appendAnswerElementCard(h,"has_topic_question_title",diretion="append")}else{if("question"==g_module){if("all"==g_list_type){appendAnswerElementList(h,"all","append")}}else{if("topic"==g_module){if("unanswered"==g_type){appendQuestionElement(h)}else{appendAnswerElementList(h,"topic","append")}}else{if("mytopic"==g_module){appendAnswerElementList(h,"topic","append")}else{if("alltopics"==g_module){appendTopicElement(h)}else{if("search"==g_module){appendSearchPageElement(h)}else{if("setting"==g_module){appendSettingPageElement(h)}else{if("home"==g_module){if("answers"==g_command){appendAnswerElementList(h,"homepage","append")}else{if("asks"==g_command){appendQuestionElement(h)}else{if("businesses"==g_command){appendHomeBusinessElement(h)}else{if("articles"==g_command){appendArticleElement(h)}else{if("following"==g_command){appendFollowOrMoreElement(h)}}}}}}else{if("answer_page"==g_module){if("invited"==g_type){appendInvitedQuestionElement(h)}else{appendQuestionElement(h)}}else{if("businesses"==g_module){appendBusinessesElement(h)}}}}}}}}}}checkSets();g_last_getmoredata_index+=STEP}else{console.log("no more data");$("#appendArea").append('<div class="List-item NoMoreData"><div class="ContentItem" ><div class="ContentItem-status"  style="text-align:center">没有更多内容</div></div></div>')}g_lock_ajax="false"})}function action(){if("false"==g_init_element_done){return}if(("sign"!=g_module)&&("misc"!=g_module)&&("nofeature"!=g_module)){getMoreData();checkSets()}g_init_done="true";console.log("init done")}function initElement(){if("false"==g_init_data_done){return}appendLetterModal();if("true"==g_logged){$("#MenuPopover").attr("data-er-id",g_user_id).attr("data-er-avatar",g_user_avatar).find("img").attr("src",g_user_avatar).removeClass("is-hide");if(gNotificationsNums>0){$("#NotificationPopover .PushNotifications-count").removeClass("is-hide").text(gNotificationsNums)}if(gConversationsNums>0){$("#MessagePopover .Messages-count").removeClass("is-hide").text(gConversationsNums)}}$("head title").text(SITE+" - "+SITE_SLOGAN);if("question"==g_module){$("head title").text(g_question_title+" - "+SITE);if($.inArray(""+g_question_id,g_user_follow_questions_list)>=0){$(".QuestionButtonGroup .FollowButton").removeClass("Button--green").addClass("Button--grey").attr("data-question-id",g_question_id).attr("data-followed","true").text("已关注")}else{$(".QuestionButtonGroup .FollowButton").removeClass("Button--grey").addClass("Button--green").attr("data-question-id",g_question_id).attr("data-followed","false").text("关注问题")}$(".RichText img").addClass("origin_image");var b=$(".Card.AnswerAuthor .FollowButton");var m=b.attr("data-author-id");var x=b.attr("data-author-name");var E=b.attr("data-author-sexual");console.log(m);console.log(E);if("f"==E){var B="she";var k="她"}else{var B="he";var k="他"}if($.inArray(""+m,g_user_follow_peoples_list)>=0){b.removeClass("Button--green").addClass("Button--grey").attr("data-followed","true").attr("data-who",B).text("已关注")}else{b.removeClass("Button--grey").addClass("Button--green").attr("data-followed","false").attr("data-who",B).text("关注"+k)}$(".ContentItem-time span").each(function(){$(this).text(getDateDiff($(this).text()))});setLetterReceiver(m,x);checkQuestionDetailExpand();checkQuestionDetailCollapse()}else{if("topic"==g_module){$("head title").text(g_topic_name+" - "+SITE);var c="";var y="";if("hot"==g_type){c="is-active"}else{if("unanswered"==g_type){y="is-active"}else{g_type="hot";c="is-active"}}$(".Tabs.Topic-tabs").append('<li role="tab" class="Tabs-item Tabs-item--noMeta" aria-controls="Topic-hot"><a class="Tabs-link '+c+'" href="/topic/'+g_topic_id+'/hot">讨论</a></li><li role="tab" class="Tabs-item Tabs-item--noMeta" aria-controls="Topic-wait"><a class="Tabs-link '+y+'" href="/topic/'+g_topic_id+'/unanswered">等待回答</a></li>');$(".TopicCard-titleText").text(g_topic_name);console.log(g_topic_detail);$(".TopicCard-description>.RichText").html(g_topic_detail);$(".NumberBoard-value").empty().append(g_topic_follower_nums);if($.inArray(""+g_topic_id,g_user_follow_topics_list)>=0){$(".FollowButton.TopicActions-followButton").removeClass("Button--green").addClass("Button--grey").attr("data-topic-id",g_topic_id).attr("data-followed","true").text("已关注")}else{$(".FollowButton.TopicCard-followButton").removeClass("Button--grey").addClass("Button--green").attr("data-topic-id",g_topic_id).attr("data-followed","false").text("关注栏目")}checkAvatar()}else{if("mytopic"==g_module){$("head title").text("我关注的栏目 - "+SITE);window.onhashchange=hashChange;var g=null;if((location.hash!="")&&(location.hash!=undefined)){g_topic_id=location.hash.replace("#","");$(".FollowedTopic").each(function(){if(g_topic_id==$(this).attr("data-topic-id")){$(this).addClass("current");g=$(this)}else{$(this).removeClass("current")}})}else{g=$(".FollowedTopic:first")}g_topic_id=g.addClass("current").attr("data-topic-id");g_topic_name=g.attr("data-topic-name");g_topic_avatar=g.attr("data-topic-avatar");g_topic_detail=g.attr("data-topic-detail");$(".Card-section.Topic--current .TopicLink-link").attr("href","/topic/"+g_topic_id+"/");$(".Card-section.Topic--current img").attr("src",g_topic_avatar).attr("alt",g_topic_name);$(".Card-section.Topic--current .RichText").empty().text(g_topic_name);$(".Card-section.Topic--current .ContentItem-statusItem").html(g_topic_detail);$("#appendArea").empty()}else{if("alltopics"==g_module){$("head title").text("全部栏目 - "+SITE)}else{if("search"==g_module){$("head title").text("搜索 - "+SITE);if(""==g_search_type){g_search_type="content"}$(".Tabs-link").removeClass("is-active");$(".Tabs-link").each(function(){if($(this).attr("data-search-type")==g_search_type){$(this).addClass("is-active")}});$("#search_button").removeClass("is-hide");$("#searchInput").focus();checkSearchHot();checkSearch()}else{if("setting"==g_module){$("head title").text("设置 - "+SITE);$(".Tabs-link").removeClass("is-active");$(".Tabs-link").each(function(){if($(this).attr("href")){if($(this).attr("href").indexOf(g_setting_type)>-1){$(this).addClass("is-active")}}});if("conversation_messages"==g_setting_type){var G='<div class="List-item Conversation-messages-head"><div class="zg-section"><a href="/conversations">« 返回</a></div><div class="zg-section zg-14px"><span class="zg-gray-normal">发私信给 </span><span class="zg-gray-darker"></span>：</div><div class="zg-section LetterSend" id="zh-pm-editor-form"><div class="zg-editor-simple-wrap zg-form-text-input"><div class="zg-user-name" style="display:none"></div><textarea id="letterText" class="zg-editor-input zu-seamless-input-origin-element" style="font-weight: normal; height: 22px;" data-receiver-id="4"></textarea></div><div class="zh-pm-warnmsg" style="display:none;text-align:right;color:#C3412F;"></div><div class="zm-command"><button class="Button Messages-sendButton Button--primary Button--green" type="button" onclick="sendLetter()">发送</button></div></div></div>';$("#appendArea").prepend(G)}else{if("settings"==g_setting_type){var G='<div class="List-item"><div><label><input type="radio" name="notification-receive" value="all" checked="">允许接收通知</label>&nbsp;<label><input type="radio" name="notification-receive" value="all" checked="">禁止接收通知</label></div><button type="submit" class="Button Button--primary Button--green">保存</button></div><div class="List-item"><div><label><input type="radio" name="inboxmsg-receive" value="all" checked="">允许接收私信</label>&nbsp;<label><input type="radio" name="inboxmsg-receive" value="all" checked="">禁止接收私信</label></div><button type="submit" class="Button Button--primary Button--green">保存</button></div>';$("#appendArea").prepend(G)}else{if("notifications"==g_setting_type){saveUserDataToCookie("lnt",getTimeNow());saveUserDataToCookie("gnn",0);$("#NotificationPopover .PushNotifications-count").addClass("is-hide")}else{if("conversations"==g_setting_type){saveUserDataToCookie("lct",getTimeNow());saveUserDataToCookie("gcn",0);$("#MessagePopover .Messages-count").addClass("is-hide")}}}}checkSettingPage()}else{if("sign"==g_module){$("head title").text(SITE+" - "+SITE_SLOGAN);$(".SignFlowHeader-slogen").text(SITE_SLOGAN);checkSmsSend();checkSignAndMiscPage();var d=getCookie("countdown");if(null!=d){g_countdown_secs=d;$(".SignFlow-smsInputButton").addClass("is-counting").empty().append('<span id="counting-num">59</span>秒后可重发');setTimeout("countDown()",1000)}}else{if("misc"==g_module){if("password_reset"!=g_arg){var G='<div class="" style="position:relative;padding:0 16px;margin:100px auto;"><div class="" style="font-size:20px;font-weight:600;font-synthesis:style;color:#1a1a1a;text-align:center;padding:10px auto;"><h1 id="errorText" style="margin:20px auto;color:red;"></h1><a id="returnLink" style="color:blue;" href="/signinup/?next=/"></a></div></div>';$("main").empty().append(G);if("e_veri_code"==g_arg){$("#errorText").text("验证码错误，注册失败，请尝试返回注册页面重新注册");$("#returnLink").text("返回重新注册");setTimeout(function(){window.location.href="/signinup/?next=/"},10*1000)}else{if("e_u_p"==g_arg){$("#errorText").text("用户名密码错误，登录失败，请尝试返回登录页面重新登录");$("#returnLink").text("返回重新登录");setTimeout(function(){window.location.href="/signinup/?next=/"},10*1000)}else{if("e_registered"==g_arg){$("#errorText").text("该手机号已被注册，请尝试找回密码或更换手机号重新注册");$("#returnLink").text("返回重新注册");setTimeout(function(){window.location.href="/signinup/?next=/"},10*1000)}else{if("reset_pwd_success"==g_arg){$("#errorText").text("重置密码成功");$("#returnLink").text("返回重新登录");setTimeout(function(){window.location.href="/signinup/?next=/"},10*1000)}}}}}else{checkSmsSend();checkSignAndMiscPage();var d=getCookie("countdown");if(null!=d){g_countdown_secs=d;$(".SignFlow-smsInputButton").addClass("is-counting").empty().append('<span id="counting-num">59</span>秒后可重发');setTimeout("countDown()",1000)}}}else{if("home"==g_module){$("head title").text(g_er_name+"的主页 - "+SITE);$(".ProfileHeader-name").text(g_er_name);$("#id_avatar").attr({src:g_er_avatar});$(".ProfileHeader-headline").html(g_er_mood);var D="贡献值: "+g_er_contribution+"  |  股份: "+g_er_stock+"%";var p='<div class="ProfileHeader-infoItem" style="color:#daa520"><div class="ProfileHeader-iconWrapper"><svg viewBox="0 0 32 32" class="Icon Icon--contribution" aria-hidden="true" style="height: 16px; width: 16px;"><title></title><g><path d="M30.5 0h-12c-0.825 0-1.977 0.477-2.561 1.061l-14.879 14.879c-0.583 0.583-0.583 1.538 0 2.121l12.879 12.879c0.583 0.583 1.538 0.583 2.121 0l14.879-14.879c0.583-0.583 1.061-1.736 1.061-2.561v-12c0-0.825-0.675-1.5-1.5-1.5zM23 12c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"></path></g></svg></div>'+D+"</div>";if("f"==g_er_sexual){g_er_sexual_han="女";g_who="she";g_who_han="她";var v="关注她";var j='<div class="ProfileHeader-infoItem"><div class="ProfileHeader-iconWrapper"><svg width="14" height="16" viewBox="0 0 12 16" class="Icon Icon--female" aria-hidden="true" style="height: 16px; width: 14px;"><title></title><g><path d="M6 0C2.962 0 .5 2.462.5 5.5c0 2.69 1.932 4.93 4.485 5.407-.003.702.01 1.087.01 1.087H3C1.667 12 1.667 14 3 14s1.996-.006 1.996-.006v1c0 1.346 2.004 1.346 1.998 0-.006-1.346 0-1 0-1S7.658 14 8.997 14c1.34 0 1.34-2-.006-2.006H6.996s-.003-.548-.003-1.083C9.555 10.446 11.5 8.2 11.5 5.5 11.5 2.462 9.038 0 6 0zM2.25 5.55C2.25 3.48 3.93 1.8 6 1.8c2.07 0 3.75 1.68 3.75 3.75C9.75 7.62 8.07 9.3 6 9.3c-2.07 0-3.75-1.68-3.75-3.75z" fill-rule="evenodd"></path></g></svg></div></div>'}else{g_er_sexual_han="男";g_who="he";g_who_han="他";var v="关注他";var j='<div class="ProfileHeader-infoItem"><div class="ProfileHeader-iconWrapper"><svg width="14" height="16" viewBox="0 0 14 14" class="Icon Icon--male" aria-hidden="true" style="height: 16px; width: 14px;"><title></title><g><path d="M3.025 10.64c-1.367-1.366-1.367-3.582 0-4.95 1.367-1.366 3.583-1.366 4.95 0 1.367 1.368 1.367 3.584 0 4.95-1.367 1.368-3.583 1.368-4.95 0zm10.122-9.368c-.002-.414-.34-.75-.753-.753L8.322 0c-.413-.002-.746.33-.744.744.002.413.338.75.75.752l2.128.313c-.95.953-1.832 1.828-1.832 1.828-2.14-1.482-5.104-1.27-7.013.64-2.147 2.147-2.147 5.63 0 7.777 2.15 2.148 5.63 2.148 7.78 0 1.908-1.91 2.12-4.873.636-7.016l1.842-1.82.303 2.116c.003.414.34.75.753.753.413.002.746-.332.744-.745l-.52-4.073z" fill-rule="evenodd"></path></g></svg></div></div>'}g_contentbody_data='<div class="ProfileHeader-info">'+p+j+"</div>";$(".ProfileHeader-contentBody").empty().append(g_contentbody_data);var r='<svg viewBox="0 0 10 6" class="Icon ProfileHeader-arrowIcon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg>';if(("true"==g_logged)&&(g_er_id==g_user_id)){g_who="me";g_who_han="我";var G='<button class="Button ProfileHeader-expandButton Button--plain" type="button">'+r+'查看详细资料</button><div class="ProfileButtonGroup ProfileHeader-buttons"><button class="ProfileEditButton Button Button--green" type="button">编辑个人资料</button></div>'}else{if($.inArray(""+g_er_id,g_user_follow_peoples_list)>=0){var v="已关注";var l="true";var C="Button--grey"}else{var l="false";var C="Button--green"}var G='<button class="Button ProfileHeader-expandButton Button--plain" type="button">'+r+'查看详细资料</button><div class="MemberButtonGroup ProfileButtonGroup ProfileHeader-buttons"><button class="Button FollowButton Button--primary '+C+'" type="button" data-er-id="'+g_er_id+'" data-who="'+g_who+'" data-follow-type="people" data-followed='+l+">"+v+'</button><button class="Button Button--grey Button--withIcon Button--withLabel" type="button" data-toggle="modal" data-target="#letterModal"><span style="display: inline-flex; align-items: center;">&#8203;'+letter_icon_svg+"</span>发私信</button></div>"}$(".ProfileHeader-contentFooter").append(G);var h="";var z="";var s="";var n="";var e="";if("answers"==g_command){h="is-active";var G='<div class="List Profile-answers"><div class="List-header"><h4 class="List-headerText"><span>'+g_who_han+'的回答</span></h4></div><div id="appendArea"></div></div>';$("#profileMainContent").append(G)}else{if("asks"==g_command){z="is-active";var G='<div class="List Profile-answers"><div class="List-header"><h4 class="List-headerText"><span>'+g_who_han+'的问题</span></h4></div><div id="appendArea"></div></div>';$("#profileMainContent").append(G)}else{if("businesses"==g_command){s="is-active";var G='<div class="List Profile-answers"><div class="List-header"><h4 class="List-headerText"><span>'+g_who_han+'的买卖</span></h4></div><div id="appendArea"></div></div>';$("#profileMainContent").append(G)}else{if("articles"==g_command){n="is-active";var G='<div class="List Profile-answers"><div class="List-header"><h4 class="List-headerText"><span>'+g_who_han+'的文章</span></h4></div><div id="appendArea"></div></div>';$("#profileMainContent").append(G)}else{if("following"==g_command){e="is-active";appendFollowOrMoreHead()}else{console.log("false")}}}}}var A='<li role="tab" class="Tabs-item" aria-controls="Profile-answers"><a class="Tabs-link '+h+'" href="/er/'+g_er_id+'/answers/">回答<span class="Tabs-meta">'+g_answer_nums+'</span></a></li><li role="tab" class="Tabs-item" aria-controls="Profile-asks"><a class="Tabs-link '+z+'" href="/er/'+g_er_id+'/asks/">提问<span class="Tabs-meta">'+g_question_nums+'</span></a></li><li role="tab" class="Tabs-item" aria-controls="Profile-articles"><a class="Tabs-link '+s+'" href="/er/'+g_er_id+'/businesses/">买卖<span class="Tabs-meta">'+g_business_nums+'</span></a></li><li role="tab" class="Tabs-item" aria-controls="Profile-articles"><a class="Tabs-link '+n+'" href="/er/'+g_er_id+'/articles/">文章<span class="Tabs-meta">'+g_article_nums+'</span></a></li><li role="tab" class="Tabs-item" aria-controls="Profile-following"><a class="Tabs-link '+e+'" href="/er/'+g_er_id+'/following/">关注<span class="Tabs-meta"><svg viewBox="0 0 10 6" class="Icon ProfileMain-tabIcon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg></span></a></li>';$(".Tabs.ProfileMain-tabs").append(A);var G='<div class="NumberBoard FollowshipCard-counts NumberBoard--divider"><a class="Button NumberBoard-item Button--plain" type="button" href="/er/'+g_er_id+'/following/followtos"><div class="NumberBoard-itemInner"><div class="NumberBoard-itemName">关注了</div><strong class="NumberBoard-itemValue">'+g_followto_nums+'</strong></div></a><a class="Button NumberBoard-item Button--plain" type="button" href="/er/'+g_er_id+'/following/followers"><div class="NumberBoard-itemInner"><div class="NumberBoard-itemName">关注者</div><strong class="NumberBoard-itemValue NumberBoard-value" data-update-value-type="people-followed">'+g_follower_nums+"</strong></div></a></div>";$(".Card.FollowshipCard").append(G);var G='<a class="Profile-lightItem" href="/er/'+g_er_id+'/following/topics"><span class="Profile-lightItemName">关注的栏目</span><span class="Profile-lightItemValue">'+g_followtopic_nums+'</span></a><a class="Profile-lightItem" href="/er/'+g_er_id+'/following/questions"><span class="Profile-lightItemName">关注的问题</span><span class="Profile-lightItemValue">'+g_followquestion_nums+"</span></a>";$(".Profile-lightList").append(G);setLetterReceiver(g_er_id,g_er_name);checkAvatar();checkHomePage()}else{if("answer_page"==g_module){$("head title").text("回答 - "+SITE);$(".ContentLayout-mainColumn .Tabs-item").each(function(){if(g_type==$(this).attr("data-type")){$(this).children(".Tabs-link").addClass("is-active")}});if("all"==g_type){var F="全站的问题"}else{if("invited"==g_type){var F="邀请我回答的问题"}else{var F="为你推荐的问题"}}$(".ContentLayout-mainColumn .Card .List .List-headerText").empty().append(F)}else{if("article"==g_module){$("head title").text(g_article_title+" - "+SITE);var o=$("main").attr("data-article-content");$(".Post-RichText").empty().append(addClassImg(o,'class="origin_image zh-lightbox-thumb lazy"'));if(("true"==g_logged)&&(g_user_id==g_article_author_id)){$(".FollowButton").remove();var q='<button type="button" class="Button ReviseButton Button--green"><a href="/revise/?a='+g_article_id+'"><span>修改文章</span></a></button>';$(".Post-Author").append(q)}else{var a="关注她";var u="Button--green";var f="she";if("f"!=g_article_author_sexual){a="关注他";f="he"}var t="false";if($.inArray(""+g_article_author_id,g_user_follow_peoples_list)>=0){u="Button--grey";a="已关注";t="true"}$(".FollowButton").addClass(u).removeClass("is-hide").attr("data-er-id",g_article_author_id).attr("data-followed",t).attr("data-who",f).children("span").text(a)}var w="发布于 "+getDateDiff(g_article_pub_date);$(".ContentItem-time>a").attr("href","/article/"+g_article_id+"/").children("span").attr("data-tooltip",w).text(w);checkInteractionButton();getComments("article",g_article_id)}else{if("ask"==g_module){$("head title").text("提问题 - "+SITE)}else{if(("write"==g_module)||("revise"==g_module)){$("head title").text("写文章 - "+SITE);$("#summernote_write").summernote({toolbar:[["style",["bold","italic","underline"]],["font",["strikethrough","superscript","subscript"]],["para",["paragraph"]],["table",["table"]],["link",["link"]],["picture",["picture"]],["video",["video"]]],height:null,minHeight:500,lang:"zh-CN",placeholder:"请输入文章内容(不少于"+TEXT_MIN_LENGTH_HIGH+"个字)",disableDragAndDrop:true,callbacks:{onImageUpload:function(H){scaleAndUploadImage("forWrite",H[0],720)}}});$(".note-statusbar").addClass("is-hide");if("revise"==g_module){$("head title").text("修改文章 - "+SITE);$("input[name='writeTitle']").val(g_article_title);$("#summernote_write").summernote("code",g_article_content)}checkWrite()}else{if("businesses"==g_module){$("head title").text("买卖信息 - "+SITE);initBusinessesElement()}else{if("business"==g_module){$("head title").text("买卖信息 - "+SITE);initBusinessElement()}else{if("business-post"==g_module){$("head title").text("买卖信息发布 - "+SITE);initBusinessPostElement()}}}}}}}}}}}}}}}}g_init_element_done="true"}function initData(){var d=$("main").attr("data-dfs-main");var e=JSON.parse(d);g_logged=e.logged;if("question"==g_module){g_question_detail=$("main").attr("data-question-detail");g_question_id=e.question_id;g_question_title=e.question_title;g_question_follower_nums=e.question_follower_nums;g_question_answer_nums=e.question_answer_nums;g_question_click_nums=e.question_click_nums;if($(".Question-main .Card.AnswerCard").length>0){g_list_type="more"}else{g_list_type="all"}g_last_getmoredata_index+=10}else{if("topic"==g_module){g_topic_id=e.topic_id;g_topic_name=e.topic_name;g_topic_avatar=e.topic_avatar;g_topic_detail=e.topic_detail;g_topic_follower_nums=e.topic_follower_nums;g_type=e.type}else{if("mytopic"==g_module){}else{if("alltopics"==g_module){g_topiclist_item_index=1}else{if("search"==g_module){g_search_keyword=e.search_keyword;g_search_type=e.search_type}else{if("setting"==g_module){g_setting_type=e.type;g_conversation_id=e.conversation_id}else{if("misc"==g_module){g_arg=e.arg}else{if("home"==g_module){var b=$("main").attr("data-dfs-ext");var h=JSON.parse(b);g_er_id=e.er_id;g_er_name=e.er_name;g_er_avatar=e.er_avatar;g_er_mood=e.er_mood;g_er_sexual=e.er_sexual;g_er_residence=e.er_residence;g_er_job=e.er_job;g_er_intro=e.er_intro;g_followed=e.followed;g_command=e.command;g_subcmd=e.subcmd;g_question_nums=h.question_nums;g_article_nums=h.article_nums;g_answer_nums=h.answer_nums;g_business_nums=h.business_nums;g_followto_nums=h.followto_nums;g_follower_nums=h.follower_nums;g_followtopic_nums=h.followtopic_nums;g_followquestion_nums=h.followquestion_nums;g_er_contribution=h.contribution;g_er_stock=(g_er_contribution*100/tcs).toFixed(8);g_show_detailed="false"}else{if("article"==g_module){g_article_id=e.article_id;g_article_title=e.article_title;g_article_click_nums=e.article_click_nums;g_article_like_nums=e.article_like_nums;g_article_comment_nums=e.article_comment_nums;g_article_pub_date=e.article_pub_date;g_article_author_id=e.author_id;g_article_author_name=e.author_name;g_article_author_avatar=e.author_avatar;g_article_author_mood=e.author_mood;g_article_author_sexual=e.author_sexual}else{if("revise"==g_module){g_article_id=e.article_id;g_article_title=e.article_title;g_article_content=$("main").attr("data-article-content");g_article_author_id=e.author_id}else{if("answer_page"==g_module){g_type=e.type}else{if("businesses"==g_module){g_business_type=$(".Businesses-tabs .Tabs-link.is-active").attr("data-business-type")}}}}}}}}}}}}if("true"==g_logged){g_user_id=e.user_id;g_user_name=e.user_name;g_user_avatar="";g_user_token=g_user_id.substr(g_user_id.length-5,g_user_id.length);g_cookie_expire=1*24*60*60;gNotificationsNums=getCookie("gnn"+g_user_token);gConversationsNums=getCookie("gcn"+g_user_token);var l=getCookie("ufp"+g_user_token);var c=getCookie("uft"+g_user_token);var j=getCookie("ufq"+g_user_token);var g=getCookie("up"+g_user_token);if((null==l)||(null==j)||(null==c)|(null==g)){var a="/ajax/user_data/"+g_user_id+"/";var m=getCookie("lnt"+g_user_token);var k=getCookie("lct"+g_user_token);var f={type:"all",lastNotificationTime:m,lastConversationTime:k};$.post(a,f,function(n){if("fail"!=n){g_user_follow_peoples_list=String(n[0]).split(",");g_user_follow_topics_list=String(n[1]).split(",");g_user_follow_questions_list=String(n[2]).split(",");g_user_profile_list=n[3];g_user_avatar=g_user_profile_list[2];saveUserDataToCookie("ufp",n[0]);saveUserDataToCookie("uft",n[1]);saveUserDataToCookie("ufq",n[2]);saveUserDataToCookie("up",n[3]);gNotificationsNums=n[4].length;gConversationsNums=n[5].length;saveUserDataToCookie("gnn",gNotificationsNums);saveUserDataToCookie("gcn",gConversationsNums)}g_init_data_done="true";initElement();action()})}else{g_user_follow_peoples_list=b64_to_utf8(l).split(",");g_user_follow_topics_list=b64_to_utf8(c).split(",");g_user_follow_questions_list=b64_to_utf8(j).split(",");g_user_profile_list=b64_to_utf8(g).split(",");g_user_avatar=g_user_profile_list[2];g_init_data_done="true"}}else{g_init_data_done="true"}}function init(){g_module=$("main").attr("data-module");initData();initElement();action()}function initCommon(){LARGE_TEXT_MAX_LENGTH=16000;MIDDLE_TEXT_MAX_LENGTH=1000;LITTLE_TEXT_MAX_LENGTH=100;TEXT_MIN_LENGTH_HIGH=100;TEXT_MIN_LENGTH_MID=50;TEXT_MIN_LENGTH_LOW=10;notifications="null";messages="null";g_last_getmoredata_index=0;g_sticky_show="false";cache_topics="";g_selectpicker_init="false";g_init_data_done="false";g_init_element_done="false";g_user_follow_peoples_list=[];g_user_follow_topics_list=[];g_user_follow_questions_list=[];g_cache_question_id_list=[];g_cache_article_id_list=[];modify_icon_svg='<svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>';like_icon_svg='<svg viewBox="0 0 20 18" xmlns="http://www.w3.org/2000/svg" class="Icon Icon--like Icon--left" width="13" height="16" aria-hidden="true" style="height: 16px; width: 13px;"><title></title><g><path d="M.718 7.024c-.718 0-.718.63-.718.63l.996 9.693c0 .703.718.65.718.65h1.45c.916 0 .847-.65.847-.65V7.793c-.09-.88-.853-.79-.846-.79l-2.446.02zm11.727-.05S13.2 5.396 13.6 2.89C13.765.03 11.55-.6 10.565.53c-1.014 1.232 0 2.056-4.45 5.83C5.336 6.965 5 8.01 5 8.997v6.998c-.016 1.104.49 2 1.99 2h7.586c2.097 0 2.86-1.416 2.86-1.416s2.178-5.402 2.346-5.91c1.047-3.516-1.95-3.704-1.95-3.704l-5.387.007z"></path></g></svg>';comment_icon_svg='<svg class="Zi Zi--Comment Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M10.241 19.313a.97.97 0 0 0-.77.2 7.908 7.908 0 0 1-3.772 1.482.409.409 0 0 1-.38-.637 5.825 5.825 0 0 0 1.11-2.237.605.605 0 0 0-.227-.59A7.935 7.935 0 0 1 3 11.25C3 6.7 7.03 3 12 3s9 3.7 9 8.25-4.373 9.108-10.759 8.063z" fill-rule="evenodd"></path></svg>';share_button='<div class="Popover ShareMenu ContentItem-action"><div class="" aria-haspopup="true" aria-expanded="false"><img class="ShareMenu-fakeQRCode" src="" alt="微信二维码"><button class="Button Button--plain Button--withIcon Button--withLabel" type="button"><span style="display: inline-flex; align-items: center;">&#8203;<svg class="Zi Zi--Share Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M2.931 7.89c-1.067.24-1.275 1.669-.318 2.207l5.277 2.908 8.168-4.776c.25-.127.477.198.273.39L9.05 14.66l.927 5.953c.18 1.084 1.593 1.376 2.182.456l9.644-15.242c.584-.892-.212-2.029-1.234-1.796L2.93 7.89z" fill-rule="evenodd"></path></svg></span>分享</button></div></div>';letter_icon_svg='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" class="Icon Button-icon Icon--comments" width="15" height="16" aria-hidden="true" style="height: 16px; width: 15px;"><title></title><g><g>     <path d="M9 0C3.394 0 0 4.13 0 8c0 1.654.522 3.763 2.014 5.566.314.292.518.82.454 1.17-.165 1.488-.842 1.905-.842 1.905-.328.332.105.67.588.582 1.112-.2 2.07-.58 3.526-1.122.4-.202.464-.147.78-.078C11.524 17.764 18 14 18 8c0-3.665-3.43-8-9-8z"></path>     <path d="M19.14 9.628c.758.988.86 2.01.86 3.15 0 1.195-.62 3.11-1.368 3.938-.21.23-.354.467-.308.722.12 1.073.614 1.5.614 1.5.237.24-.188.563-.537.5-.802-.145-1.494-.42-2.545-.81-.29-.146-.336-.106-.563-.057-2.043.712-4.398.476-6.083-.926 5.964-.524 8.726-3.03 9.93-8.016z"></path>   </g></g></svg>';$("#summernote_question").summernote({toolbar:[["style",["italic"]],["font",["superscript","subscript"]],["table",["table"]],["link",["link"]],["picture",["picture"]]],minHeight:150,lang:"zh-CN",placeholder:"问题背景、条件等详细信息",callbacks:{onImageUpload:function(a){scaleAndUploadImage("forQuestion",a[0],720)},onInit:function(){$(".note-statusbar").addClass("is-hide");$(".note-editor").append('<div id="uploadingImage" class="spinner is-hide"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>')}}});$("#summernote_answer").summernote({toolbar:[["style",["bold","italic","underline"]],["font",["strikethrough","superscript","subscript"]],["para",["paragraph"]],["table",["table"]],["link",["link"]],["picture",["picture"]]],minHeight:150,lang:"zh-CN",placeholder:"写回答(不少于"+TEXT_MIN_LENGTH_LOW+"个字)",callbacks:{onImageUpload:function(a){scaleAndUploadImage("forAnswer",a[0],720)},onInit:function(){$(".note-statusbar").addClass("is-hide")}}});checkSelectOption()}$(document).ready(function(){console.log("init");initCommon();init()});SITE="大农令";SITE_URL="http://www.danongling.com";SITE_SLOGAN="关注新农业,新农村,新农民";STEP=10;g_lock_ajax="false";g_init_done="false";ENABLE_SCREEN_LOG="true";tcs=10000000000;$(document).click(function(a){$("#NotificationPopover").popover("hide");$("#MessagePopover").popover("hide");$("#MenuPopover").popover("hide")});window.onscroll=function(){if("false"==g_init_done){return}if("article"==g_module){if($(window).scrollTop()+$(window).height()>$(".RichContent-actions-anchor").offset().top){if("true"==g_sticky_show){$(".Sticky.RichContent-actions").removeClass("is-fixed").attr("style","");g_sticky_show="false"}}else{if("false"==g_sticky_show){$(".Sticky.RichContent-actions").addClass("is-fixed").attr("style","width: 690px; bottom: 0px; left: auto;");g_sticky_show="true"}}}if(getScrollTop()+getClientHeight()+10>=getScrollHeight()){getMoreData()}};function slog(a){if("true"==ENABLE_SCREEN_LOG){var b="<div>"+a+"</div>";$("#debug").append(b)}}function saveUserDataToCookie(a,b){if(("lnt"==a)||("lct"==a)){delCookie(a+g_user_token);setCookie(a+g_user_token,b,30*24*60*60)}else{if(("gnn"==a)||("gcn"==a)){delCookie(a+g_user_token);setCookie(a+g_user_token,b,30*24*60*60)}else{delCookie(a+g_user_token);setCookie(a+g_user_token,utf8_to_b64(b),g_cookie_expire)}}}function veriLogin(){if("true"!=g_logged){var a=location.href;location.href="/signinup/?next="+a;return false}return true}function hashChange(){g_last_getmoredata_index=0;g_topic_id=location.hash.replace("#","");$(".FollowedTopic").each(function(){if(g_topic_id==$(this).attr("data-topic-id")){$(this).addClass("current");g_topic_name=$(this).attr("data-topic-name");g_topic_avatar=$(this).attr("data-topic-avatar");g_topic_detail=$(this).attr("data-topic-detail")}else{$(this).removeClass("current")}});$(".Card-section.Topic--current .TopicLink-link").attr("href","/topic/"+g_topic_id+"/");$(".Card-section.Topic--current img").attr("src",g_topic_avatar).attr("alt",g_topic_name);$(".Card-section.Topic--current .RichText").empty().text(g_topic_name);$(".Card-section.Topic--current .ContentItem-statusItem").html(g_topic_detail);$("#appendArea").empty();getMoreData()};