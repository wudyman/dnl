if(!HTMLCanvasElement.prototype.toBlob){Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(d,b,c){var a=this;setTimeout(function(){var g=atob(a.toDataURL(b,c).split(",")[1]);var f=g.length,e=new Uint8Array(f);for(var h=0;h<f;h++){e[h]=g.charCodeAt(h)}d(new Blob([e],{type:b||"image/png"}))})}})}function utf8_to_b64(a){return window.btoa(unescape(encodeURIComponent(a)))}function b64_to_utf8(a){return decodeURIComponent(escape(window.atob(a)))}function setCookie(a,c,b){var d=new Date();d.setTime(d.getTime()+b*1000);document.cookie=a+"="+c+";expires="+d.toGMTString()+";path=/"}function getCookie(b){var a,c=new RegExp("(^| )"+b+"=([^;]*)(;|$)");if(a=document.cookie.match(c)){return(a[2])}else{return null}}function delCookie(a){var c=new Date();c.setTime(c.getTime()-1);var b=getCookie(a);if(b!=null){document.cookie=a+"="+b+";expires="+c.toGMTString()+";path=/"}}function getDateDiff(h){var o=Date.parse(new Date(h.replace(/-/g,"/")));var k=o/1000,b,n,e,j,l=parseInt(new Date().getTime()/1000),q,g=new Date(k*1000),c=g.getFullYear(),p=g.getMonth()+1,a=g.getDate(),r=g.getHours(),f=g.getMinutes(),t=g.getSeconds();if(p<10){p="0"+p}if(a<10){a="0"+a}if(r<10){r="0"+r}if(f<10){f="0"+f}if(t<10){t="0"+t}q=l-k;j=parseInt(q/86400);e=parseInt(q/3600);n=parseInt(q/60);b=parseInt(q);if(j>0&&j<3){return j+"天前"}else{if(j<=0&&e>0){return e+"小时前"}else{if(e<=0&&n>0){return n+"分钟前"}else{if(b<60){if(b<=0){return"刚刚"}else{return b+"秒前"}}else{if(j>=3&&j<30){return p+"-"+a}else{if(j>=30){return c+"-"+p+"-"+a}}}}}}}function countDown(){if(0==g_countdown_secs){$(".SignFlow-smsInputButton").removeClass("is-counting").text("获取短信验证码");delCookie("countdown")}else{g_countdown_secs-=1;$("#counting-num").text(g_countdown_secs);setCookie("countdown",g_countdown_secs,g_countdown_secs);setTimeout("countDown()",1000)}}function getScrollTop(){var a=0;if(document.documentElement&&document.documentElement.scrollTop){a=document.documentElement.scrollTop}else{if(document.body){a=document.body.scrollTop}}return a}function getClientHeight(){var a=0;if(document.body.clientHeight&&document.documentElement.clientHeight){a=Math.min(document.body.clientHeight,document.documentElement.clientHeight)}else{a=Math.max(document.body.clientHeight,document.documentElement.clientHeight)}return a}function getScrollHeight(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}function uploadImage(c,b){if("forAvatar"==c){var a="/ajax/upload/avatar/"}else{if("forTopicAvatar"==c){var a="/ajax/upload/topic_avatar/"+g_topic_id+"/"}else{var a="/ajax/upload/img/"}}var d=new FormData();d.append("imgfile",b,"image.jpg");$.ajax({data:d,type:"POST",url:a,cache:false,contentType:false,processData:false,success:function(e){if("fail"!=e){if("forQuestion"==c){$("#summernote_question").summernote("insertImage",e,"image name")}else{if("forAnswer"==c){$("#summernote_answer").summernote("insertImage",e,"image name")}else{if("forWrite"==c){$("#summernote_write").summernote("insertImage",e,"image name")}else{if(("forAvatar"==c)||("forTopicAvatar"==c)){$("#id_avatar").attr("src",e).attr("srcset",e)}}}}}}})}function scaleAndUploadImage(d,b,c){var a=new FileReader();a.readAsDataURL(b);a.onload=function(g){var f=new Image();f.onload=function(){var k=c;var j=(k)/(f.naturalWidth)*(f.naturalHeight);if(j*9>k*16){j=k*16/9}var e=document.createElement("canvas");var h=e.getContext("2d");e.width=k;e.height=j;h.drawImage(f,0,0,k,j);e.toBlob(function(l){uploadImage(d,l)},"image/jpeg")};f.src=this.result}}function getIndexImg(d){var c=/<img.*?(?:>|\/>)/gi;var b=d.match(c);if(b!=null){var a=/src=[\'\"]?([^\'\"]*)[\'\"]?/i;imgsrc=b[0].match(a);return imgsrc[1]}else{return null}}function removeImg(c){var a=/<img.*?(?:>|\/>)/gi;var b=c.replace(a,"").replace(/<[^>]+>/g,"").replace(/&nbsp;/ig,"").substr(0,150);return b}function addClassImg(c,b){var a=c.replace(/<img/gi,"<img "+b);return a}function appendMessageElement(k){var q=$("#MenuPopover").attr("data-er-id");$(".Messages-list").empty();for(i in k){var n=k[i][0];var d=k[i][1];var j=k[i][2];var p=k[i][3];var b=k[i][4];var a=k[i][5];var o=k[i][6];var g=k[i][7];var m=k[i][8];var e=k[i][9];if(d==q){continue}if(p!=g_user_id){var c=p;var l=b;var h=a}else{var c=o;var l=g;var h=m}var f='<a href="/conversations/?i='+n+'" class="Messages-item Messages-followItem"><span class="UserLink"><img class="Avatar Avatar--medium UserLink-avatar" width="40" height="40" src="'+h+'" alt="'+l+'"></span><div class="Messages-user"><div class="Messages-userName"><span class="UserLink">'+l+'</span></div><div class="Messages-itemContent">'+e+"</div></div></a>";$(".Messages-list").append(f)}}function appendNotificationElement(h){$(".PushNotifications-list").empty();for(i in h){var a=h[i][0];var j=h[i][1];var g=h[i][2];var b=h[i][3];var f=h[i][4];var k=h[i][5];var d=h[i][6];var c=h[i][7];if("invite"==j){var e='<div class="PushNotifications-item"><span><span><span class="UserLink"><a class="UserLink-link" href="/er/'+b+'">'+f+'</a></span></span></span><span> 邀请你回答 </span><span><a href="/question/'+k+'">'+d+"</a></span></div>"}$(".PushNotifications-list").append(e)}}function appendPopoverSearchElement(e,c){var g='<div class="Popover-content Popover-content--bottom Popover-content--fixed Popover-content-enter Popover-content-enter-active" style="left: 212.4px; top: 43px;"><div class="Menu AutoComplete-menu SearchBar-menu" role="listbox"><div id="IdQuestion" class="AutoComplete-group"></div><div class="AutoComplete-group"><div role="option"><div data-za-module="TopNavBar"><div data-za-module="SearchResultList"><div><a class="SearchBar-searchLink" data-za-not-track-link="true" href="/search?type=all&amp;q='+c+'" target="_blank">查看全部搜索结果</a></div></div></div></div></div></div></div>';$("#searchInput").attr("data-content",g);$("#searchInput").popover("show");for(var f in e){var a=e[f][0];var d=e[f][1];var b=e[f][2];var g='<div class="Menu-item" role="option"><div data-za-module="TopNavBar"><div data-za-module="SearchResultList"><div data-za-detail-view-path-module="QuestionItem"><a class="SearchBar-contentResult" data-za-not-track-link="true" href="/question/'+a+'" target="_blank">'+d+'<span class="SearchBar-contentSuffix">'+b+" 个回答</span></a></div></div></div></div>";$("#IdQuestion").append(g)}}function appendCommentsElement(g){for(var e in g){var c=g[e][0];var h=g[e][1];var b=g[e][2];var f=g[e][3];var l=g[e][4];var m=g[e][5];var j=g[e][6];var k=g[e][7];var d=g[e][8];var a='<div class="CommentItem" data-comment-id="'+c+'" data-comment-author-name="'+j+'"><div><div class="CommentItem-meta"><span class="UserLink CommentItem-avatar"><a class="UserLink-link" target="_blank" href="/er/'+m+'"><img class="Avatar UserLink-avatar" width="24" height="24" src="'+k+'" alt="'+j+'"></a></span><span class="UserLink"><a class="UserLink-link" target="_blank" href="'+m+'">'+j+'</a></span><span class="CommentItem-time">'+getDateDiff(l)+'</span></div><div class="RichText ztext CommentItem-content">'+h+'</div><div class="CommentItem-footer"><button type="button" class="Button-like-nouse Button CommentItem-likeBtn Button--plain" data-like-type="comment" data-like-id="'+c+'">'+like_icon_svg+b+'</button><button type="button" class="Button CommentItem-hoverBtn Button--plain"><svg viewBox="0 0 22 16" class="Icon Icon--reply Icon--left" width="13" height="16" aria-hidden="true" style="height: 16px; width: 13px;"><title></title><g><path d="M21.96 13.22c-1.687-3.552-5.13-8.062-11.637-8.65-.54-.053-1.376-.436-1.376-1.56V.677c0-.52-.635-.915-1.116-.52L.47 6.67C.18 6.947 0 7.334 0 7.763c0 .376.14.722.37.987 0 0 6.99 6.818 7.442 7.114.453.295 1.136.124 1.135-.5V13c.027-.814.703-1.466 1.532-1.466 1.185-.14 7.596-.077 10.33 2.396 0 0 .395.257.535.257.892 0 .614-.967.614-.967z"></path></g></svg>回复</button></div></div></div>';$(".CommentList.CommentList--current").append(a);if(0!=f){$(".CommentItem").each(function(){if($(this).attr("data-comment-id")==f){parent_element=$(this)}else{if($(this).attr("data-comment-id")==c){var q=$(this);var p=parent_element[0].innerHTML;var o=parent_element.attr("data-comment-id");var r=parent_element.attr("data-comment-author-name");var n='<div class="CommentItem CommentItem--border" data-comment-id="'+o+'" data-comment-author-name="'+r+'">'+p+"</div>";q.find(".CommentItem-meta").after(n)}}})}}if(g.length>10){$(".CommentEditor--nouse--bottom").removeClass("is-hide")}$(".CommentItem-hoverBtn").off("click");$(".CommentItem-hoverBtn").on("click",function(){console.log("comment-reply click");$(".CommentItem-footer").removeClass("is-hide");$(".CommentItem-editor").remove();var n=$(this).closest(".CommentItem");var p=n.attr("data-comment-id");var o=n.attr("data-comment-author-name");var q='<div class="CommentItem-editor CommentEditor--inCommentItem CommentEditor--nouse"><div class="CommentEditor-input Input-wrapper Input-wrapper--spread Input-wrapper--large Input-wrapper--noPadding"><div class="Input Editable"><div class="Dropzone RichText ztext" style="min-height: 198px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner">回复'+o+'</div></div><div class="DraftEditor-editorContainer"><div class="notranslate public-DraftEditor-content" contenteditable="true" role="textbox" spellcheck="true" tabindex="0" style="outline: none; white-space: pre-wrap; word-wrap: break-word;"></div></div></div></div><div></div></div></div><div class="CommentEditor-actions"><button type="button" class="Button Button-comment-cancle Button--plain">取消</button><button disabled="" type="button" class="Button Button-comment-send Button--primary Button--green">评论</button></div></div>';n.append(q);n.find(".CommentItem-footer").addClass("is-hide");checkComment()})}function appendAnswerElementList(C,P,n){C.sort();for(i in C){if(("all"==P)){var u=C[i][0];var M=C[i][1];var t=C[i][2];var F=C[i][3];var f=C[i][4];var z=C[i][5];var D=C[i][6];var a=C[i][7];var K=C[i][8];var q=C[i][9];var J=C[i][10];var c=C[i][11];var o=C[i][12];var g=C[i][13];var A=C[i][14];var L=C[i][15];var O=C[i][16];var p="RichContent--unescapable";var m="Button ContentItem-more ContentItem-rightButton Button--plain is-hide";var l="Button ContentItem-less ContentItem-rightButton Button--plain is-hide";var r="";var y='data-content-type="answer" data-content-id="'+u+'"';var d='<svg viewBox="0 0 10 6" class="Icon ContentItem-arrowIcon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg>';var N='<svg viewBox="0 0 10 6" class="Icon ContentItem-arrowIcon is-active Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg>';var H='<div class="RichContent '+p+'"><div class="RichContent-expand"><div class="RichContent-inner" style="max-height: 400px;"><span class="RichText CopyrightRichText-richText">'+addClassImg(M,'class="origin_image"')+'</span></div><button class="'+m+'" type="button">展开阅读全文'+d+'</button></div><div class="ContentItem-actions"><span><button class="Button-like-nouse Button Button--plain" type="button" data-like-type="answer" data-like-id="'+u+'">'+like_icon_svg+t+'</button></span><button class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel" type="button"><span style="display: inline-flex; align-items: center;">&#8203;'+comment_icon_svg+"</span>"+F+" 条评论</button>"+share_button+'<button class="'+l+'" type="button"><span class="RichContent-collapsedText">收起</span>'+N+"</button></div></div>"}else{if(("topic"==P)||("homepage"==P)){if("topic"==P){var k=C[i][2];if("article"==k){var E=C[i][0];var s=C[i][1];var G=C[i][3];var e=C[i][4];var r='<h2 class="ContentItem-title"><div><a target="_blank" href="/article/'+E+'/">'+s+"</a></div></h2>";var I='data-content-url="/article/'+E+'/"';var y='data-content-type="article" data-content-id="'+E+'"';var j='data-like-type="article" data-like-id="'+E+'"';if($.inArray(""+E,g_cache_article_id_list)>=0){continue}else{g_cache_article_id_list.push(""+E)}}else{var B=C[i][0];var w=C[i][1];var G=C[i][3];var u=C[i][4];var r='<h2 class="ContentItem-title"><div><a target="_blank" href="/question/'+B+"/?ans="+u+'">'+w+"</a></div></h2>";var I='data-content-url="/question/'+B+"/?ans="+u+'"';var y='data-content-type="answer" data-content-id="'+u+'"';var j='data-like-type="answer" data-like-id="'+u+'"';if($.inArray(""+B,g_cache_question_id_list)>=0){continue}else{g_cache_question_id_list.push(""+B)}}var b=C[i][5];var M=C[i][6];var t=C[i][7];var F=C[i][8];var x=C[i][9];var z=C[i][10];var D=C[i][11];var a=C[i][12];var K=C[i][13];var q=C[i][14];var J=C[i][15];var c=C[i][16];var o=C[i][17];var g=C[i][18];var A=C[i][19];var L=C[i][21];var O=C[i][21]}else{if("homepage"==P){var u=C[i][0];var B=C[i][1];var w=C[i][2];var M=C[i][3];var t=C[i][4];var F=C[i][5];var z=C[i][6];var D=C[i][7];var a=C[i][8];var K=C[i][9];var r='<h2 class="ContentItem-title"><div><a target="_blank" href="/question/'+B+"/?ans="+u+'">'+w+"</a></div></h2>";var I='data-content-url="/question/'+B+"/?ans="+u+'"';var y='data-content-type="answer" data-content-id="'+u+'"';var j='data-like-type="answer" data-like-id="'+u+'"'}}var v=getIndexImg(M);var H='<div class="RichContent is-collapsed RichContent--withMask"><div class="RichContent-content" '+I+'><div class="RichContent-cover RichContent-cover--mobile"><div class="RichContent-cover-inner" data-index-img-url="'+v+'"></div></div><div class="RichContent-inner RichContent-inner--collapsed"><span class="RichText CopyrightRichText-richText">'+removeImg(M)+'</span></div></div><div class="ContentItem-actions"><span><button class="Button-like-nouse Button Button--plain" type="button" '+j+">"+like_icon_svg+t+'</button></span><button class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel" type="button"><span style="display: inline-flex; align-items: center;">&#8203;'+comment_icon_svg+"</span>"+F+" 条评论</button>"+share_button+"</div></div>"}}var h='<div class="List-item ScrollIntoMark"><div class="ContentItem AnswerItem" '+y+' data-comment-nums="'+F+'">'+r+'<div class="ContentItem-meta"><div class="AuthorInfo AnswerItem-authorInfo AuthorInfo--plain"><span class="UserLink AuthorInfo-avatarWrapper"><a class="UserLink-link" target="_blank" href="/er/'+z+'/"><img class="Avatar AuthorInfo-avatar" width="24" height="24" src="'+a+'" srcset="'+a+'" alt="'+D+'"></a></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><a class="UserLink-link" target="_blank" href="/er/'+z+'/">'+D+'</a></span></div><div class="AuthorInfo-detail"><div class="AuthorInfo-badge"><div class="RichText AuthorInfo-badgeText">'+K+"</div></div></div></div></div></div>"+H+"</div></div>";if("prepend"==n){$("#appendArea").prepend(h)}else{$("#appendArea").append(h)}}}function appendAnswerElementCard(z,O,l){z.sort();for(i in z){var j=z[i][2];if("article"==j){var E=z[i][0];var q=z[i][1];var G=z[i][3];var e=z[i][4];var p='<h2 class="ContentItem-title"><div><a target="_blank" href="/article/'+E+'/">'+q+"</a></div>";var I='data-content-url="/article/'+E+'/"';var w='data-content-type="article" data-content-id="'+E+'"';var h='data-like-type="article" data-like-id="'+E+'"';if($.inArray(""+E,g_cache_article_id_list)>=0){continue}else{g_cache_article_id_list.push(""+E)}}else{var A=z[i][0];var u=z[i][1];var G=z[i][3];var s=z[i][4];var p='<h2 class="ContentItem-title"><div><a target="_blank" href="/question/'+A+"/?ans="+s+'">'+u+"</a></div></h2>";var I='data-content-url="/question/'+A+"/?ans="+s+'"';var w='data-content-type="answer" data-content-id="'+s+'"';var h='data-like-type="answer" data-like-id="'+s+'"';if($.inArray(""+A,g_cache_question_id_list)>=0){continue}else{g_cache_question_id_list.push(""+A)}}var N=z[i][5];var m=z[i][6];var r=z[i][7];var F=z[i][8];var v=z[i][9];var x=z[i][10];var B=z[i][11];var b=z[i][12];var K=z[i][13];var o=z[i][14];var J=z[i][15];var d=z[i][16];var n=z[i][17];var f=z[i][18];var y=z[i][19];var L=z[i][20];var M=z[i][21];var k="";for(i in G){var D=G[i][0];var H=G[i][1];k+='<span style="margin-right:15px;"><a href="/topic/'+D+'/" class="1TopicPopover" data-topic-id="'+D+'" data-toggle="popover" data-placement="bottom" data-trigger="manual" data-content="null" data-html="true">'+H+"</a></span>"}var C='<div class="FeedSource-firstline"><span>'+k+"</span></div>";var t=getIndexImg(m);var a='<div class="AuthorInfo FeedSource-byline AuthorInfo--plain"><span class="UserLink AuthorInfo-avatarWrapper"><a class="UserLink-link" target="_blank" href="/er/'+x+'/"><img class="Avatar AuthorInfo-avatar" width="24" height="24" src="'+b+'" srcset="'+b+'" alt="'+B+'"></a></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><a class="UserLink-link" target="_blank" href="/er/'+x+'/">'+B+'</a><a class="UserLink-badge" 111data-tooltip="优秀回答者" href="/er/'+x+'/" target="_blank"><svg viewBox="0 0 20 20" class="Icon Icon--badgeGlorious" width="16" height="16" aria-hidden="true" style="height: 16px; width: 16px;"><title>用户标识</title><g><g fill="none" fill-rule="evenodd">     <path d="M.64 11.39c1.068.895 1.808 2.733 1.66 4.113l.022-.196c-.147 1.384.856 2.4 2.24 2.278l-.198.016c1.387-.12 3.21.656 4.083 1.735l-.125-.154c.876 1.085 2.304 1.093 3.195.028l-.127.152c.895-1.068 2.733-1.808 4.113-1.66l-.198-.022c1.386.147 2.402-.856 2.28-2.238l.016.197c-.12-1.388.656-3.212 1.735-4.084l-.154.125c1.084-.876 1.093-2.304.028-3.195l.152.127c-1.068-.895-1.808-2.732-1.66-4.113l-.022.198c.147-1.386-.856-2.4-2.24-2.28l.198-.016c-1.387.122-3.21-.655-4.083-1.734l.125.153C10.802-.265 9.374-.274 8.483.79L8.61.64c-.895 1.068-2.733 1.808-4.113 1.662l.198.02c-1.386-.147-2.4.857-2.28 2.24L2.4 4.363c.12 1.387-.656 3.21-1.735 4.084l.154-.126C-.265 9.2-.274 10.626.79 11.517L.64 11.39z" fill="#FF9500"></path>     <path d="M10.034 12.96L7.38 14.58c-.47.286-.747.09-.618-.45l.72-3.024-2.36-2.024c-.418-.357-.318-.68.235-.725l3.1-.25 1.195-2.87c.21-.508.55-.513.763 0l1.195 2.87 3.1.25c.547.043.657.365.236.725l-2.362 2.024.72 3.025c.13.535-.143.74-.616.45l-2.654-1.62z" fill="#FFF"></path>   </g></g></svg></a></span></div><div class="AuthorInfo-detail"><div class="AuthorInfo-badge"><div class="RichText AuthorInfo-badgeText">'+K+"</div></div></div></div></div></div>";var c='<div class="ContentItem AnswerItem" '+w+' data-comment-nums="'+F+'">'+p+'<div class="ContentItem-meta"></div><div class="RichContent is-collapsed RichContent--withMask"><div class="RichContent-content" '+I+'><div class="RichContent-cover RichContent-cover--mobile"><div class="RichContent-cover-inner" data-index-img-url="'+t+'"></div></div><div class="RichContent-inner RichContent-inner--collapsed" style="1max-height:400px"><span class="RichText CopyrightRichText-richText">'+removeImg(m)+'</span></div></div><div class="ContentItem-actions"><span><button class="Button-like-nouse Button Button--plain" type="button" '+h+">"+like_icon_svg+r+'</button></span><button class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel" type="button"><span style="display: inline-flex; align-items: center;">&#8203;'+comment_icon_svg+"</span>"+F+" 条评论</button>"+share_button+"</div></div>";var g='<div class="Card TopstoryItem TopstoryItem--experimentExpand ScrollIntoMark"><div class="Feed"><div class="FeedSource">'+C+a+c+"</div></div></div>";if("prepend"==l){$("#appendArea").prepend(g)}else{$("#appendArea").append(g)}}}function appendTopicElement(k){for(var c in k){var h=k[c][0];var l=k[c][1];var j=k[c][2];var a=k[c][3];var d=k[c][4];var g=k[c][5];var f=k[c][6];console.log(g_user_follow_topics_list);if($.inArray(""+h,g_user_follow_topics_list)>=0){var e='<button class="Button Button--grey FollowButton" type="button" data-follow-type="topic" data-topic-id="'+h+'" data-followed="true">已关注</button>'}else{var e='<button class="Button Button--green FollowButton" type="button" data-follow-type="topic" data-topic-id="'+h+'" data-followed="false">关注栏目</button>'}var b='<div class="List-item"><div class="ContentItem"><div class="ContentItem-main"><div class="ContentItem-image"><span class="TopicLink TopicItem-avatar"><a class="TopicLink-link" target="_blank" href="/topic/'+h+'"><img class="Avatar Avatar--large TopicLink-avatar" width="60" height="60" src="'+j+'"  alt="'+l+'"></a></span></div><div class="ContentItem-head"><h2 class="ContentItem-title"><div class="TopicItem-title"><span class="TopicLink TopicItem-name"><a class="TopicLink-link" target="_blank" href="/topic/'+h+'"><span class="RichText">'+l+'</span></a></span></div></h2><div class="ContentItem-meta"><div><div class="ContentItem-status"><div class="ContentItem-statusItem">'+a+'</div></div></div></div></div><div class="ContentItem-extra">'+e+"</div></div></div></div>";$("#appendArea").append(b)}}function appendInviteElement(c){for(i in c){var b=c[i][0];var a=c[i][1];var f=c[i][2];var e=c[i][3];var d='<div class="List-item"><div class="ContentItem"><div class="ContentItem-main"><div class="ContentItem-image"><span class="UserLink UserItem-avatar"><a class="UserLink-link" target="_blank" href="/er/'+b+'"><img class="Avatar Avatar--large UserLink-avatar PeoplePopover" width="60" height="60" src="'+f+'" srcset="'+f+'" alt="'+a+'" data-author-id="'+b+'" data-toggle="popover" data-placement="bottom" data-trigger="manual" data-content="null" data-html="true"></a></span></div><div class="ContentItem-head"><h2 class="ContentItem-title"><div class="UserItem-title"><span class="UserLink UserItem-name"><a class="UserLink-link" target="_blank" href="/er/'+b+'"><span class="RichText">'+a+'</span></a></span></div></h2><div class="ContentItem-meta"><div><div class="ContentItem-status"><div class="ContentItem-statusItem">'+e+'</div></div></div></div></div><div class="ContentItem-extra"><button class="Button Button--green Invite" type="button" data-receiver="'+b+'">邀请回答</button></div></div></div></div>';$(".QuestionInvitation-content.List").append(d)}}function appendSearchPageElement(c){for(var d in c){var a=c[d][0];var b=c[d][1];var f=c[d][2];b=b.replace(g_search_keyword,"<em>"+g_search_keyword+"</em>");var e='<div class="List-item"><div class="ContentItem AnswerItem"><h2 class="ContentItem-title"><div><meta itemprop="url" content="/question/'+a+'"><a target="_blank" href="/question/'+a+'"><span class="Highlight">'+b+"</span></a></div></h2></div></div>";$("#appendArea").append(e)}}function pushOneConversationMessagesElement(e){var b=$("#letterText").val();var a=new Date();var d=a.toLocaleTimeString();var c='<div class="List-item Conversation-messages-item" data-action="delete_conversation_message" data-action-id="'+e+'"><a class="zm-item-link-avatar50" href="/er/'+g_user_id+'"><img class="zm-item-img-avatar50" src="'+g_user_avatar+'"></a><div class="zm-pm-item-main"><a class="pm-touser author-link" title="verna wu" href="/er/'+g_user_id+'">我</a>：'+b+'</div><div class="zg-gray zu-pm-item-meta"><span class="zg-gray zg-left">'+d+'</span><a class="zg-link-litblue" href="javascript:;" name="delete">删除</a></div></div>';$(".List-item.Conversation-messages-head").after(c);checkSettingPage()}function appendSettingPageElement(x){for(i in x){if("conversations"==g_setting_type){var t=x[i][0];var r=x[i][1];var F=x[i][2];var A=x[i][3];var w=x[i][4];var B=x[i][5];var o=x[i][6];var e=x[i][7];var f=x[i][8];var j=x[i][9];if(r==g_user_id){continue}if(A!=g_user_id){var D=A;var s=w;var u=B}else{var D=o;var s=e;var u=f}var I='<div class="List-item Conversations-item" data-action="delete_conversation" data-action-id="'+t+'" data-receiver-id="'+D+'"  data-receiver-name="'+s+'"><a class="zm-item-link-avatar50" href="/er/'+D+'"><img class="zm-item-img-avatar50" src="'+u+'"></a><div class="zm-pm-item-main"><a class="pm-touser author-link" href="/er/'+D+'">'+s+"</a>："+j+'</div><div class="zg-gray zu-pm-item-meta"><span class="zg-gray zg-left">'+F+'</span><a class="zg-link-litblue" href="javascript:;" name="messages">查看对话</a><span class="zg-bull">|</span><a class="zg-link-litblue" href="javascript:;" name="reply" data-receiver-id="'+D+'"  data-receiver-name="'+s+'" data-toggle="modal" data-target="#letterModal">回复</a><span class="zg-bull">|</span><a class="zg-link-litblue" href="javascript:;" name="delete">删除</a></div></div>';$("#appendArea").append(I)}else{if("conversation_messages"==g_setting_type){var L=x[i][0];var q=x[i][1];var l=x[i][2];var C=x[i][3];var k=x[i][4];var y=x[i][5];var n=x[i][6];var p=x[i][7];var E=x[i][8];var G=x[i][9];var c=x[i][10];if(C==g_user_id){continue}if(y==g_user_id){var n="我";var H=E;var a=G}else{var H=y;var a=n}$(".Conversation-messages-head .zg-gray-darker").text(a);$(".Conversation-messages-head #letterText").attr("data-receiver-id",H);var I='<div class="List-item Conversation-messages-item" data-action="delete_conversation_message" data-action-id="'+L+'"><a class="zm-item-link-avatar50" href="/er/'+y+'"><img class="zm-item-img-avatar50" src="'+p+'"></a><div class="zm-pm-item-main"><a class="pm-touser author-link" href="/er/'+y+'">'+n+"</a>："+q+'</div><div class="zg-gray zu-pm-item-meta"><span class="zg-gray zg-left">'+k+'</span><a class="zg-link-litblue" href="javascript:;" name="delete">删除</a></div></div>';$("#appendArea").append(I)}else{if("notifications"==g_setting_type){var g=x[i][0];var b=x[i][1];var J=x[i][2];var h=x[i][3];var K=x[i][4];var z=x[i][5];var d=x[i][6];var m=x[i][7];if("invite"==b){var v=x[i][7];var I='<div class="List-item day"><h3>'+J+'</h3><div><i></i><div><span><span><a href="/er/'+h+'" target="_blank">'+K+'</a></span>邀请你回答 <a href="/question/'+z+'">'+d+"</a></span></div></div></div>"}$("#appendArea").append(I)}}}}checkSettingPage()}function appendInvitedQuestionElement(l){for(var j in l){var b=l[j][0];var m=l[j][1];var k=l[j][2];var c=l[j][3];var h=l[j][4];var f=l[j][5];var d=l[j][6];var n=l[j][7];var a=l[j][8];var e=l[j][9];var g='<div class="List-item"><div class="ContentItem"><h3 class="ContentItem-title"><div class="QuestionItem-title"><a href="/question/'+f+'" target="_blank">'+d+'</a></div></h3><div class="ContentItem-status"><span class="ContentItem-statusItem"><a href="/er/'+c+'">'+h+'</a></span><span class="ContentItem-statusItem">邀请你回答</span><span class="ContentItem-statusItem">'+k+' </span><span class="ContentItem-statusItem">'+n+' 个回答</span><span class="ContentItem-statusItem">'+a+" 个关注</span></div></div></div>";$("#appendArea").append(g)}}function appendQuestionElement(e){for(var f in e){var a=e[f][0];var d=e[f][1];var h=e[f][2];var c=e[f][3];var b=e[f][4].split(".")[0];var g='<div class="List-item"><div class="ContentItem"><h2 class="ContentItem-title"><div class="QuestionItem-title"><a href="/question/'+a+'" target="_blank">'+d+'</a></div></h2><div class="ContentItem-status"><span class="ContentItem-statusItem">'+b+'</span><span class="ContentItem-statusItem">'+h+' 个回答</span><span class="ContentItem-statusItem">'+c+" 个关注</span></div></div></div>";$("#appendArea").append(g)}}function appendFollowOrMoreElement(x){for(var r in x){if(("followtos"==g_subcmd)||("followers"==g_subcmd)){var f=x[r][0];var a=x[r][1];var w=x[r][2];var h=x[r][3];var t=x[r][4];var m=x[r][5];var v=x[r][6];var l=x[r][7];if("f"==t){var s="she";var j="她"}else{var s="he";var j="他"}if($.inArray(""+f,g_user_follow_peoples_list)>=0){var o='<button class="Button FollowButton Button--primary Button--grey" type="button" data-er-id="'+f+'" data-er-sexual="'+t+'" data-follow-type="people" data-followed="true" data-who="'+s+'">已关注</button>'}else{var o='<button class="Button FollowButton Button--primary Button--green" type="button" data-er-id="'+f+'" data-er-sexual="'+t+'" data-follow-type="people" data-followed="false" data-who="'+s+'">关注'+j+"</button>"}var n="";var y='<div class="List-item"><div class="ContentItem"><div class="ContentItem-main"><div class="ContentItem-image"><span class="UserLink UserItem-avatar"><div class="Popover"><div id="Popover-28784-64463-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover-28784-64463-content"><a class="UserLink-link" target="_blank" href="/er/'+f+'"><img class="Avatar Avatar--large UserLink-avatar" width="60" height="60" src="'+w+'" srcset="'+w+'" alt="'+a+'"></a></div></div></span></div><div class="ContentItem-head"><h2 class="ContentItem-title"><div class="UserItem-title"><span class="UserLink UserItem-name"><div class="Popover"><div id="Popover-28784-44728-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover-28784-44728-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="/er/'+f+'">'+a+"</a></div></div></span>"+n+'</div></h2><div class="ContentItem-meta"><div><div class="RichText">'+h+'</div><div class="ContentItem-status"><span class="ContentItem-statusItem">'+m+' 回答</span><span class="ContentItem-statusItem">'+v+' 文章</span><span class="ContentItem-statusItem">'+l+' 关注者</span></div></div></div></div><div class="ContentItem-extra">'+o+"</div></div></div></div>";$("#appendArea").append(y)}else{if("topics"==g_subcmd){var e=x[r][0];var d=x[r][1];var b=x[r][2];var c=x[r][3];var y='<div class="List-item"><div class="ContentItem"><div class="ContentItem-main"><div class="ContentItem-image"><img class="Avatar Avatar--large" width="60" height="60" src="'+b+'" srcset="'+b+' 2x"></div><div class="ContentItem-head"><h2 class="ContentItem-title"><a class="TopicLink" href="/topic/'+e+'" target="_blank"><div class="Popover"><div id="Popover-92518-2569-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover-92518-2569-content">'+d+'</div></div></a></h2><div class="ContentItem-meta"><div class="ContentItem-status">'+c+"</div></div></div></div></div></div>";$("#appendArea").append(y)}else{if("questions"==g_subcmd){var u=x[r][0];var q=x[r][1];var k=x[r][2];var p=x[r][3];var g=x[r][4];var y='                    <div class="List-item"><div class="ContentItem" ><h2 class="ContentItem-title"><div class="QuestionItem-title"><a href="/question/'+u+'" target="_blank">'+q+'</a></div></h2><div class="ContentItem-status"><span class="ContentItem-statusItem">'+g+'</span><span class="ContentItem-statusItem">'+k+' 个回答</span><span class="ContentItem-statusItem">'+p+" 个关注</span></div></div></div>";$("#appendArea").append(y)}}}}}function appendFollowOrMoreHead(){var a='<div class="List-item NextPage" data-next-page-type="questions"><div class="ContentItem"><div class="ContentItem-main"><div class="1ContentItem-head"><h2 class="1ContentItem-title">关注的问题</h2></div><div class="ContentItem-extra">'+g_followquestion_nums+'</div></div></div></div><div class="List-item NextPage" data-next-page-type="topics"><div class="ContentItem"><div class="ContentItem-main"><div class="1ContentItem-head"><h2 class="1ContentItem-title">关注的栏目</h2></div><div class="ContentItem-extra">'+g_followtopic_nums+"</div></div></div></div>";$("#appendArea").append(a);checkNextPage()}function appendLetterModal(){var b='<svg class="Zi Zi--Close Modal-closeIcon" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M13.486 12l5.208-5.207a1.048 1.048 0 0 0-.006-1.483 1.046 1.046 0 0 0-1.482-.005L12 10.514 6.793 5.305a1.048 1.048 0 0 0-1.483.005 1.046 1.046 0 0 0-.005 1.483L10.514 12l-5.208 5.207a1.048 1.048 0 0 0 .006 1.483 1.046 1.046 0 0 0 1.482.005L12 13.486l5.207 5.208a1.048 1.048 0 0 0 1.483-.006 1.046 1.046 0 0 0 .005-1.482L13.486 12z" fill-rule="evenodd"></path></svg>';var a='<div class="modal fade" id="letterModal" tabindex="0" role="dialog" aria-labelledby="letterModalLabel" aria-hidden="true"><div class="modal-dialog lettermodal"><div class="Modal-inner"><h3 class="Modal-title">发送私信</h3><div class="Modal-content"><div class="Messages-newDialog"><div class="Messages-receiver"><span class="Messages-receiverInfo" data-receiver-id="">who</span></div><div class="Messages-sendContent Input-wrapper Input-wrapper--spread Input-wrapper--multiline"><textarea id="letterTextModal" rows="5" class="Input" placeholder="私信内容"></textarea></div><span class="Messages-warning"></span><div class="ModalButtonGroup ModalButtonGroup--vertical"><button class="Button Messages-sendButton Button--primary Button--green" type="button" onclick="sendLetterViaModal()">发送</button></div></div></div></div><button class="Button Modal-closeButton Button--plain" data-dismiss="modal" aria-label="关闭" type="button">'+b+"</button></div></div>";$("body").append(a);$("#letterModal").on("show.bs.modal",function(){$(".PeoplePopover").popover("hide")})}function invite(){$(".Invite").each(function(a,b){$(b).click(function(){receiver=$(b).attr("data-receiver");if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/invite/",{question:g_question_id,to:receiver},function(c){$(b).attr("disabled","").text("已邀请");g_lock_ajax="false"})})})}function showInvite(){var a="";$(".TopicLink").each(function(){a+=($(this).attr("data-topic-id"))+";"});if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/topic_adept/",{topics:a},function(b){if("fail"!=b){$(".QuestionInvitation-content.List").empty();appendInviteElement(b);$("#inviteModal").modal("show");checkSets();invite()}g_lock_ajax="false"})}function sendLetter(){var b=$("#letterText").val();var a=$("#letterText").attr("data-receiver-id");if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/send_message/"+a+"/",{content:b},function(c){if("fail"!=c){var d=c;pushOneConversationMessagesElement(d)}g_lock_ajax="false"})}function sendLetterViaModal(){var b=$("#letterTextModal").val();var a=$(".Messages-receiverInfo").attr("data-receiver-id");console.log(b);$("#letterModal").modal("toggle");if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/send_message/"+a+"/",{content:b},function(c){if("fail"!=c){console.log(c)}g_lock_ajax="false"})}function setLetterReceiver(b,a){$(".Messages-receiverInfo").attr("data-receiver-id",b);$(".Messages-receiverInfo").text(a)}function checkFollow(){$(".FollowButton").off("click");$(".FollowButton").each(function(){var b=$(this);b.click(function(){console.log("checkFollow");if(false==veriLogin()){return}if("true"==b.attr("data-followed")){follow_action="0"}else{follow_action="1"}if("people"==b.attr("data-follow-type")){var f=b.attr("data-who");if("she"==f){var d="关注她"}else{var d="关注他"}var j="people";var g="people-followed";var e=b.attr("data-er-id")}else{if("topic"==b.attr("data-follow-type")){var d="关注栏目";var j="topic";var g="topic-followed";var e=b.attr("data-topic-id")}else{if("question"==b.attr("data-follow-type")){var d="关注问题";var j="question";var g="question-followed";var e=b.attr("data-question-id")}}}var h={follow_type:j,follow_id:e,follow_action:follow_action};var c="/ajax/follow/";if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post(c,h,function(l){if("fail"!=l){if("true"==b.attr("data-followed")){b.removeClass("Button--grey").addClass("Button--green").text(d);b.attr("data-followed","false")}else{b.removeClass("Button--green").addClass("Button--grey").text("已关注");b.attr("data-followed","true")}if("question"==j){delCookie("ufq"+g_user_token);setCookie("ufq"+g_user_token,utf8_to_b64(l[1]),g_cookie_expire);var k=getCookie("ufq"+g_user_token);g_user_follow_questions_list=b64_to_utf8(k).split(",")}else{if("people"==j){delCookie("ufp"+g_user_token);setCookie("ufp"+g_user_token,utf8_to_b64(l[1]),g_cookie_expire);var n=getCookie("ufp"+g_user_token);g_user_follow_peoples_list=b64_to_utf8(n).split(",")}else{if("topic"==j){delCookie("uft"+g_user_token);setCookie("uft"+g_user_token,utf8_to_b64(l[1]),g_cookie_expire);var m=getCookie("uft"+g_user_token);g_user_follow_topics_list=b64_to_utf8(m).split(",")}}}a(g,l[0])}g_lock_ajax="false"})})});function a(b,c){$(".NumberBoard-value").each(function(){var d=$(this);if(b==d.attr("data-update-value-type")){d.text(c)}})}}function checkContentClick(){$(".RichContent-content").off("click");$(".RichContent-content").each(function(){var a=$(this).find(".RichContent-cover-inner").attr("data-index-img-url");if("null"==a){$(this).find(".RichContent-cover").addClass("is-hide")}else{$(this).find(".RichContent-cover-inner").append('<img src="'+a+'">')}$(this).click(function(){var b=$(this).attr("data-content-url");location.href=b})})}function checkContentCollapse(){$(".ContentItem-less").off("click");$(".ContentItem-less").each(function(){$(this).click(function(){$(this).addClass("is-hide");$(this).parent().siblings(".RichContent-expand").children(".ContentItem-more").removeClass("is-hide");$(this).parents(".RichContent").addClass("is-collapsed");$(this).parent().siblings(".RichContent-expand").children(".RichContent-inner").css("max-height","400px");if($(this).parents(".ScrollIntoMark").length>0){var a=$(this).parents(".ScrollIntoMark").attr("id");document.getElementById(a).scrollIntoView();$(this).parents(".ScrollIntoMark").removeAttr("id")}})})}function checkContentExpand(){$(".RichContent-expand").off("click");$(".RichContent-expand").each(function(){console.log($(this).height());if($(this).height()>=400){$(this).find(".ContentItem-more").removeClass("is-hide");$(this).parents(".RichContent").addClass("is-collapsed")}else{$(this).find(".ContentItem-more").remove();$(this).siblings(".ContentItem-actions").find(".ContentItem-less").remove()}if($(this).parents(".ScrollIntoMark").length>0){var a=""+Math.random();$(this).parents(".ScrollIntoMark").attr("id",a)}$(this).click(function(){$(this).children(".ContentItem-more").addClass("is-hide");$(this).siblings(".ContentItem-actions").children(".ContentItem-less").removeClass("is-hide");$(this).parent().removeClass("is-collapsed");$(this).children(".RichContent-inner").css("max-height","");if($(this).parents(".ScrollIntoMark").length>0){var b=""+Math.random();$(this).parents(".ScrollIntoMark").attr("id",b)}})})}function checkQuestionDetailCollapse(){$(".QuestionHeader-detail-less").off("click");$(".QuestionHeader-detail-less").each(function(){$(this).click(function(){$(this).addClass("is-hide");$(this).parents(".RichContent").find(".QuestionHeader-detail-more").removeClass("is-hide");$(this).parents(".RichContent").addClass("is-collapsed");$(this).parents(".RichContent").find(".RichContent-inner").css("max-height","200px");if($(this).parents(".ScrollIntoMark").length>0){var a=$(this).parents(".ScrollIntoMark").attr("id");document.getElementById(a).scrollIntoView();$(this).parents(".ScrollIntoMark").removeAttr("id")}})})}function checkQuestionDetailExpand(){$(".QuestionHeader-detail-expand").off("click");$(".QuestionHeader-detail-expand").each(function(){console.log($(this).height());if($(this).height()>=200){$(this).find(".QuestionHeader-detail-more").removeClass("is-hide");$(this).parents(".RichContent").addClass("is-collapsed")}else{$(this).find(".QuestionHeader-detail-more").addClass("is-hide");$(this).parents(".RichContent").find(".QuestionHeader-detail-less").addClass("is-hide")}if($(this).parents(".ScrollIntoMark").length>0){var a=""+Math.random();$(this).parents(".ScrollIntoMark").attr("id",a)}$(this).click(function(){$(this).children(".QuestionHeader-detail-more").addClass("is-hide");$(this).parents(".RichContent").find(".QuestionHeader-detail-less").removeClass("is-hide");$(this).parent().removeClass("is-collapsed");$(this).children(".RichContent-inner").css("max-height","");if($(this).parents(".ScrollIntoMark").length>0){var b=""+Math.random();$(this).parents(".ScrollIntoMark").attr("id",b)}})})}function checkSearchSelect(){$(".Menu-item").off("mouseenter mouseleave");$(".Menu-item").on("mouseenter mouseleave",function(a){if(a.type=="mouseenter"){$(this).addClass("is-active")}else{if(a.type=="mouseleave"){$(this).removeClass("is-active")}}})}function checkSearch(){var a="false";$("#searchInput").off("keyup click");$("#searchInput").on("keyup click",function(){if("false"==a){var b=$(this).val();g_search_keyword=b.replace(/[^\a-\z\A-\Z0-9\u4E00-\u9FA5]/g,"");if(""!=g_search_keyword){$(".Icon.Icon--search").css({fill:"#228b22"});$("#appendArea").empty();g_last_getmoredata_index=0;getMoreData()}else{$(".Icon.Icon--search").css({fill:"#afbdcf"})}}});$("#searchInput").off("blur");$("#searchInput").on("blur",function(){a="false"});$("#searchInput").off("compositionstart");$("#searchInput").on("compositionstart",function(b){a="true"});$("#searchInput").off("compositionend");$("#searchInput").on("compositionend",function(b){a="false"});$(".Tabs-link").off("click");$(".Tabs-link").on("click",function(){$(".Tabs-link").removeClass("is-active");$(this).addClass("is-active");g_search_type=$(this).attr("data-search-type");$("#appendArea").empty();g_last_getmoredata_index=0;getMoreData()})}function checkExpandBtn(){$(".MobileAppHeader-expandBtn").off("click");$(".MobileAppHeader-expandBtn").click(function(c){console.log("MobileAppHeader-expandBtn click");if($(".MobileAppHeader-expandBtn").children("svg").hasClass("Zi--More")){var a='<svg class="Zi Zi--Close" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M13.486 12l5.208-5.207a1.048 1.048 0 0 0-.006-1.483 1.046 1.046 0 0 0-1.482-.005L12 10.514 6.793 5.305a1.048 1.048 0 0 0-1.483.005 1.046 1.046 0 0 0-.005 1.483L10.514 12l-5.208 5.207a1.048 1.048 0 0 0 .006 1.483 1.046 1.046 0 0 0 1.482.005L12 13.486l5.207 5.208a1.048 1.048 0 0 0 1.483-.006 1.046 1.046 0 0 0 .005-1.482L13.486 12z" fill-rule="evenodd"></path></svg>';$(".MobileAppHeader-expandBtn").empty().append(a);var b='<div><div class="MobileAppHeader-expandContainer"><span><div class="MobileAppHeader-expand"><a href="/topic"><svg class="Zi Zi--Home" fill="#8590a6" viewBox="0 0 24 24" width="24" height="24"><path d="M3 3.99C3 2.892 3.893 2 4.995 2h14.01C20.107 2 21 2.898 21 3.99v16.02c0 1.099-.893 1.99-1.995 1.99H4.995A1.997 1.997 0 0 1 3 20.01V3.99zM6 7c0 .556.449 1 1.002 1h9.996a.999.999 0 1 0 0-2H7.002C6.456 6 6 6.448 6 7zm0 5c0 .556.449 1 1.002 1h9.996a.999.999 0 1 0 0-2H7.002C6.456 11 6 11.448 6 12zm0 5c0 .556.446 1 .997 1h6.006c.544 0 .997-.448.997-1 0-.556-.446-1-.997-1H6.997C6.453 16 6 16.448 6 17z"></path></svg>栏目</a><a href="/search/"><svg class="Zi Zi--Search" fill="#8590a6" viewBox="0 0 24 24" width="24" height="24"><path d="M17.068 15.58a8.377 8.377 0 0 0 1.774-5.159 8.421 8.421 0 1 0-8.42 8.421 8.38 8.38 0 0 0 5.158-1.774l3.879 3.88c.957.573 2.131-.464 1.488-1.49l-3.879-3.878zm-6.647 1.157a6.323 6.323 0 0 1-6.316-6.316 6.323 6.323 0 0 1 6.316-6.316 6.323 6.323 0 0 1 6.316 6.316 6.323 6.323 0 0 1-6.316 6.316z" fill-rule="evenodd"></path></svg>搜索&nbsp;<span style="color:#cbcbcb">|</span>&nbsp;提问</a><a href="/notifications"><svg viewBox="0 0 24 24" class="Zi Zi--Setting" width="24" height="26" fill="#8590a6" style="height: 26px; width: 24px;"><title></title><g><path d="M18.868 15.185c-.164.096-.315.137-.452.137-.123 0-1.397-.26-1.617-.233-1.355.013-1.782 1.275-1.836 1.74-.055.454 0 .893.19 1.304.138.29.125.577-.067.85-.863.893-2.165 1.016-2.357 1.016-.123 0-.247-.055-.356-.15-.11-.097-.685-1.14-1.07-1.47-1.303-.954-2.246-.328-2.63 0-.397.33-.67.7-.835 1.126-.07.18-.18.302-.33.37-1.354.426-2.918-.92-3.014-1.056-.082-.11-.123-.22-.123-.356-.014-.138.383-1.276.342-1.688-.342-1.9-1.836-1.687-2.096-1.673-.303.014-.604.068-.92.178-.205.056-.396.03-.588-.054-.888-.462-1.137-2.332-1.11-2.51.055-.315.192-.52.438-.604.425-.164.81-.452 1.15-.85.932-1.262.344-2.25 0-2.634-.34-.356-.725-.645-1.15-.81-.137-.04-.233-.15-.328-.315C-.27 6.07.724 4.95.978 4.733c.255-.22.6-.055.723 0 .426.164.878.22 1.344.15C4.7 4.636 4.784 3.14 4.81 2.908c.015-.247-.11-1.29-.136-1.4-.027-.123-.014-.22.027-.315C5.318.178 7.073 0 7.223 0c.178 0 .33.055.44.178.108.124.63 1.11 1 1.4.398.338 1.582.83 2.588.013.398-.273.96-1.288 1.083-1.412.123-.123.26-.178.384-.178 1.56 0 2.33 1.03 2.438 1.22.083.124.096.248.07.37-.03.152-.33 1.153-.262 1.606.366 1.537 1.384 1.742 1.89 1.783.494.027 1.645-.357 1.81-.344.164.014.315.083.424.206.535.31.85 1.715.905 2.14.027.233-.014.44-.11.562-.11.138-1.165.714-1.48 1.112-.855.982-.342 2.25-.068 2.606.26.37 1.22.905 1.288.96.15.137.26.302.315.494.146 1.413-.89 2.387-1.07 2.47zm-8.905-.535c.644 0 1.246-.123 1.822-.356.575-.248 1.082-.59 1.493-1.016.425-.425.754-.92 1-1.495.247-.562.357-1.18.357-1.81 0-.66-.11-1.262-.356-1.825-.248-.562-.577-1.056-1.002-1.48-.41-.427-.918-.756-1.493-1.003-.576-.233-1.178-.357-1.822-.357-.644 0-1.247.124-1.81.357-.56.247-1.067.576-1.478 1.002-.425.425-.768.92-1 1.48-.247.564-.37 1.167-.37 1.826 0 .644.123 1.248.37 1.81.232.563.575 1.07 1 1.495.424.426.917.768 1.48 1.016.56.233 1.164.356 1.808.356z"></path></g></svg>通知&nbsp;<span style="color:#cbcbcb">|</span>&nbsp;私信&nbsp;<span style="color:#cbcbcb">|</span>&nbsp;设置</a><a href="/er/'+g_user_id+'"><svg class="Zi Zi--Profile" fill="#8590a6" viewBox="0 0 24 24" width="24" height="24"><path d="M15.417 12.923c-.376.653-.837 1.281-.763 1.863.292 2.273 5.562 1.77 6.78 3.048.566.595.566.664.566 4.164-6.611-.07-13.363 0-20 0 .027-3.5 0-3.478.62-4.164 1.303-1.44 6.581-.715 6.78-3.133.045-.545-.38-1.114-.763-1.778C6.511 9.233 5.697 2 12 2s5.422 7.443 3.417 10.923z" fill-rule="evenodd"></path></svg>我的主页</a><a href="/exit/"><svg class="Zi Zi--Logout" fill="#8590a6" viewBox="0 0 24 24" width="24" height="24"><path d="M2 11.999c0-2.756 1.154-5.417 3.167-7.3a1.266 1.266 0 0 1 1.73 1.847 7.396 7.396 0 0 0-2.367 5.453c0 4.119 3.35 7.47 7.47 7.47 4.119 0 7.47-3.351 7.47-7.47a7.41 7.41 0 0 0-2.279-5.37 1.266 1.266 0 0 1 1.76-1.819A9.923 9.923 0 0 1 22 12c0 5.513-4.486 10-10 10s-10-4.487-10-10zm8.699-.482V3.26a1.26 1.26 0 1 1 2.52 0v8.257a1.26 1.26 0 1 1-2.52 0z" fill-rule="evenodd"></path></svg>退出帐号</a><div class="MobileAppHeader-expandBackdrop"></div></div></span></div></div>';$("body").addClass("MobileAppHeader-noScrollBody").append(b)}else{if($(".MobileAppHeader-expandBtn").children("svg").hasClass("Zi--Close")){var a='<svg class="Zi Zi--More" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M3.5 5h16a1.5 1.5 0 0 1 0 3h-16a1.5 1.5 0 0 1 0-3zm0 6h16a1.5 1.5 0 0 1 0 3h-16a1.5 1.5 0 0 1 0-3zm0 6h16a1.5 1.5 0 0 1 0 3h-16a1.5 1.5 0 0 1 0-3z" fill-rule="evenodd"></path></svg>';$(".MobileAppHeader-expandBtn").empty().append(a);$("body").removeClass("MobileAppHeader-noScrollBody");$(".MobileAppHeader-expandContainer").parent().remove()}}})}function checkSmsSend(){$(".SignFlow-smsInputButton").off("click");$(".SignFlow-smsInputButton").click(function(){var e=$(this).hasClass("is-counting");if(e){console.log("counting,can`t click")}else{if("sign"==g_module){var c=$("input[name='regPhoneNo']").val()}else{var c=$("input[name='phoneNo']").val()}console.log(c);var b=/^1[3|4|5|7|8][0-9]{9}$/;var a=b.test(c);if(a){g_countdown_secs=59;$(this).addClass("is-counting").empty().append('<span id="counting-num">59</span>秒后可重发');setTimeout("countDown()",1000);setCookie("countdown",g_countdown_secs,g_countdown_secs);if("sign"==g_module){var d={phone_no:c,type:"register"}}else{if("misc"==g_module){var d={phone_no:c,type:"password_reset"}}}if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/send_sms/",d,function(f){if("fail"!=f){if("registered"==f){$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("该手机号已注册")}else{if("unregistered"==f){$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("该手机号未注册，无此用户")}else{$(".StepHeader-subtitle").text("验证码已发送到您的手机上，请查看并输入")}}}g_lock_ajax="false"})}else{console.log("phone no error");$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("手机号格式错误")}}})}function checkSignAndMiscPage(){$(".SignFlowInput-errorMask").click(function(){console.log("error mask click");$(this).addClass("SignFlowInput-errorMask--hidden");$(this).siblings(".Input-wrapper").children(".Input").val("").focus()});$(".SignFlow-switchPassword").off("click");$(".SignFlow-switchPassword").click(function(){var a=$(this).parents(".SignFlow-password").find(".Input");if("password"==a.attr("type")){a.attr("type","text");var b='<svg width="24" height="20" viewBox="0 0 24 24" class="Icon SignFlow-switchPasswordIcon Icon--read" aria-hidden="true" style="vertical-align: middle; height: 20px; width: 24px;"><title></title><g><title>Read</title><path d="M1 11.5C1 15 7 19 12 19s11-4 11-7.5S17 4 12 4 1 8 1 11.5zm11 5c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm-3-5c0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3-3 1.34-3 3z" fill-rule="evenodd"></path></g></svg>'}else{a.attr("type","password");var b='<svg width="24" height="20" viewBox="0 0 24 24" class="Icon SignFlow-switchPasswordIcon Icon--inconspicuous" aria-hidden="true" style="vertical-align: middle; height: 20px; width: 24px;"><title></title><g><title>Inconspicuous</title><path d="M17.007 11.504c0 .65-.13 1.26-.36 1.83l3 3.073S23 14.136 23 11.504C23 8.008 17.255 4 11.995 4c-1.4 0-2.741.25-3.982.701l2.161 2.16c.57-.23 1.18-.36 1.831-.36a5.004 5.004 0 0 1 5.002 5.003zM2.57 4.342l2.067 2.075C3.499 7.258 1 9.119 1 11.504c0 3.336 5.79 7.503 11.005 7.503 1.55 0 3.031-.3 4.382-.84l.42.42 2.125 2.118s.782.571 1.314 0-.074-1.305-.074-1.305L3.955 3.183s-.76-.742-1.385-.19c-.626.554 0 1.35 0 1.35zm4.963 4.96l1.55 1.552c-.05.21-.08.43-.08.65 0 1.66 1.341 3.001 3.002 3.001.22 0 .44-.03.65-.08l1.551 1.551c-.67.33-1.41.53-2.2.53a5.004 5.004 0 0 1-5.003-5.002c0-.79.2-1.53.53-2.201zm4.312-.78l3.151 3.152.02-.16c0-1.66-1.34-3.001-3.001-3.001l-.17.01z" fill-rule="evenodd"></path></g></svg>'}$(this).empty().append(b)});$("#switchRegisterLogin").click(function(){var a=$(".SignContainer-switch");if("login"==a.attr("data-action")){$(this).text("登录");$("#registerLoginText").text("已有帐号？");a.attr("data-action","register");$(".SignFlowHeader-title").text("注册"+SITE);$(".SignFlowHeader-subTitle").text(SITE_SLOGAN);$("#register").removeClass("is-hide");$("#login").addClass("is-hide")}else{$(this).text("注册");$("#registerLoginText").text("没有帐号？");a.attr("data-action","login");$(".SignFlowHeader-title").text("登录"+SITE);$(".SignFlowHeader-subTitle").text(SITE_SLOGAN);$("#register").addClass("is-hide");$("#login").removeClass("is-hide")}});$(".Login-cannotLogin").click(function(){location.href="/account/?arg=password_reset"});$(".Icon.Icon--remove").click(function(){console.log("Icon click");location.href="/"})}function checkRegisterValid(){console.log("need checkRegisterValid");var a=true;var d=$("input[name='regPhoneNo']").val();var b=/^1[3|4|5|7|8][0-9]{9}$/;var c=b.test(d);if(!c){console.log("phone no error");$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("手机号格式错误");a=false}var d=$("input[name='digits']").val();var b=/^[0-9]{6}$/;var c=b.test(d);if(!c){console.log("verification code error");$(".SignFlow-smsInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("验证码格式错误");a=false}var d=$("input[name='nickname']").val();if(d.length>=30){console.log("nickname too long:"+d.length);$(".SignFlow-username>.SignFlowInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("输入的昵称太长");a=false}var d=$("input[name='regPassword']").val();var b=/^[A-Za-z0-9]{6,18}$/;var c=b.test(d);if(!c){console.log("password error");$(".SignFlow-password>.SignFlowInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("密码为6~18位的字母或数字");a=false}return a}function checkLoginValid(){console.log("need checkLoginValid");var a=true;var d=$("input[name='loginPhoneNo']").val();var b=/^1[3|4|5|7|8][0-9]{9}$/;var c=b.test(d);if(!c){console.log("phone no error");$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("手机号格式错误");a=false}var d=$("input[name='loginPassword']").val();console.log(d);var b=/^[A-Za-z0-9]{6,18}$/;var c=b.test(d);if(!c){console.log("password error");$(".SignFlow-password>.SignFlowInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("密码为6~18位的字母或数字");a=false}return a}function checkSecondStep(){var a=true;var e=$("input[name='password']").val();var b=/^[A-Za-z0-9]{6,18}$/;var d=b.test(e);if(!d){console.log("password error");$(".SignFlow-password.SignFlow-password-first>.SignFlowInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("6~18位的字母或数字");a=false}var g=$("input[name='repeatPassword']").val();var b=/^[A-Za-z0-9]{6,18}$/;var d=b.test(g);if(!d){console.log("password error");$(".SignFlow-password.SignFlow-password-second>.SignFlowInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("6~18位的字母或数字");a=false}if(false==a){return false}if(e!=g){console.log("password not equal");$(".SignFlow-password>.SignFlowInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("两次密码输入不一致");a=false}if(false==a){return false}var f=$("input[name='phoneNo']").val();var c=$("input[name='digits']").val();if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/reset_pwd/",{phone_no:f,veri_code:c,pwd:e},function(h){if("fail"!=h){if("success"==h){console.log("reset ok");location.href="/account/?arg=reset_pwd_success"}}g_lock_ajax="false"});return false}function checkFirstStep(){var a=true;var e=$("input[name='phoneNo']").val();console.log(e);var b=/^1[3|4|5|7|8][0-9]{9}$/;var d=b.test(e);if(!d){console.log("phone no error");$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("手机号格式错误");a=false}var c=$("input[name='digits']").val();var b=/^[0-9]{6}$/;var d=b.test(c);if(!d){console.log("verification code error");$(".SignFlow-smsInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("验证码格式错误");a=false}if(false==a){return false}if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/check_sms/",{phone_no:e,type:"password_reset",veri_code:c},function(f){if("fail"!=f){if("unregistered"==f){$(".SignFlow-accountInputContainer>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("该手机号未注册，无此用户")}else{if("veri_code_error"==f){$(".SignFlow-smsInput>.SignFlowInput-errorMask").removeClass("SignFlowInput-errorMask--hidden").text("验证码错误")}else{if("veri_code_ok"==f){console.log("check next step ok");$(".SignFlow-account").addClass("is-hide");$(".SignFlow-SMSInput").addClass("is-hide");$(".SignFlow-password").removeClass("is-hide");$(".PasswordReset-nextStep").text("重置密码");$(".StepHeader-title").text("设置新密码");$(".StepHeader-subtitle").text("新密码长度为6~18位，包含字母或数字");$(".PasswordReset-step").attr("onsubmit","return checkSecondStep()")}}}}g_lock_ajax="false"});return false}function checkReturnHomePage(){$(".ReturnHomePage").off("click");$(".ReturnHomePage").click(function(){$("main").empty().append(g_cache_page);checkHomePage();checkNextPage()})}function checkNextPage(){$(".NextPage").off("click");$(".NextPage").on("click",function(){console.log(this);g_command="following";g_subcmd=$(this).attr("data-next-page-type");g_cache_page=$("main").html();var a='<div class="Card Profile-datalist" id="Profile-datalist"><div id="appendArea" class=""><div class="ProfileHeader-expandActions ProfileEdit-expandActions"><button class="Button--green ReturnHomePage" style="margin:3px" type="button">返回我的主页</button></div></div></div>';$("main").empty().append(a);getMoreData();checkReturnHomePage()})}function checkAvatar(){$(".Profile-avatar.Modify-avatar,.MaskAvatar-content").click(function(){$("#id_avatar_input").click();$("#id_avatar_input").on("change",function(){var a=$("#id_avatar_input")[0].files[0];scaleAndUploadImage("forAvatar",a,200)})})}function checkHomePage(){$(".ProfileEditButton,.Profile-infosOia").click(function(){console.log(this);g_cache_page=$("main").html();if($(this).hasClass("Profile-infosOia")){var c='<div class="Card"><div class="ProfileHeader-expandActions ProfileEdit-expandActions"><button class="1Button 1Button--primary Button--green ReturnHomePage" style="margin:3px" type="button">返回我的主页</button></div><div class="Profile-intro"><img id="id_avatar" class="Profile-avatar Modify-avatar" src="'+g_er_avatar+'"alt=""></div><div class="Profile-data"><div class="Profile-datalist"><div class="Field List-item"><h6>昵称</h6><div class="Field-content"><div><span class="Field-text"><span class="RichText">'+g_er_name+'</span></span></div></div></div><div class="Field List-item"><h6>性别</h6><div class="Field-content"><div><span class="Field-text">'+g_er_sexual_han+'</span></div></div></div><div class="Field List-item"><h6>一句话介绍</h6><div class="Field-content"><div><span class="Field-text"><span class="RichText">'+g_er_mood+'</span></span></div></div></div><div class="Field List-item"><h6>居住地</h6><div class="Field-content"><div><span class="Field-text"><span class="RichText">'+g_er_residence+'</span></span></div></div></div><div class="Field List-item"><h6>所在行业</h6><div class="Field-content"><div><span class="Field-text">'+g_er_job+'</span></div></div></div><div class="Field List-item"><h6>个人简介</h6><div class="Field-content"><div class="DescriptionField-content"><span class="Field-text"><span class="RichText">'+g_er_intro+"</span></span></div></div></div></div></div></div>";$("main").empty().append(c);checkReturnHomePage()}else{var c='<div class="Card"><div class="ProfileHeader-expandActions ProfileEdit-expandActions"><button class="1Button 1Button--primary Button--green ReturnHomePage" style="margin:3px" type="button">返回我的主页</button></div><div class="Profile-intro"><img id="id_avatar" class="Profile-avatar Modify-avatar" src="'+g_er_avatar+'"alt=""><input id="id_avatar_input" name="file" type="file" accept="image/*" 1capture="camera" 1multiple="multiple" style="display: none;"/><div class="MaskAvatar"><div class="MaskAvatar-black"></div><div class="MaskAvatar-content"><svg class="Zi Zi--Camera MaskAvatar-cameraIcon" fill="currentColor" viewBox="0 0 24 24" width="36" height="36"><path d="M20.094 6S22 6 22 8v10.017S22 20 19 20H4.036S2 20 2 18V7.967S2 6 4 6h3s1-2 2-2h6c1 0 2 2 2 2h3.094zM12 16a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7zm0 1.5a5 5 0 1 0-.001-10.001A5 5 0 0 0 12 17.5zm7.5-8a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" fill-rule="evenodd"></path></svg><div class="UserAvatarEditor-maskInnerText">点击修改头像</div></div></div></div><div class="Profile-data"><div class="Profile-datalist"><div class="Field List-item"><h6>昵称</h6><div class="Field-content" data-field-type="nickname"><div><span class="Field-text"><span class="RichText">'+g_er_name+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+'修改</button></div></div></div><div class="Field List-item"><h6>性别</h6><div class="Field-content" data-field-type="sexual"><div><span class="Field-text">'+g_er_sexual_han+'</span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+'修改</button></div></div></div><div class="Field List-item"><h6>一句话介绍</h6><div class="Field-content" data-field-type="mood"><div><span class="Field-text"><span class="RichText">'+g_er_mood+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+'修改</button></div></div></div><div class="Field List-item"><h6>居住地</h6><div class="Field-content" data-field-type="residence"><div><span class="Field-text"><span class="RichText">'+g_er_residence+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+'修改</button></div></div></div><div class="Field List-item"><h6>所在行业</h6><div class="Field-content" data-field-type="job"><div><span class="Field-text">'+g_er_job+'</span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+'修改</button></div></div></div><div class="Field List-item"><h6>个人简介</h6><div class="Field-content" data-field-type="intro"><div class="DescriptionField-content"><span class="Field-text"><span class="RichText">'+g_er_intro+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div></div></div></div></div></div>";$("main").empty().append(c);checkReturnHomePage();checkAvatar();b()}});function a(){$(".save").off("click");$(".save").click(function(){var e=$(this);var d=$(this).parents(".Field-content").attr("data-field-type");var c=$("input[name='"+d+"']").val();if("sexual"==d){var c=$("input[name='sexual']:checked").val()}else{if("intro"==d){var c=$("textarea[name='intro']").val()}}if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/profile_edit/",{field_type:d,content:c},function(f){if("fail"!=f){if("nickname"==d){g_er_name=f;var g='<div><span class="Field-text"><span class="RichText">'+g_er_name+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>";$(".ProfileHeader-name").empty().append(g_er_name)}else{if("sexual"==d){if("f"==f){g_er_sexual="she";g_er_sexual_han="女"}else{if("m"==f){g_er_sexual="he";g_er_sexual_han="男"}}var g='<div><span class="Field-text">'+g_er_sexual_han+'</span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("mood"==d){g_er_mood=f;var g='<div><span class="Field-text"><span class="RichText">'+g_er_mood+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("residence"==d){g_er_residence=f;var g='<div><span class="Field-text"><span class="RichText">'+g_er_residence+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("job"==d){g_er_job=f;var g='<div><span class="Field-text">'+g_er_job+'</span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("intro"==d){g_er_intro=f;var g='<div class="DescriptionField-content"><span class="Field-text"><span class="RichText">'+g_er_intro+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}}}}}}e.parents(".Field-content").empty().append(g)}g_lock_ajax="false";b()})});$(".cancle").off("click");$(".cancle").click(function(){var d=$(this).parents(".Field-content").attr("data-field-type");if("nickname"==d){var c='<div><span class="Field-text"><span class="RichText">'+g_er_name+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("sexual"==d){var c='<div><span class="Field-text">'+g_er_sexual_han+'</span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("mood"==d){var c='<div><span class="Field-text"><span class="RichText">'+g_er_mood+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("residence"==d){var c='<div><span class="Field-text"><span class="RichText">'+g_er_residence+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("job"==d){var c='<div><span class="Field-text">'+g_er_job+'</span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}else{if("intro"==d){var c='<div class="DescriptionField-content"><span class="Field-text"><span class="RichText">'+g_er_intro+'</span></span><button class="Button ModifyButton Button--link" type="button">'+modify_icon_svg+"修改</button></div>"}}}}}}$(this).parents(".Field-content").empty().append(c);b()})}function b(){$(".Field").find(".ModifyButton").off("click");$(".Field").find(".ModifyButton").click(function(){var d=$(this).parents(".Field-content").attr("data-field-type");if("nickname"==d){var c='<div><div class="HeadlineField-input Input-wrapper"><input name="nickname" class="Input" value="'+g_er_name+'"></div><div class="HeadlineField-actions"><div class="ButtonGroup HeadlineField-buttonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>'}else{if("sexual"==d){if("f"==g_er_sexual){var c='<div><input type="radio" name="sexual" value="m"> 男<input type="radio" name="sexual" value="f" checked style="margin-left: 30px;"> 女<div class="ButtonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div></div>'}else{var c='<div><input type="radio" name="sexual" value="m" checked> 男<input type="radio" name="sexual" value="f" style="margin-left: 30px;"> 女<div class="ButtonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div></div>'}}else{if("mood"==d){var c='<div><div class="HeadlineField-input Input-wrapper"><input name="mood" class="Input" value="'+g_er_mood+'"></div><div class="HeadlineField-actions"><div class="ButtonGroup HeadlineField-buttonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>'}else{if("residence"==d){var c='<div><div class="HeadlineField-input Input-wrapper"><input name="residence" class="Input" value="'+g_er_residence+'"></div><div class="HeadlineField-actions"><div class="ButtonGroup HeadlineField-buttonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>';$(this).parents(".Field-content").empty().append(c)}else{if("job"==d){var c='<div><div class="HeadlineField-input Input-wrapper"><input name="job" class="Input" value="'+g_er_job+'"></div><div class="HeadlineField-actions"><div class="ButtonGroup HeadlineField-buttonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>'}else{if("intro"==d){var c='<div><textarea name="intro" rows="3" class="DescriptionField-input TextArea">'+g_er_intro+'</textarea><div class="DescriptionField-actions"><div class="ButtonGroup DescriptionField-buttonGroup"><button class="Button Button--primary Button--green save" type="button">保存</button><button class="Button Button--grey cancle" type="button">取消</button></div><span class="MaxLength"></span></div></div>'}}}}}}$(this).parents(".Field-content").empty().append(c);a()})}}function checkSettingPage(){$("a[name='messages']").off("click");$("a[name='messages']").on("click",function(){var c=$(this).parents(".List-item");console.log(c);var a=c.attr("data-action-id");var d=c.attr("data-receiver-id");var b=c.attr("data-receiver-name");show_conversion_messages(a,d,b)});$("a[name='reply']").off("click");$("a[name='reply']").on("click",function(){var b=$(this).parents(".List-item");console.log(b);var c=b.attr("data-receiver-id");var a=b.attr("data-receiver-name");setLetterReceiver(c,a)});$("a[name='delete']").off("click");$("a[name='delete']").on("click",function(){var b=$(this).parents(".List-item");var c=b.attr("data-action");var a=b.attr("data-action-id");if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/"+c+"/"+a+"/",function(d){if("success"==d){b.remove()}g_lock_ajax="false"})})}function checkSelectOption(){$(".selectpicker").on("show.bs.select",function(f){if("false"==g_selectpicker_init){if(""==cache_topics){var c="1";if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/topics/"+c+"/0/0/",function(h){if("fail"!=h){cache_topics=h;for(var j in cache_topics){var g=cache_topics[j][0];var e=cache_topics[j][1];$(".selectpicker").append("<option value="+g+":"+e+">"+e+"</option>")}$(".selectpicker").selectpicker("refresh");g_selectpicker_init="true"}g_lock_ajax="false"})}else{for(var d in cache_topics){var b=cache_topics[d][0];var a=cache_topics[d][1];$(".selectpicker").append("<option value="+b+":"+a+">"+a+"</option>")}$(".selectpicker").selectpicker("refresh");g_selectpicker_init="true"}}else{console.log("select has init")}})}function checkComment(){var b="";var a="false";$(".Button-comment-send.CommentEditor-singleButton").attr("disabled","");$(".Comments-footer").find(".public-DraftEditorPlaceholder-inner").removeClass("is-hide");$(".Comments-footer").find(".public-DraftEditor-content").empty();$(".Button-comment-send").off("mousedown");$(".Button-comment-send").on("mousedown",function(){console.log("mousedown");var d=$(this).closest(".CommentItem").attr("data-comment-id");if("article"==g_module){var c="article";var f=g_article_id}else{var c=$(this).parents(".ContentItem.AnswerItem").attr("data-content-type");var f=$(this).parents(".ContentItem.AnswerItem").attr("data-content-id")}if(typeof(d)=="undefined"){d=0}console.log(f);console.log(d);if(b.length>MIDDLE_TEXT_MAX_LENGTH){b=b.substr(0,MIDDLE_TEXT_MAX_LENGTH-1)}var e={c_type:c,a_id:f,c_content:b,parent_comment_id:d};$.post("/ajax/comment/",e,function(g){if("fail"!=g){console.log("comment success");appendCommentsElement(g);checkComment()}});$(this).attr("disabled","");$(this).parents(".Comments-footer").find(".public-DraftEditorPlaceholder-inner").removeClass("is-hide");$(this).parents(".Comments-footer").find(".public-DraftEditor-content").empty();$(this).closest(".CommentItem").find(".CommentItem-footer").removeClass("is-hide");$(this).closest(".CommentItem-editor").remove()});$(".Button-comment-cancle").off("mousedown");$(".Button-comment-cancle").on("mousedown",function(){console.log("mousedown");$(this).closest(".CommentItem").find(".CommentItem-footer").removeClass("is-hide");$(this).closest(".CommentItem-editor").remove()});$(".public-DraftEditor-content").off("click");$(".public-DraftEditor-content").on("click",function(){$(this).parents(".CommentEditor--nouse").addClass("CommentEditor--active");$(this).parents(".CommentEditor-input").addClass("is-focus");$(this).parents(".Input.Editable").addClass("Editable--focus")});$(".public-DraftEditor-content").off("keyup");$(".public-DraftEditor-content").on("keyup",function(){$(this).parents(".DraftEditor-root").find(".public-DraftEditorPlaceholder-inner").addClass("is-hide");if("false"==a){b=$(this).text();console.log(b);if(""!=b){$(this).parents(".CommentEditor--nouse").find(".Button-comment-send").removeAttr("disabled")}else{$(this).parents(".CommentEditor--nouse").find(".Button-comment-send").attr("disabled","")}}});$(".public-DraftEditor-content").off("compositionstart");$(".public-DraftEditor-content").on("compositionstart",function(c){a="true"});$(".public-DraftEditor-content").off("compositionend");$(".public-DraftEditor-content").on("compositionend",function(c){a="false"});$(".public-DraftEditor-content").off("blur");$(".public-DraftEditor-content").on("blur",function(){console.log("blur");$(this).parents(".CommentEditor--nouse").removeClass("CommentEditor--active");$(this).parents(".CommentEditor-input").removeClass("is-focus");$(this).parents(".Input.Editable").removeClass("Editable--focus");a="false"});$(".Comments-Packup-Button").off("click");$(".Comments-Packup-Button").on("click",function(){var e=$(this).parents(".ContentItem.AnswerItem");e.find(".Comments-container").remove();var c=e.attr("data-comment-nums");var d=e.find(".Zi--Comment.Button-zi").closest("span");e.find(".Zi--Comment.Button-zi").closest("button").empty().append(d).children("span").after(c+" 条评论");$(this).closest("span").remove()});$(".Button-like-nouse").off("click");$(".Button-like-nouse").each(function(){$(this).click(function(){var c=$(this);var d=c.attr("data-like-type");var f=c.attr("data-like-id");if("comment"==d){if(c.closest(".ContentItem.AnswerItem").length>0){d="comment_answer"}else{d="comment_article"}}console.log(d);console.log(f);var e={l_type:d,l_id:f};if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/like/",e,function(g){if("fail"!=g){var h=c.children("svg");c.attr("disabled","").empty().append(h).append(g)}g_lock_ajax="false"})})})}function checkInteractionButton(){$(".Button-like-nouse").off("click");$(".Button-like-nouse").each(function(){$(this).click(function(){var a=$(this);var b=a.attr("data-like-type");var d=a.attr("data-like-id");if("comment"==b){if(a.closest(".ContentItem.AnswerItem").length>0){b="comment_answer"}else{b="comment_article"}}console.log(b);console.log(d);var c={l_type:b,l_id:d};if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/like/",c,function(e){if("fail"!=e){var f=a.children("svg");a.attr("disabled","").empty().append(f).append(e)}g_lock_ajax="false"})})});$(".Zi--Comment.Button-zi").closest("button").off("click");$(".Zi--Comment.Button-zi").closest("button").on("click",function(){if("article"==g_module){console.log("scroll into comment");document.getElementsByClassName("CommentList")[0].scrollIntoView()}else{var g=$(this).parents(".ContentItem.AnswerItem");if(g.find(".Comments-container").length>0){g.find(".Comments-container").remove();var a=g.attr("data-comment-nums");var f=$(this).children("span");$(this).empty().append(f).children("span").after(a+" 条评论");g.find(".Comments-Packup-Button").closest("span").remove()}else{$(".CommentList").removeClass("CommentList--current");var a=g.attr("data-comment-nums");var d='<div class="Comments-container"><div class="Comments Comments--withEditor Comments-withPagination"><div class="Topbar CommentTopbar"><div class="Topbar-title"><h2 class="CommentTopbar-title">'+a+' 条评论</h2></div><div class="Topbar-options"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display: inline-flex; align-items: center;">&#8203;<svg class="Zi Zi--Switch Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M13.004 7V4.232c0-.405.35-.733.781-.733.183 0 .36.06.501.17l6.437 5.033c.331.26.376.722.1 1.033a.803.803 0 0 1-.601.264H2.75a.75.75 0 0 1-.75-.75V7.75A.75.75 0 0 1 2.75 7h10.254zm-1.997 9.999v2.768c0 .405-.35.733-.782.733a.814.814 0 0 1-.5-.17l-6.437-5.034a.702.702 0 0 1-.1-1.032.803.803 0 0 1 .6-.264H21.25a.75.75 0 0 1 .75.75v1.499a.75.75 0 0 1-.75.75H11.007z" fill-rule="evenodd"></path></svg></span>切换为时间排序</button></div></div><div class="Comments-footer CommentEditor--normal CommentEditor--nouse"><div class="CommentEditor-input Input-wrapper Input-wrapper--spread Input-wrapper--large Input-wrapper--noPadding"><div class="Input Editable"><div class="Dropzone RichText ztext" style="min-height: 198px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner">写下你的评论...</div></div><div class="DraftEditor-editorContainer"><div class="notranslate public-DraftEditor-content" contenteditable="true" role="textbox" spellcheck="true" tabindex="0" style="outline: none; white-space: pre-wrap; word-wrap: break-word;"></div></div></div></div><div></div></div></div><button disabled="" type="button" class="Button Button-comment-send CommentEditor-singleButton Button--primary Button--green">评论</button></div><div class="CommentList CommentList--current"></div><div class="Comments-footer CommentEditor--normal CommentEditor--nouse CommentEditor--nouse--bottom is-hide"><div class="CommentEditor-input Input-wrapper Input-wrapper--spread Input-wrapper--large Input-wrapper--noPadding"><div class="Input Editable"><div class="Dropzone RichText ztext" style="min-height: 198px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner">写下你的评论...</div></div><div class="DraftEditor-editorContainer"><div class="notranslate public-DraftEditor-content" contenteditable="true" role="textbox" spellcheck="true" tabindex="0" style="outline: none; white-space: pre-wrap; word-wrap: break-word;"></div></div></div></div><div></div></div></div><button disabled="" type="button" class="Button Button-comment-send CommentEditor-singleButton Button--primary Button--green">评论</button></div></div></div>';g.append(d);var f=$(this).children("span");$(this).empty().append(f).children("span").after("收起评论");var e='<span><button class="Comments-Packup-Button" style="left:unset;right: 3px;z-index:999;"">收起评论<svg viewBox="0 0 10 6" class="Icon Icon--arrow" width="10" height="16" aria-hidden="true" style="height: 16px; width: 10px;"><title></title><g><path d="M8.716.217L5.002 4 1.285.218C.99-.072.514-.072.22.218c-.294.29-.294.76 0 1.052l4.25 4.512c.292.29.77.29 1.063 0L9.78 1.27c.293-.29.293-.76 0-1.052-.295-.29-.77-.29-1.063 0z"></path></g></svg></button></span>';g.append(e);var b=g.attr("data-content-id");var c=g.attr("data-content-type");getComments(c,b)}}})}function checkAnswerQuestion(){var b="";function a(){if((b.length>=TEXT_MIN_LENGTH_LOW)){$(".AnswerForm-submit").removeAttr("disabled")}else{$(".AnswerForm-submit").attr("disabled","")}}$("#summernote_answer").on("summernote.change",function(d,e,c){b=e.replace("<p><br></p>","").replace("<p>","").replace("</p>","");a()});$(".ShowAnswerBar-nouse").off("click");$(".ShowAnswerBar-nouse").on("click",function(){if(false==veriLogin()){return}if($(".AnswerToolbar").hasClass("is-hide")){$(".AnswerToolbar").removeClass("is-hide");$(".AnswerToolbar .AuthorInfo-avatar").attr("src",g_user_avatar).attr("alt",g_user_name);$(".AnswerToolbar .AuthorInfo-name").empty().append(g_user_name)}else{$(".AnswerToolbar").addClass("is-hide")}});$(".HideAnswerBar-nouse").off("click");$(".HideAnswerBar-nouse").on("click",function(){$(".AnswerToolbar").addClass("is-hide")});$(".AnswerForm-submit").off("click");$(".AnswerForm-submit").on("click",function(){var c="/ajax/question_answer/"+g_question_id+"/";var d=$("#summernote_answer").summernote("code");if(d>LARGE_TEXT_MAX_LENGTH){d=d.substr(0,LARGE_TEXT_MAX_LENGTH-1)}var e=new FormData();e.append("content",d);$.ajax({data:e,type:"POST",url:c,cache:false,contentType:false,processData:false,success:function(f){if("fail"!=f){location.href=f}}})})}function checkAsk(){var g="";var d=[];var c="";function b(){if((""!=g)&&(d.length>0)){$(".QuestionAsk .QuestionAsk-buttonGroup>button").removeAttr("disabled")}else{$(".QuestionAsk .QuestionAsk-buttonGroup>button").attr("disabled","")}}function f(){$(".QuestionAsk .QuestionAsk-title textarea").on("input",function(){g=$("textarea[name='title']").val();b()})}function a(){$(".QuestionAsk .selectpicker").on("changed.bs.select",function(h){d=$(".QuestionAsk .selectpicker").val();console.log(d.length);b();$(".bootstrap-select .dropdown-menu").trigger("click")})}function e(){$("#summernote_question").on("summernote.change",function(j,k,h){c=k.replace("<p><br></p>","").replace("<p>","").replace("</p>","")})}$(".QuestionAsk .QuestionAsk-buttonGroup>button").click(function(){if(g.length>LITTLE_TEXT_MAX_LENGTH){g=g.substr(0,LITTLE_TEXT_MAX_LENGTH-1);$("textarea[name='title']").val(g)}if(c.length>MIDDLE_TEXT_MAX_LENGTH){c=c.substr(0,MIDDLE_TEXT_MAX_LENGTH-1)}$("input[name='detail']").val(c);$(this).closest("form").submit()});f();a();e();$("#askModal").on("shown.bs.modal",function(){if(false==veriLogin()){return}$("#askModal").off("click.dismiss.bs.modal",'[data-dismiss="modal"]');$("#askModal").on("click.dismiss.bs.modal",'[data-dismiss="modal"]',function(){$("#askModal .modal").modal("hide");$("#askModal").modal("hide")})});$("#askModal .note-editor button.close").off("mousedown");$("#askModal .note-editor button.close").on("mousedown",function(h){$("#askModal").off("click.dismiss.bs.modal",'[data-dismiss="modal"]');h.preventDefault();setTimeout(function(){$("#askModal").on("click.dismiss.bs.modal",'[data-dismiss="modal"]',function(){$("#askModal .modal").modal("hide");$("#askModal").modal("hide")})},1000)});$("#askModal .Modal-closeButton").off("click");$("#askModal .Modal-closeButton").on("click",function(){console.log("modal close buttion click");$("textarea[name='title']").val("");$(".selectpicker").empty();$(".selectpicker").selectpicker("refresh");g_selectpicker_init="false";$("#summernote_question").summernote("code","")})}function checkWrite(){var g="";var f=[];var e="";function b(){if((""!=g)&&(f.length>0)&&(e.length>=TEXT_MIN_LENGTH_HIGH)){$(".WritePost").removeAttr("disabled")}else{$(".WritePost").attr("disabled","")}}function d(){$(".WriteIndex-titleInput .Input").on("input",function(){g=$("input[name='writeTitle']").val();b()})}function c(){$(".Wirte-select .selectpicker").on("changed.bs.select",function(h){f=$(".Wirte-select .selectpicker").val();console.log(f.length);b();$(".bootstrap-select .dropdown-menu").trigger("click")})}function a(){$("#summernote_write").on("summernote.change",function(j,k,h){e=k.replace("<p><br></p>","").replace("<p>","").replace("</p>","");b()})}$(".WritePost").click(function(){if(g.length>LITTLE_TEXT_MAX_LENGTH){g=g.substr(0,LITTLE_TEXT_MAX_LENGTH-1);$("input[name='writeTitle']").val(g)}if(e.length>LARGE_TEXT_MAX_LENGTH){e=e.substr(0,LARGE_TEXT_MAX_LENGTH-1)}$("input[name='writeContent']").val(e);$(this).closest("form").submit()});d();c();a()}function checkSets(){checkAsk();checkFollow();checkContentClick();checkContentExpand();checkContentCollapse();checkInteractionButton();checkExpandBtn();checkAnswerQuestion()}function getComments(a,c){var b={c_type:a,a_id:c};if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post("/ajax/get_comments/",b,function(d){if("fail"!=d){console.log("get comments success");appendCommentsElement(d)}checkComment();g_lock_ajax="false"})}function getMoreData(){if($(".List-item.NoMoreData").length>0){return}if("index"==g_module){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;var d="/ajax/questions/"+a+"/"+g+"/"+b+"/";var f={follow_topics:""+g_user_follow_topics_list}}else{if("question"==g_module){if("all"==g_list_type){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;var d="/ajax/answers/"+g_question_id+"/"+a+"/"+g+"/"+b+"/";var f=""}else{return}}else{if("topic"==g_module){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;var d="/ajax/topic/"+g_topic_id+"/"+a+"/"+g+"/"+b+"/";var f={type:g_type}}else{if("mytopic"==g_module){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP*2;var c=0;var d="/ajax/topics/"+c+"/"+g+"/"+b+"/";var f=""}else{if("search"==g_module){if((""!=g_search_keyword)&&(""!=g_search_type)){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;var d="/ajax/search/"+g_search_type+"/"+a+"/"+g+"/"+b+"/";var f={keyword:g_search_keyword}}else{return}}else{if("setting"==g_module){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;if("conversation_messages"==g_setting_type){var d="/ajax/"+g_setting_type+"/"+g_conversation_id+"/"+a+"/"+g+"/"+b+"/"}else{var d="/ajax/"+g_setting_type+"/"+a+"/"+g+"/"+b+"/"}var f=""}else{if("home"==g_module){if("answers"==g_command){var d="/ajax/er/"+g_er_id+"/answers/";var f={start:g_last_getmoredata_index,end:g_last_getmoredata_index+STEP}}else{if("asks"==g_command){var d="/ajax/er/"+g_er_id+"/asks/";var f={start:g_last_getmoredata_index,end:g_last_getmoredata_index+STEP*10}}else{if("following"==g_command){console.log($("main").find(".ReturnHomePage").length);if($("main").find(".ReturnHomePage").length<=0){return}var d="/ajax/er/"+g_er_id+"/following/"+g_subcmd+"/";var f={start:g_last_getmoredata_index,end:g_last_getmoredata_index+STEP*10}}}}}else{if("answer_page"==g_module){var e=g_last_getmoredata_index;var a=1;var g=e;var b=g+STEP;var d="/ajax/answer_page/"+g_type+"/"+a+"/"+g+"/"+b+"/";var f=""}else{return}}}}}}}}if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post(d,f,function(h){if("fail"!=h){if("index"==g_module){appendAnswerElementCard(h,"has_topic_question_title",diretion="append")}else{if("question"==g_module){if("all"==g_list_type){appendAnswerElementList(h,"all","append")}}else{if("topic"==g_module){if("unanswered"==g_type){appendQuestionElement(h)}else{appendAnswerElementList(h,"topic","append")}}else{if("mytopic"==g_module){appendTopicElement(h)}else{if("search"==g_module){appendSearchPageElement(h)}else{if("setting"==g_module){appendSettingPageElement(h)}else{if("home"==g_module){if("answers"==g_command){appendAnswerElementList(h,"homepage","append")}else{if("asks"==g_command){appendQuestionElement(h)}else{if("following"==g_command){appendFollowOrMoreElement(h)}}}}else{if("answer_page"==g_module){if("invited"==g_type){appendInvitedQuestionElement(h)}else{appendQuestionElement(h)}}}}}}}}}checkSets();g_last_getmoredata_index+=STEP}else{console.log("no more data");$("#appendArea").append('<div class="List-item NoMoreData"><div class="ContentItem" ><div class="ContentItem-status"  style="text-align:center">没有更多内容</div></div></div>')}g_lock_ajax="false"})}function show_conversion_messages(j,c,h){var f='<div class="List-item Conversation-messages-head"><div class="zg-section"><a href="/conversations">« 返回</a></div><div class="zg-section zg-14px"><span class="zg-gray-normal">发私信给 </span><span class="zg-gray-darker">'+h+'</span>：</div><div class="zg-section LetterSend" id="zh-pm-editor-form"><div class="zg-editor-simple-wrap zg-form-text-input"><div class="zg-user-name" style="display:none"></div><textarea id="letterText" class="zg-editor-input zu-seamless-input-origin-element" style="font-weight: normal; height: 22px;" data-receiver-id="'+c+'"></textarea></div><div class="zh-pm-warnmsg" style="display:none;text-align:right;color:#C3412F;"></div><div class="zm-command"><button class="Button Messages-sendButton Button--primary Button--green" type="button" onclick="sendLetter()">发送</button></div></div></div>';$("#appendArea").empty().prepend(f);g_last_getmoredata_index=0;g_setting_type="conversation_messages";var k=g_last_getmoredata_index;var d=1;var b=k;var e=b+STEP;var a="/ajax/"+g_setting_type+"/"+j+"/"+d+"/"+b+"/"+e+"/";var g="";if("true"==g_lock_ajax){return}g_lock_ajax="true";$.post(a,g,function(l){if("fail"!=l){g_last_getmoredata_index+=STEP;appendSettingPageElement(l)}else{console.log("no more data");$("#appendArea").append('<div class="List-item NoMoreData"><div class="ContentItem" ><div class="ContentItem-status"  style="text-align:center">没有更多内容</div></div></div>')}g_lock_ajax="false"})}function checkAndroidOrIos(){var a=navigator.userAgent;var c=a.indexOf("Android")>-1||a.indexOf("Adr")>-1;var b=!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(b){$(".MobileAppHeader-downloadLink").attr("href","")}else{$(".MobileAppHeader-downloadLink").attr("href","http://3rd.danongling.com/danongling-arm.apk")}}function checkIsWeChat(){var b=navigator.userAgent;var c=b.indexOf("MicroMessenger")>-1;if(c){var a=typeof window.innerHeight!="undefined"?window.innerHeight:document.documentElement.clientHeight;var d=$('<div id="weixinTip"><p><img src="static/common/img/tip_download.png" alt="微信打开"/></p></div>');$("body").append(d);$("#weixinTip").css({position:"fixed",left:"0",top:"0",height:a,width:"100%","z-index":"1000","background-color":"rgba(0,0,0,0.8)",filter:"alpha(opacity=80)"}).addClass("is-hide");$("#weixinTip p").css({"text-align":"center","margin-top":"10%","padding-left":"5%","padding-right":"5%"});$("#weixinTip p img").css({"max-width":"100%",height:"auto"});$(".MobileAppHeader-downloadLink").attr("href","javascript:;");$(".MobileAppHeader-downloadLink").click(function(){$("#weixinTip").removeClass("is-hide");return false})}}function initElement(){if("false"==g_init_data_done){return}setTimeout(function(){if(typeof(g_is_app)=="undefined"?true:false){$(".Mobile-header").removeClass("is-hide")}},100);if("true"==g_logged){appendLetterModal()}$("head title").text(SITE+" - "+SITE_SLOGAN);checkAndroidOrIos();checkIsWeChat();if("question"==g_module){$("head title").text(g_question_title+" - "+SITE);$(".QuestionHeader-title").empty().append('<a href="/question/'+g_question_id+'">'+g_question_title+"</a>");if($.inArray(""+g_question_id,g_user_follow_questions_list)>=0){$(".FollowButton").removeClass("Button--green is-hide").addClass("Button--grey").attr("data-question-id",g_question_id).attr("data-followed","true").text("已关注")}else{$(".FollowButton").removeClass("Button--grey is-hide").addClass("Button--green").attr("data-question-id",g_question_id).attr("data-followed","false").text("关注问题")}$(".RichText img").addClass("origin_image");$(".QuestionFollowStatus-counts .NumberBoard-value:first").empty().text(g_question_follower_nums);$(".QuestionFollowStatus-counts .NumberBoard-value:last").empty().text(g_question_click_nums);var b=$(".Card.AnswerAuthor .FollowButton");var l=b.attr("data-author-id");var q=b.attr("data-author-name");var u=b.attr("data-author-sexual");console.log(l);console.log(u);if("f"==u){var t="she";var j="她"}else{var t="he";var j="他"}if($.inArray(""+l,g_user_follow_peoples_list)>=0){b.removeClass("Button--green").addClass("Button--grey").attr("data-followed","true").attr("data-who",t).text("已关注")}else{b.removeClass("Button--grey").addClass("Button--green").attr("data-followed","false").attr("data-who",t).text("关注"+j)}setLetterReceiver(l,q);checkQuestionDetailExpand();checkQuestionDetailCollapse()}else{if("topic"==g_module){$("head title").text(g_topic_name+" - "+SITE);var c="";var r="";if("hot"==g_type){c="is-active"}else{if("unanswered"==g_type){r="is-active"}else{g_type="hot";c="is-active"}}$(".Tabs.Topic-tabs").append('<li role="tab" class="Tabs-item Tabs-item--noMeta" aria-controls="Topic-hot"><a class="Tabs-link '+c+'" href="/topic/'+g_topic_id+'/hot">讨论</a></li><li role="tab" class="Tabs-item Tabs-item--noMeta" aria-controls="Topic-wait"><a class="Tabs-link '+r+'" href="/topic/'+g_topic_id+'/unanswered">等待回答</a></li>');$(".TopicCard-image").empty().append('<img alt="'+g_topic_name+'" src="'+g_topic_avatar+'">');$(".TopicCard-title").append(g_topic_name);$(".TopicCard-description").html(g_topic_detail);$(".NumberBoard-value").append(g_topic_follower_nums);if($.inArray(""+g_topic_id,g_user_follow_topics_list)>=0){$(".FollowButton.TopicCard-followButton").removeClass("Button--green").addClass("Button--grey").attr("data-topic-id",g_topic_id).attr("data-followed","true").text("已关注")}else{$(".FollowButton.TopicCard-followButton").removeClass("Button--grey").addClass("Button--green").attr("data-topic-id",g_topic_id).attr("data-followed","false").text("关注栏目")}}else{if("mytopic"==g_module){$("head title").text("我关注的栏目 - "+SITE);if("true"==g_logged){$("#myfollow").attr("href","/er/"+g_user_id+"/following/topics/")}}else{if("search"==g_module){$("head title").text("搜索 - "+SITE);if(""==g_search_type){g_search_type="question"}$(".Tabs-link").removeClass("is-active");$(".Tabs-link").each(function(){if($(this).attr("data-search-type")==g_search_type){$(this).addClass("is-active")}});checkSearch()}else{if("setting"==g_module){$("head title").text("设置 - "+SITE);$(".Tabs-link").removeClass("is-active");$(".Tabs-link").each(function(){if($(this).attr("href")){if($(this).attr("href").indexOf(g_setting_type)>-1){$(this).addClass("is-active")}}});if("conversation_messages"==g_setting_type){var w='<div class="List-item Conversation-messages-head"><div class="zg-section"><a href="/conversations">« 返回</a></div><div class="zg-section zg-14px"><span class="zg-gray-normal">发私信给 </span><span class="zg-gray-darker">'+g_parter_name+'</span>：</div><div class="zg-section LetterSend" id="zh-pm-editor-form"><div class="zg-editor-simple-wrap zg-form-text-input"><div class="zg-user-name" style="display:none"></div><textarea id="letterText" class="zg-editor-input zu-seamless-input-origin-element" style="font-weight: normal; height: 22px;" data-receiver-id="4"></textarea></div><div class="zh-pm-warnmsg" style="display:none;text-align:right;color:#C3412F;"></div><div class="zm-command"><button class="Button Messages-sendButton Button--primary Button--green" type="button" onclick="sendLetter()">发送</button></div></div></div>';$("#appendArea").prepend(w)}checkSettingPage()}else{if("sign"==g_module){$("head title").text(SITE+" - "+SITE_SLOGAN);$(".SignFlowHeader-title").text("登录"+SITE);$(".SignFlowHeader-subTitle").text(SITE_SLOGAN);checkSmsSend();checkSignAndMiscPage();var e=getCookie("countdown");if(null!=e){g_countdown_secs=e;$(".SignFlow-smsInputButton").addClass("is-counting").empty().append('<span id="counting-num">59</span>秒后可重发');setTimeout("countDown()",1000)}}else{if("misc"==g_module){if("password_reset"!=g_arg){var w='<div class="" style="position:relative;padding:0 16px;margin:100px auto;"><div class="" style="font-size:20px;font-weight:600;font-synthesis:style;color:#1a1a1a;text-align:center;padding:10px auto;"><h1 id="errorText" style="margin:20px auto;color:red;"></h1><a id="returnLink" style="color:blue;" href="/signinup/?next=/"></a></div></div>';$("main").empty().append(w);if("e_veri_code"==g_arg){$("#errorText").text("验证码错误，注册失败，请尝试返回注册页面重新注册");$("#returnLink").text("返回重新注册");setTimeout(function(){window.location.href="/signinup/?next=/"},10*1000)}else{if("e_u_p"==g_arg){$("#errorText").text("用户名密码错误，登录失败，请尝试返回登录页面重新登录");$("#returnLink").text("返回重新登录");setTimeout(function(){window.location.href="/signinup/?next=/"},10*1000)}else{if("e_registered"==g_arg){$("#errorText").text("该手机号已被注册，请尝试找回密码或更换手机号重新注册");$("#returnLink").text("返回重新注册");setTimeout(function(){window.location.href="/signinup/?next=/"},10*1000)}else{if("reset_pwd_success"==g_arg){$("#errorText").text("重置密码成功");$("#returnLink").text("返回重新登录");setTimeout(function(){window.location.href="/signinup/?next=/"},10*1000)}}}}}else{checkSmsSend();checkSignAndMiscPage();var e=getCookie("countdown");if(null!=e){g_countdown_secs=e;$(".SignFlow-smsInputButton").addClass("is-counting").empty().append('<span id="counting-num">59</span>秒后可重发');setTimeout("countDown()",1000)}}}else{if("home"==g_module){$("head title").text(g_er_name+"的主页 - "+SITE);$(".Profile-avatar").attr("src",g_er_avatar);$(".Profile-name").text(g_er_name);$(".Profile-headline").html(g_er_mood);$("#residence").html(g_er_residence);$("#job").html(g_er_job);$("#followers").text(g_follower_nums);$("#followtos").text(g_followto_nums);if("f"==g_er_sexual){var t="she";var j="她";g_er_sexual_han="女"}else{var t="he";var j="他";g_er_sexual_han="男"}if(("true"==g_logged)&&(g_er_id==g_user_id)){var t="me";var j="我";$(".ProfileEditButton").removeClass("is-hide");$(".ProfileLetterButton").addClass("is-hide");$(".ProfileFollowButton").addClass("is-hide")}else{$(".ProfileEditButton").addClass("is-hide");$(".ProfileLetterButton").removeClass("is-hide");if($.inArray(""+g_er_id,g_user_follow_peoples_list)>=0){$(".ProfileFollowButton").removeClass("is-hide Button--green").addClass("Button--grey").text("已关注").attr("data-followed","true").attr("data-er-id",g_er_id).attr("data-who",t)}else{$(".ProfileFollowButton").removeClass("is-hide Button--grey").addClass("Button--green").text("关注"+j).attr("data-followed","false").attr("data-er-id",g_er_id).attr("data-who",t)}}$(".who").text(j);var h="";var s="";var k="";var f="";if("answers"==g_command){h="is-active"}else{if("asks"==g_command){s="is-active"}else{if("posts"==g_command){k="is-active"}else{if("following"==g_command){f="is-active";appendFollowOrMoreHead()}else{console.log("false")}}}}var d='<li role="tab" class="Tabs-item Tabs-item--noMeta" aria-controls="Profile-activities"><a class="Tabs-link '+h+'" href="/er/'+g_er_id+'/answers/">回答</a></li><li role="tab" class="Tabs-item Tabs-item--noMeta" aria-controls="Profile-answers"><a class="Tabs-link '+s+'" href="/er/'+g_er_id+'/asks/">提问</a></li><li role="tab" class="Tabs-item Tabs-item--noMeta" aria-controls="Profile-articals"><a class="Tabs-link '+k+'" href="/er/'+g_er_id+'/posts/">文章</a></li><li role="tab" class="Tabs-item Tabs-item--noMeta" aria-controls="Profile-questions"><a class="Tabs-link '+f+'" href="/er/'+g_er_id+'/following/">关注</a></li>';$(".Tabs.ProfileBar").append(d);setLetterReceiver(g_er_id,g_er_name);checkNextPage();checkHomePage()}else{if("answer_page"==g_module){$("head title").text("回答 - "+SITE);$(".ContentLayout-mainColumn .Tabs-item").each(function(){if(g_type==$(this).attr("data-type")){$(this).children(".Tabs-link").addClass("is-active")}});if("all"==g_type){var v="全站的问题"}else{if("invited"==g_type){var v="邀请我回答的问题"}else{var v="为你推荐的问题"}}$(".ContentLayout-mainColumn .Card .List .List-headerText").empty().append(v)}else{if("article"==g_module){$("head title").text(g_article_title+" - "+SITE);$(".Post-Title").empty().append(g_article_title);var m=$("main").attr("data-article-content");$(".Post-RichText").empty().append(addClassImg(m,'class="origin_image zh-lightbox-thumb lazy"'));var a="关注她";var o="Button--green";var g="she";if("f"!=g_article_author_sexual){a="关注他";g="he"}var n="false";if($.inArray(""+g_article_author_id,g_user_follow_peoples_list)>=0){o="Button--grey";a="已关注";n="true"}$(".FollowButton").addClass(o).removeClass("is-hide").attr("data-er-id",g_article_author_id).attr("data-followed",n).attr("data-who",g).children("span").text(a);$(".Post-Author .AuthorInfo-avatarWrapper .UserLink-link").attr("href","/er/"+g_article_author_id).attr("data-author-id",g_article_author_id).children("img").attr("alt",g_article_author_name).attr("src",g_article_author_avatar);$(".Post-Author .AuthorInfo-name .UserLink-link").attr("href","/er/"+g_article_author_id).empty().text(g_article_author_name);$(".Post-Author .AuthorInfo-detail .AuthorInfo-badgeText").html(g_article_author_mood);var p="发布于 "+g_article_pub_date.split(".")[0];$(".ContentItem-time>a").attr("href","/article/"+g_article_id+"/").children("span").attr("data-tooltip",p).text(p);$(".Comment--nums--nouse").empty().text(g_article_comment_nums);$(".Article--likenums--nouse").empty().text(g_article_like_nums);$(".Button-like-nouse").attr("data-like-id",g_article_id);checkInteractionButton();getComments("article",g_article_id)}else{if("write"==g_module){$("head title").text("写文章 - "+SITE);$("#summernote_write").summernote({toolbar:[["style",["bold","italic","underline"]],["para",["paragraph"]],["table",["table"]],["link",["link"]],["picture",["picture"]],["video",["video"]]],height:null,minHeight:200,lang:"zh-CN",placeholder:"请输入文章内容(至少100字)",disableDragAndDrop:true,callbacks:{onImageUpload:function(x){scaleAndUploadImage("forWrite",x[0],720)},onInit:function(){$("#summernote_write + .note-editor .note-btn-group.btn-group.note-picture").empty().html('<input id="summernote_write_picture" name="file" type="file" accept="image/*" style="display: none;"/><div class="note-btn btn btn-default btn-sm"><i class="note-icon-picture"></i></div>');$("#summernote_write + .note-editor .note-btn-group.btn-group.note-picture .note-btn").click(function(){$("#summernote_write_picture").click()});$("#summernote_write_picture").on("change",function(){var x=$("#summernote_write_picture")[0].files[0];scaleAndUploadImage("forWrite",x,720)})}}});$(".note-statusbar").addClass("is-hide");checkWrite()}}}}}}}}}}}g_init_element_done="true"}function initData(){var d=$("main").attr("data-dfs-main");console.log(d);var e=JSON.parse(d);g_logged=e.logged;if("question"==g_module){g_question_detail=$("main").attr("data-question-detail");g_question_id=e.question_id;g_question_title=e.question_title;g_question_follower_nums=e.question_follower_nums;g_question_answer_nums=e.question_answer_nums;g_question_click_nums=e.question_click_nums;if($(".Question-main .Card.AnswerCard").length>0){g_list_type="more"}else{g_list_type="all"}}else{if("topic"==g_module){g_topic_id=e.topic_id;g_topic_name=e.topic_name;g_topic_avatar=e.topic_avatar;g_topic_detail=e.topic_detail;g_topic_follower_nums=e.topic_follower_nums;g_type=e.type}else{if("mytopic"==g_module){}else{if("search"==g_module){g_search_keyword=e.search_keyword;g_search_type=e.search_type}else{if("setting"==g_module){g_setting_type=e.type;g_conversation_id=e.conversation_id}else{if("misc"==g_module){g_arg=e.arg}else{if("home"==g_module){var b=$("main").attr("data-dfs-ext");var h=JSON.parse(b);g_er_id=e.er_id;g_er_name=e.er_name;g_er_avatar=e.er_avatar;g_er_mood=e.er_mood;g_er_sexual=e.er_sexual;g_er_residence=e.er_residence;g_er_job=e.er_job;g_er_intro=e.er_intro;g_followed=e.followed;g_command=e.command;g_subcmd=e.subcmd;g_question_nums=h.question_nums;g_article_nums=h.article_nums;g_answer_nums=h.answer_nums;g_followto_nums=h.followto_nums;g_follower_nums=h.follower_nums;g_followtopic_nums=h.followtopic_nums;g_followquestion_nums=h.followquestion_nums}else{if("article"==g_module){g_article_id=e.article_id;g_article_title=e.article_title;g_article_click_nums=e.article_click_nums;g_article_like_nums=e.article_like_nums;g_article_comment_nums=e.article_comment_nums;g_article_pub_date=e.article_pub_date;g_article_author_id=e.author_id;g_article_author_name=e.author_name;g_article_author_avatar=e.author_avatar;g_article_author_mood=e.author_mood;g_article_author_sexual=e.author_sexual}else{if("answer_page"==g_module){g_type=e.type}}}}}}}}}if("true"==g_logged){g_user_id=e.user_id;g_user_name=e.user_name;g_user_token=g_user_id.substr(g_user_id.length-5,g_user_id.length);g_cookie_expire=1*24*60*60;var k=getCookie("ufp"+g_user_token);var c=getCookie("uft"+g_user_token);var j=getCookie("ufq"+g_user_token);var g=getCookie("up"+g_user_token);if((null==k)||(null==j)||(null==c)|(null==g)){var a="/ajax/user_data/"+g_user_id+"/";var f={type:"all"};$.post(a,f,function(l){if("fail"!=l){g_user_follow_peoples_list=String(l[0]).split(",");g_user_follow_topics_list=String(l[1]).split(",");g_user_follow_questions_list=String(l[2]).split(",");g_user_profile_list=l[3];g_user_avatar=g_user_profile_list[2];g_user_mood=g_user_profile_list[3];delCookie("ufp"+g_user_token);delCookie("uft"+g_user_token);delCookie("ufq"+g_user_token);delCookie("up"+g_user_token);setCookie("ufp"+g_user_token,utf8_to_b64(l[0]),g_cookie_expire);setCookie("uft"+g_user_token,utf8_to_b64(l[1]),g_cookie_expire);setCookie("ufq"+g_user_token,utf8_to_b64(l[2]),g_cookie_expire);setCookie("up"+g_user_token,utf8_to_b64(l[3]),g_cookie_expire)}g_init_data_done="true";initElement();action()})}else{g_user_follow_peoples_list=b64_to_utf8(k).split(",");g_user_follow_topics_list=b64_to_utf8(c).split(",");g_user_follow_questions_list=b64_to_utf8(j).split(",");g_user_profile_list=b64_to_utf8(g).split(",");g_user_avatar=g_user_profile_list[2];g_user_mood=g_user_profile_list[3];g_init_data_done="true"}}else{g_init_data_done="true"}}function action(){if("false"==g_init_element_done){return}if(("sign"!=g_module)&&("misc"!=g_module)&&("nofeature"!=g_module)){getMoreData();checkSets()}g_init_done="true";console.log("init done")}function init(){g_module=$("main").attr("data-module");initData();initElement();action()}function initCommon(){LARGE_TEXT_MAX_LENGTH=10000;MIDDLE_TEXT_MAX_LENGTH=500;LITTLE_TEXT_MAX_LENGTH=100;TEXT_MIN_LENGTH_HIGH=100;TEXT_MIN_LENGTH_MID=50;TEXT_MIN_LENGTH_LOW=10;notifications="null";messages="null";g_last_getmoredata_index=0;g_sticky_show="false";cache_topics="";g_selectpicker_init="false";g_init_data_done="false";g_init_element_done="false";g_user_follow_peoples_list=[];g_user_follow_topics_list=[];g_user_follow_questions_list=[];g_cache_question_id_list=[];g_cache_article_id_list=[];modify_icon_svg='<svg viewBox="0 0 12 12" class="Icon ModifyButton-icon Icon--modify" width="12" height="16" aria-hidden="true" style="height: 16px; width: 12px;"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"></path></g></svg>';like_icon_svg='<svg viewBox="0 0 20 18" xmlns="http://www.w3.org/2000/svg" class="Icon Icon--like Icon--left" width="13" height="16" aria-hidden="true" style="height: 16px; width: 13px;"><title></title><g><path d="M.718 7.024c-.718 0-.718.63-.718.63l.996 9.693c0 .703.718.65.718.65h1.45c.916 0 .847-.65.847-.65V7.793c-.09-.88-.853-.79-.846-.79l-2.446.02zm11.727-.05S13.2 5.396 13.6 2.89C13.765.03 11.55-.6 10.565.53c-1.014 1.232 0 2.056-4.45 5.83C5.336 6.965 5 8.01 5 8.997v6.998c-.016 1.104.49 2 1.99 2h7.586c2.097 0 2.86-1.416 2.86-1.416s2.178-5.402 2.346-5.91c1.047-3.516-1.95-3.704-1.95-3.704l-5.387.007z"></path></g></svg>';comment_icon_svg='<svg class="Zi Zi--Comment Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M10.241 19.313a.97.97 0 0 0-.77.2 7.908 7.908 0 0 1-3.772 1.482.409.409 0 0 1-.38-.637 5.825 5.825 0 0 0 1.11-2.237.605.605 0 0 0-.227-.59A7.935 7.935 0 0 1 3 11.25C3 6.7 7.03 3 12 3s9 3.7 9 8.25-4.373 9.108-10.759 8.063z" fill-rule="evenodd"></path></svg>';share_button='<div class="Popover ShareMenu ContentItem-action"><div class="" aria-haspopup="true" aria-expanded="false"><img class="ShareMenu-fakeQRCode" src="" alt="微信二维码"><button class="Button Button--plain Button--withIcon Button--withLabel" type="button"><span style="display: inline-flex; align-items: center;">&#8203;<svg class="Zi Zi--Share Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M2.931 7.89c-1.067.24-1.275 1.669-.318 2.207l5.277 2.908 8.168-4.776c.25-.127.477.198.273.39L9.05 14.66l.927 5.953c.18 1.084 1.593 1.376 2.182.456l9.644-15.242c.584-.892-.212-2.029-1.234-1.796L2.93 7.89z" fill-rule="evenodd"></path></svg></span>分享</button></div></div>';$("#summernote_question").summernote({toolbar:[["style",["bold","italic","underline"]],["table",["table"]],["link",["link"]],["picture",["picture"]],["video",["video"]]],minHeight:100,lang:"zh-CN",placeholder:"问题背景、条件等详细信息",callbacks:{onImageUpload:function(a){scaleAndUploadImage("forQuestion",a[0],720)},onInit:function(){$(".note-statusbar").addClass("is-hide");$("#summernote_question + .note-editor .note-btn-group.btn-group.note-picture").empty().html('<input id="summernote_question_picture" name="file" type="file" accept="image/*" style="display: none;"/><div class="note-btn btn btn-default btn-sm"><i class="note-icon-picture"></i></div>');$("#summernote_question + .note-editor .note-btn-group.btn-group.note-picture .note-btn").click(function(){$("#summernote_question_picture").click()});$("#summernote_question_picture").on("change",function(){var a=$("#summernote_question_picture")[0].files[0];scaleAndUploadImage("forQuestion",a,720)})}}});$("#summernote_answer").summernote({toolbar:[["style",["bold","italic","underline"]],["para",["paragraph"]],["table",["table"]],["link",["link"]],["picture",["picture"]],["video",["video"]]],minHeight:150,lang:"zh-CN",placeholder:"写回答...",callbacks:{onImageUpload:function(a){scaleAndUploadImage("forAnswer",a[0],720)},onInit:function(){$(".note-statusbar").addClass("is-hide");$("#summernote_answer + .note-editor .note-btn-group.btn-group.note-picture").empty().html('<input id="summernote_answer_picture" name="file" type="file" accept="image/*" style="display: none;"/><div class="note-btn btn btn-default btn-sm"><i class="note-icon-picture"></i></div>');$("#summernote_answer + .note-editor .note-btn-group.btn-group.note-picture .note-btn").click(function(){$("#summernote_answer_picture").click()});$("#summernote_answer_picture").on("change",function(){var a=$("#summernote_answer_picture")[0].files[0];scaleAndUploadImage("forAnswer",a,720)})}}});checkSelectOption()}function slog(a){if("true"==ENABLE_SCREEN_LOG){var b="<div>"+a+"</div>";$("#debug").append(b)}}$(document).ready(function(){console.log("init");initCommon();init()});$(document).click(function(a){$("#NotificationPopover").popover("hide");$("#MessagePopover").popover("hide");$("#MenuPopover").popover("hide");$("#SearchPopover").popover("hide")});window.onscroll=function(){if("false"==g_init_done){return}if("article"==g_module){if($(window).scrollTop()+$(window).height()>$(".RichContent-actions-anchor").offset().top){if("true"==g_sticky_show){$(".Sticky.RichContent-actions").removeClass("is-fixed").attr("style","");$(".Sticky--holder").remove();g_sticky_show="false"}}else{if("false"==g_sticky_show){$(".Sticky.RichContent-actions").addClass("is-fixed").attr("style","width: 690px; bottom: 0px; left: auto;");$(".Sticky--holder").remove();$(".RichContent-actions-nouse").after('<div class="Sticky--holder" style="position: static; top: auto; right: auto; bottom: 0px; left: 0px; display: block; float: none; margin: 0px 0px 10px; height: 54px;"></div>');g_sticky_show="true"}}}if(getScrollTop()+getClientHeight()+10>=getScrollHeight()){getMoreData()}};SITE="大农令";SITE_SLOGAN="关注新农业,新农村,新农民";STEP=10;g_lock_ajax="false";g_init_done="false";ENABLE_SCREEN_LOG="true";function veriLogin(){if("true"!=g_logged){var a=location.href;location.href="/signinup/?next="+a;return false}return true};